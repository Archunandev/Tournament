
    <!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
									<title>Free Fire Max Tournament Fun Series 13 Mar 2023 Prize Rs. 200 -</title>
					
		
		<link rel="stylesheet" href="https://www.ultimatebattle.in/wp-content/themes/blackfyre/style.css?ver=1.3.0" />	
		<link rel="preload" href="https://www.ultimatebattle.in/wp-includes/js/jquery/jquery.js" as="script" />	
		<link rel="preload" href="https://www.ultimatebattle.in/wp-includes/js/jquery/jquery-migrate.min.js" as="script" />	
		<link href="https://www.ultimatebattle.in/wp-content/themes/blackfyre/css/font-awesome.css" crossorigin />	
		
<!-- This site is optimized with the Yoast SEO plugin v5.7.1 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Free Fire Max Tournament Fun Series 13 Mar 2023 Prize Rs. 200 -" />
<meta property="og:url" content="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Free Fire Max Tournament Fun Series 13 Mar 2023 Prize Rs. 200 -" />
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/www.ultimatebattle.in\/","name":"","potentialAction":{"@type":"SearchAction","target":"https:\/\/www.ultimatebattle.in\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//cdn.onesignal.com' />
<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//code.jquery.com' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.ultimatebattle.in\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='ubsstyle-css'  href='https://www.ultimatebattle.in/wp-content/plugins/ub-stats/includes/css/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='bradmax-player-css'  href='https://www.ultimatebattle.in/wp-content/plugins/bradmax-player/assets/css/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='bp-parent-css-css'  href='https://www.ultimatebattle.in/wp-content/themes/blackfyre/css/buddypress.css' type='text/css' media='screen' />
<link rel='stylesheet' id='woocommerce-layout-css'  href='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/css/woocommerce-layout.css' type='text/css' media='all' />
<link rel='stylesheet' id='woocommerce-smallscreen-css'  href='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/css/woocommerce-smallscreen.css' type='text/css' media='only screen and (max-width: 768px)' />
<link rel='stylesheet' id='woocommerce-general-css'  href='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/css/woocommerce.css' type='text/css' media='all' />
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='googlefonts-css'  href='https://fonts.googleapis.com/css?family=Roboto:400|ABeeZee:400&subset=latin' type='text/css' media='all' />
<link rel='stylesheet' id='sumoselectcss-css'  href='https://www.ultimatebattle.in/wp-content/themes/blackfyre/css/sumoselect.css' type='text/css' media='all' />
<link rel='stylesheet' id='scrollpanecss-css'  href='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/scroll/jquery.jscrollpane.css' type='text/css' media='all' />
<link rel='stylesheet' id='ubnivo-css'  href='https://www.ultimatebattle.in/wp-content/themes/blackfyre/css/nivo-slider.css' type='text/css' media='all' />
<link rel='stylesheet' id='custom-style2-css'  href='https://www.ultimatebattle.in/wp-content/themes/blackfyre/css/jquery.bxslider.css' type='text/css' media='all' />
<link rel='stylesheet' id='vcfixes-css'  href='https://www.ultimatebattle.in/wp-content/themes/blackfyre/css/vcfixes.css' type='text/css' media='all' />
<link rel='stylesheet' id='buttons-css'  href='https://www.ultimatebattle.in/wp-includes/css/buttons.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://www.ultimatebattle.in/wp-includes/css/dashicons.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='mediaelement-css'  href='https://www.ultimatebattle.in/wp-includes/js/mediaelement/mediaelementplayer.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css'  href='https://www.ultimatebattle.in/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='media-views-css'  href='https://www.ultimatebattle.in/wp-includes/css/media-views.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='imgareaselect-css'  href='https://www.ultimatebattle.in/wp-includes/js/imgareaselect/imgareaselect.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-social-sharing-css'  href='https://www.ultimatebattle.in/wp-content/plugins/wp-social-sharing/static/socialshare.css' type='text/css' media='all' />
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/bradmax-player/assets/js/bradmax_player.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_Confirm = {"are_you_sure":"Are you sure?"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/buddypress/bp-core/js/confirm.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/buddypress/bp-core/js/widget-members.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/buddypress/bp-core/js/jquery-query.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/buddypress/bp-core/js/vendor/jquery-cookie.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/buddypress/bp-core/js/vendor/jquery-scroll-to.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var BP_DTheme = {"accepted":"Accepted","close":"Close","comments":"comments","leave_group_confirm":"Are you sure you want to leave this group?","mark_as_fav":"Favorite","my_favs":"My Favorites","rejected":"Rejected","remove_fav":"Remove Favorite","show_all":"Show all","show_all_comments":"Show all comments for this thread","show_x_comments":"Show all comments (%d)","unsaved_changes":"Your profile has unsaved changes. If you leave the page, the changes will be lost.","view":"View"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/buddypress/bp-templates/bp-legacy/js/buddypress.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.sumoselect.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/bootstrap4.min.js'></script>
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/meanmenu.js'></script>
<script type='text/javascript' src='https://code.jquery.com/ui/1.11.1/jquery-ui.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/scroll/jquery.mousewheel.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/scroll/jquery.jscrollpane.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/main.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.fancybox.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var userSettings = {"url":"\/","uid":"362242","time":"1678562996","secure":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/utils.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/plupload/plupload.full.min.js'></script>
<!--[if lt IE 8]>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/json2.min.js'></script>
<![endif]-->
<link rel='https://api.w.org/' href='https://www.ultimatebattle.in/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.ultimatebattle.in/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.ultimatebattle.in/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.3" />
<meta name="generator" content="WooCommerce 4.2.2" />
<link rel='shortlink' href='https://www.ultimatebattle.in/?p=36617' />
<link rel="alternate" type="application/json+oembed" href="https://www.ultimatebattle.in/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.ultimatebattle.in%2Ftournament%2Ffree-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.ultimatebattle.in/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.ultimatebattle.in%2Ftournament%2Ffree-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html&#038;format=xml" />

	<script type="text/javascript">var ajaxurl = 'https://www.ultimatebattle.in/wp-admin/admin-ajax.php';</script>

<!--[if IE 9]> <script>var _gambitParallaxIE9 = true;</script> <![endif]--><style type='text/css' media='screen'>
	body{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	.navbar{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	h1{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	h2{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	h3{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	h4{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	h5{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	h6{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	blockquote{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	p{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	li{ font-family:&quot;Roboto&quot;, arial, sans-serif;}
	body{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	.navbar{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	h1{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	h2{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	h3{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	h4{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	h5{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	h6{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	blockquote{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	p{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
	li{ font-family:&quot;ABeeZee&quot;, arial, sans-serif;}
</style>
<!-- fonts delivered by Wordpress Google Fonts, a plugin by Adrian3.com --><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="google-signin-client_id" content="947170542363-e3s902nn9ajj3v8i1ts8rjvl39bhhb9n.apps.googleusercontent.com" /><meta name="google-site-verification" content="z8h7UeJtu-PWGMQGRCGl3N1CFy8ZBQxZjsWT05OBDcwN-9ufqacZ0" /><meta name="title" content="A Gamer's Ecosystem Esports Company India" />
        <meta name="description" content="Ultimate Battle is an ESports platform that offers online tournaments and Gameplay for Mobile, PC, Console games in India. UB is a Gamer's Ecosystem." /><link rel="shortcut icon" href="https://www.ultimatebattle.in/wp-content/uploads/2015/02/ub-favicon-150x150.png"><link rel="manifest" href="https://www.ultimatebattle.in/manifest.json" />	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
			<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<meta name="generator" content="Powered by Visual Composer - drag and drop page builder for WordPress."/>
<!--[if IE 8]><link rel="stylesheet" type="text/css" href="https://www.ultimatebattle.in/wp-content/themes/blackfyre/js_composer/assets/css/vc-ie8.css" media="screen"><![endif]--><noscript><style> .wpb_animate_when_almost_visible { opacity: 1; }</style></noscript>	
		<script src="https://js.pusher.com/3.2/pusher.min.js"></script>	
		<script>	
			let pusher = new Pusher('367d8d2414dcf3bb5111', {cluster: 'ap2', forceTLS: true});
		</script>
			
		<script>	
			let userid = "362242";	
			pusher.subscribe(userid);	
		</script>	
			
			

						
				<!-- Global site tag (gtag.js) - Google Analytics -->	
				<script async src="https://www.googletagmanager.com/gtag/js?id=UA-86483-43"></script>	
				<script>	
				window.dataLayer = window.dataLayer || [];	
				function gtag(){dataLayer.push(arguments);}	
				gtag('js', new Date());	
				gtag('config', 'UA-86483-43');	
				</script>	
				<!-- /google analytics -->				
				
		
		<!-- Facebook Pixel Code -->	
		<script>	
		  !function(f,b,e,v,n,t,s)	
		  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?	
		  n.callMethod.apply(n,arguments):n.queue.push(arguments)};	
		  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';	
		  n.queue=[];t=b.createElement(e);t.async=!0;	
		  t.src=v;s=b.getElementsByTagName(e)[0];	
		  s.parentNode.insertBefore(t,s)}(window, document,'script',	
		  'https://connect.facebook.net/en_US/fbevents.js');	
		  fbq('init', '437099226982165');	
		  fbq('track', 'PageView');	
		</script>	
		<noscript><img height="1" width="1" style="display:none"	
		  src="https://www.facebook.com/tr?id=437099226982165&ev=PageView&noscript=1"	
		/></noscript>	
		<!-- End Facebook Pixel Code -->	
		<!-- <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>	
		<script>	
		     (adsbygoogle = window.adsbygoogle || []).push({	
		          google_ad_client: "ca-pub-1266332067754233",	
		          enable_page_level_ads: true	
		     });	
		</script> -->	
				<script>
			const loadingSpinner = (size = 30) => `<img src="${themeDir}img/loading.gif" alt="Loading..." style="width: ${size}px; height: ${size}px" />`
			const currentUserId = +"362242";
			const currentUsername = "Playunite";
			const themeDir = "https://www.ultimatebattle.in/wp-content/themes/blackfyre/";
			const siteUrl = "https://www.ultimatebattle.in/";
			const cuData = jQuery.parseJSON('{"ID":362242,"user_login":"Playunite","user_nicename":"playunite","user_email":"","mobile":"7510814791","display_name":"Playunite Krypton","verified":"1","deleted":"0"}');
			const notificationSound = "https://www.ultimatebattle.in/ubchat/sounds-900-you-know.mp3";
			const isUserLoggedIn = !!"1";
			const ues = !!+'';
		</script>
	</head>
		<body class="bp-legacy tournament-template-default single single-tournament postid-36617 single-format-standard logged-in woocommerce-no-js wpb-js-composer js-comp-ver-4.2.6 vc_responsive no-js">
				<div class="wrapper new gm _loggedin   ">
			<header id="headercontainer" class="headersection ">
				<!-- header for ultimateesports.in -->
				
				<!-- haeder for ultimatebattle.in -->
									<!-- top section of header -->
					<div class="top-app-header">
						<div class="container">
														<div class="rt-nav">
								<ul>
                                                                        <li class="organizer-name">
                                    	<a href="https://www.ultimatebattle.in/organizer.html">Organize Event</a>
                                    </li>
                                    									<li><a href="https://shop.ultimatebattle.in">Gaming Store</a></li>
									<li><a href="https://news.ultimatebattle.in/">Esports News</a></li>
									<!--<li><a href="'.base_url('redeem-coins-shop.html').'">Redeem Coins</a></li>
									<li><a href="'.base_url('career.html').'">Career</a></li>
									<li><a href="'.base_url('about-us.html').'">About Us</a></li>-->
								</ul>
							</div>
						</div>
					</div>

					<!-- bottom section of header -->
					<div class="mid-app-header">
						<div class="container">	
							<div class="row">	
								<div class="col-lg-12">	
									<!-- Logo area -->
									<div class="ublogo">
										<a href="https://www.ultimatebattle.in">
											<img src="https://www.ultimatebattle.in/wp-content/uploads/2015/02/ub-logo-beta.png" alt="Ultimate Battle - Online Gaming">
										</a>
									</div>

									<!-- Game changer switch -->
																				<div class="gm-link-wp">	
												<button class="g-changer">Game Changer</button>	
												<div class="game-select">	
													<ul>
																											<li>	
															<a href="https://www.ultimatebattle.in/stumble-guys.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2022/06/stuble-guys-game-logo.png" alt="Stumble Guys">
															</a>
														</li>
																											<li>	
															<a href="https://chess.ultimatebattle.in">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2019/02/chess-logo-rev.png" alt="Chess">
															</a>
														</li>
																											<li>	
															<a href="https://www.ultimatebattle.in/cod-mobile.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2020/03/cod-mobile-ultimate-battle.png" alt="Call of Duty Mobile">
															</a>
														</li>
																											<li>	
															<a href="https://www.ultimatebattle.in/free-fire.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/Logo-Free-Fire-MAX-1.png" alt="Free Fire Max">
															</a>
														</li>
																											<li>	
															<a href="https://www.ultimatebattle.in/valorant.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2020/09/VALORANT.png" alt="VALORANT">
															</a>
														</li>
																											<li>	
															<a href="https://www.ultimatebattle.in/fifa.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2021/08/fifa.png" alt="FIFA">
															</a>
														</li>
																											<li>	
															<a href="https://www.ultimatebattle.in/clash-royale.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2018/02/clash-royale.png" alt="Clash Royale">
															</a>
														</li>
																											<li>	
															<a href="https://www.ultimatebattle.in/mini-militia.html">	
																<img src="https://www.ultimatebattle.in/wp-content/uploads/2020/09/MINI-MILITIA-2.png" alt="MINI MILITIA">
															</a>
														</li>
																										</ul>
												</div>
											</div>
									<!-- bottom header right area -->
									<div class="UBheadrightsection">
										<!-- Download app button -->

										<!-- <a href="https://play.google.com/store/apps/details?id=com.brainpulse.ultimatebattle" target="_blank" class="ub2-app-download"><i class="fa fa-download" aria-hidden="true"></i> <span>Download</span> App</a> -->

										
										
										<a
											href="https://www.ultimatebattle.in/ub-android-app/ub.apk"
											class="ub2-app-download _mobile dwnloand-apk _da"
										>
											<i class="fa fa-download" aria-hidden="true"></i> <span>Download</span> App
										</a>

										<a
											href="https://www.ultimatebattle.in/ub-android-app/ub.apk"
											class="ub2-app-download _desktop _da"
										>
											<i class="fa fa-download" aria-hidden="true"></i> <span>Download</span> App
										</a>


										<!-- Mobile menu -->
										
										<!-- Login / Register box -->
										        <div class="user-dashboard-infoarea">   
            <div class="user-login-profile">    
                <div class="user-login-bx"> 
                    <figure><div class=' avatar-letter PK' style='display: block; margin-left: auto; margin-right: auto; width: 50px; height: 50px; font-size: 25px; text-align: center; line-height: 50px; background-color: #1c1521; color: #FFF'>PK</div></figure>
                    <h3>Playunite Krypton</h3>
                    <span class="name"><em>@Playunite</em></span>
                </div>
                <div class="usr-dash-sblist">
                                            <div class="user-profile-edit">
                            <ul class="profile-edit-info">
                                <li class="view-profile">
                                    <a href="https://www.ultimatebattle.in/members/playunite/">View Profile</a>
                                </li>

                                <li class="edit-profile">
                                    <a href="https://www.ultimatebattle.in/edit-profile.html">Edit Profile</a>
                                </li>

                                
                                <li class="change-pass">
                                    <a href="https://www.ultimatebattle.in/edit-profile.html?tab=change_password">Change Password</a>
                                </li>

                                <li class="game-pref">
                                    <a href="https://www.ultimatebattle.in/edit-profile.html?tab=network_ids">Game IDs</a>
                                </li>
                                
                                <li class="my-wallet">
                                    <a href="https://www.ultimatebattle.in/my-wallet.html">My Wallet</a>
                                </li>

                                                            </ul>
                        </div>
                                        <div class="col-btn">
                        <a href="https://www.ultimatebattle.in/wp-login.php?action=logout&amp;redirect_to=https%3A%2F%2Fwww.ultimatebattle.in&amp;_wpnonce=eabde6dc38">Logout</a>
                    </div>  
                </div>  
            </div>

            
                        <div class="paytm-wallet ">
                <a href="https://www.ultimatebattle.in/my-wallet.html">
                                            <span class="get-deposit-cash">
                            Rs. 0                            <small> Deposits</small>
                        </span>
                        <span class="get-bonus-cash">
                            Rs. 0                            <small> Winning</small>
                        </span>
                                    </a>
            </div>
            
                            <div class="_ubncw">
                    <div class="_ubnc">
                        <i class="fa fa-2x fa-bell">
                                                    </i>
                    </div>
                    <div class="_bell-notif-box">
                        <div class="bell-bar">
                            <p class="text-right"><small><a href="#" class="_mark-all-read">Mark all as read</a></small></p>
                        </div>
                        <ul>
                                                    </ul>
                    </div>  
                </div>                <div class="vip-component">
                    <a href="https://www.ultimatebattle.in/subscription.html">
                                                    <img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/ub-get-vip.png" />
                                            </a>
                </div>
        </div>									</div>
								</div>
							</div>
						</div>
					</div>
							</header>

            
			<meta property='og:image' content='https://www.ultimatebattle.in/wp-content/uploads/2019/09/freefire-max-game-page-banner.png' /><section class="_ubs-game-banner-wraper _sh">
    <div class="game-nav">
        <div class="container">
            <div class="games-logo">
                <a href="https://www.ultimatebattle.in/free-fire.html"><img src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/Logo-Free-Fire-MAX-1.png" alt="" /></a></div>
            <div class="games-navigation"><ul><li class="c1 _gpsn-tournament-listing"><a href="https://www.ultimatebattle.in/free-fire/tournaments.html">Tournaments</a></li></li><li class="c3 _gpsn-leaderboard"><a href="https://www.ultimatebattle.in/free-fire/leaderboards.html">Leaderboard</a></li></li><li class="c4-2 _gpsn-coins-redeem-store"><a href="https://www.ultimatebattle.in/redeem-coins-shop.html">Redeem Coins</a></li></li><li class="c5 _gpsn-how-it-works"><a href="https://www.ultimatebattle.in/how-it-works.html">How It Works</a></li></li></ul></div>
            <button class="game-menu-trigger"><i class="fa fa-bars"></i></button>
        </div>
    </div>
    <div
        class="_ubssingleinfo _t pt-3"
        style="background: url(https://www.ultimatebattle.in/wp-content/uploads/2019/09/freefire-max-game-page-banner.png) center top no-repeat; background-size: cover"
    >
        <div class="container"></div>
    </div>
</section><div id="tournament-detail-bar" class="ub-tournament-bx-info prize-tournament-model">
        <div class="container">
              <div class="ub-game-free">
                <div class="ub-join-btn"><div class="_tpm"><small><span class="ub-coin-icon">200</span><sub>Coins</sub></small></div><div class="_tjb"><a href="javascript:void(0)" data-tournament="36617" data-user="362242" class="get-network-id network_id_not_found">Join - <span class="_tj-fee">Free</span></a><div class="ub-tooltip"></div></div><div class="_t-players">Players: <strong>53/90</strong></div>
                </div>
            </div>
            <div class="jb-left">
                <div class="ub-strt-info ub-left">
                    <h4  class="_t-s">Registration ends</h4>
                    <span class="ub-date">Mon, 13 Mar</span>
                    <span class="ub-time">11:40 am</span>
                </div>
                <div class="ub-strt-info ub-left">
                    <div class="_jbi">
                        <h4>Platform</h4>
                        <span class="ub-date">FFM MOBILE</span>
                    </div>
                </div>
            </div>
        
            <div class="jb-right"><div class="ub-strt-info ub-left">                        
                    <h4>Team size</h4>
                    <span class="ub-date">Solo - Battle Royale</span>
                </div>
                <div class="ub-strt-info ub-right">
                    <div class="_jbi">
                        <h4 class="_t-s">Tournament starts</h4>
                        <span class="ub-date">Mon, 13 Mar</span>
                        <span class="ub-time">12:00 pm</span>
                    </div>
                </div>
            </div>
        </div>
    </div><p>&nbsp;</p><section id="breadcrumb-info-bx"><div class="container"><a href="https://www.ultimatebattle.in">Home</a> / <a href="https://www.ultimatebattle.in/tournaments.html">Tournaments</a> / FREE FIRE MAX FUN SERIES</div></section><div class="page-head-component-app">
    <div class="container">
        <!-- Tournament Clan Join alert -->
        <div class="row"><div class="col-md-3 col-sm-3">
                <div class="venue-tid-wrap">
                    <div class="venue-tid--">
                        <span>Venue:</span>Online
                    </div>
                    <div class="tour-id">
                        ID: 36617
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-sm-6">
                <h1>FREE FIRE MAX FUN SERIES</h1></div>

            <div class="col-md-3 col-sm-3">
                <p class="text-right pull-right"> <button class="btn btn-sm ub-btn-dark-red" onclick="chat(108, 'ultimatebat', 'UB Support', 'Hi! I have an issue with Tournament ID: #36617 of Game Free Fire Max.')">Report issue</button></p>
            </div>
        </div></div>
</div>
    <section id="gamesection">
        <div class="container">
            <div class="tournament-game-wrap ubmatcharea">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="faster-bracket-note-wrap"></div>
                    </div>
                </div>

                <div class="row">
                    <!-- Match area -->
                    <div class="col-lg-6 tournament-match-area-wrapper">
                                            </div>

                    <!-- Chat -->
                                            <div class="col-lg-6 tournament-chat-wrapper">
                                                    </div>
                                    </div>
            </div>
        </div>
    </section>
    <section id="ga_single_tournament" class="_ga-section">
      <div class="container">
          <div class="row">
              <div class="col-lg-12">
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1266332067754233" data-ad-slot="5159889730" data-ad-format="horizontal" data-full-width-responsive="false"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
              </div>
          </div>
      </div>
    </section><!-- Teams for tournament -->
<section id="touenament-team-members" class="light clear">
    </section>
<!-- /Teams for tournament -->

<section id="gamesection" class="_ubs-process _s">
    <div class="container">
        <div class="row"><div class="col-lg-8"><div class="geme-category">
                    <div id="horizontalTab"><ul class="tabs tabcontent"><li><a href="#tabOverview"><h2>Overview</h2></li><li onclick="displayPools()"><a href="#tabBracket"><h2>Player Group</h2></a></li><li><a href="#tabRules"><h2>Rules</h2></a></li></ul><div id="tabOverview" class="tab-display"><div class="_prize-dis">
                                            <h3 class="mtc">Match Settings</h3>
                                            <div class="_mx_prize_row">
                                                <div class="row"><div class="col-md-6">
                                                            <div class="_mx_prize_mx">
                                                                <p><strong>Minimum Participants:</strong> 40 </p>
                                                            </div>
                                                        </div><div class="col-md-6">
                                                            <div class="_mx_prize_mx">
                                                                <p>
                                                                    <strong>Number of Macthes:</strong> KO</p>
                                                            </div>
                                                        </div><div class="col-md-6">
                                                            <div class="_mx_prize_mx">
                                                                <p><strong>Participation Type:</strong> Solo</p>
                                                            </div>
                                                        </div><div class="col-md-6">
                                                            <div class="_mx_prize_mx">
                                                                <p><strong>Game Map:</strong> Bermuda</p>
                                                            </div>
                                                        </div><div class="col-md-6">
                                                                <div class="_mx_prize_mx">
                                                                    <p><strong>Game Mode:</strong> Battle Royale</p>
                                                                </div>
                                                            </div></div>
                                            </div>
                                        </div><div class="_prize-dis">
                                        <h3 class="prize">Winning Prize</h3>
                                        <div class="_mx_prize_row">
                                            <div class="row"><div class="col-lg-4">
                                                                <div class="_mx_prize_bx">
                                                                    200 UB Coins
                                                                    <span>Max Prize Pool</span>
                                                                </div>
                                                            </div><div class="col-lg-4">
                                                        <div class="_mx_prize_text">
                                                            <p>Prize will be distributed after finale round end time.</p>
                                                        </div>
                                                    </div></div>                                                                                        <div class="_rcs-note">
                                            <!-- <p><i class="fa fa-hand-o-right"></i> Only VIP Members can use UB Coins in Redeem Shop</p> -->
                                            </div>
                                                                                        <div class="redeem-shop-strip">
                                                <a href="https://www.ultimatebattle.in/redeem-coins-shop.html">
                                                    <img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/redeem-shop-img2.jpg" alt="Redeem shop" class="dx">
                                                    <img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/redeem-coins-banner-on-tournament-page-mobile-view-m.jpg" alt="Redeem shop" class="mb">
                                                </a>
                                            </div>
                                            <div class="_ub_component_list"><table class="table prize-distribution-overview table-bordered table-sm">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Prize Distribution</th>
                </tr>
            </thead>
            <tbody><tr>
                    <td>1</td>
                    <td>75 <span class="ub-coin-icon"></span></td>
                </tr><tr>
                    <td>2</td>
                    <td>55 <span class="ub-coin-icon"></span></td>
                </tr><tr>
                    <td>3</td>
                    <td>40 <span class="ub-coin-icon"></span></td>
                </tr><tr>
                    <td>4</td>
                    <td>20 <span class="ub-coin-icon"></span></td>
                </tr><tr>
                    <td>5</td>
                    <td>10 <span class="ub-coin-icon"></span></td>
                </tr></tbody>
        </table></div></div>
                                    </div></div><div id="tabBracket" class="tab-display" style="display: none"><div id="pool_box">
                                        <p class="text-center"><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" alt="Loading..." style="width: 50px; height: 50px" /><br />Loading...</p>
                                    </div></div><div id="tabRules" class="tab-display" style="display: none">
                                <div><p>&nbsp;</p>
<h2>Tournament Rules</h2>
<p>&nbsp;</p>
<p><strong><span style="text-decoration: underline;">Check-in</span>:-</strong></p>
<ul>
<li><strong>Check-in</strong> is compulsory for every participant in every round</li>
<li>In case a participant fails to check in, he’ll be <strong>disqualified</strong>.</li>
<li>In the case of a participant who has joined for their match but had not checked in, the participant will not be ranked for their match.</li>
</ul>
<hr />
<p><b><span style="text-decoration: underline;">How to play for Battle Royale</span>:-</b></p>
<ul>
<li>Check-in for your event which starts <strong>20 min</strong> prior to the player&#8217;s specific Round time</li>
<li>Get in touch with the admin via Website group chat.</li>
<li><strong>Room id</strong> and <strong>Password</strong> will be visible after check-in.</li>
<li>Check the match area for <strong>Room id</strong> and <strong>Password</strong>.</li>
</ul>
<hr />
<p><strong><span style="text-decoration: underline;">Game Rules</span>:-</strong></p>
<ul>
<li>Players Below <strong>40 Level</strong> rank will not be allowed to play any match and will be <strong>banned</strong> from the room.</li>
<li>A minimum of <strong>10 players</strong> are required to start the match or else it shall be deemed canceled.</li>
</ul>
<hr />
<p><b><span style="text-decoration: underline;">Ranking</span>:-</b></p>
<ul>
<li>Ranking will be done according to <strong>Point System</strong> unless mentioned otherwise.</li>
<li>For a <strong>BO3</strong> Series, the sum of total points from <strong>3 matches</strong> will be calculated and players will be ranked according to their accumulated points.</li>
</ul>
<hr />
<p><strong><span style="text-decoration: underline;">Point System</span>:-</strong></p>
<ul>
<li><strong>Kill Points:- 1 Point per Kill</strong></li>
</ul>
<p><strong>Survival Points</strong>:-</p>
<table style="height: 322px;" border="1px" width="211">
<tbody align="center">
<tr>
<th><strong>Rank</strong></th>
<th><strong>Points</strong></th>
</tr>
<tr>
<td><strong>1</strong></td>
<td><strong>15</strong></td>
</tr>
<tr>
<td><strong>2</strong></td>
<td><strong>12</strong></td>
</tr>
<tr>
<td><strong>3</strong></td>
<td><strong>10</strong></td>
</tr>
<tr>
<td><strong>4</strong></td>
<td><strong>8</strong></td>
</tr>
<tr>
<td><strong>5</strong></td>
<td><strong>6</strong></td>
</tr>
<tr>
<td><strong>6</strong></td>
<td><strong>4</strong></td>
</tr>
<tr>
<td><strong>7</strong></td>
<td><strong>2</strong></td>
</tr>
<tr>
<td><strong>8</strong></td>
<td><strong>1</strong></td>
</tr>
<tr>
<td><strong>9</strong></td>
<td><strong>1</strong></td>
</tr>
<tr>
<td><strong>Below 9</strong></td>
<td><strong>0</strong></td>
</tr>
</tbody>
</table>
<hr />
<p><b><span style="text-decoration: underline;">Cheating</span>:-</b></p>
<ul>
<li>Use of <strong>emulators</strong> and/or any other device(s) giving an unfair advantage to players is not allowed in the tournament. (<strong>Emulators are only allowed in emulator-specific tournaments</strong>)</li>
<li>Players found using <strong>hacks</strong> and/or <strong>mods</strong> will be disqualified from the tournament and/or players will be banned from the platform for a certain duration.</li>
<li><strong>Teaming up</strong> with other players/squads in a tournament will lead to <strong>disqualification</strong> and/or players will be <strong>banned</strong> from the platform for a certain duration.</li>
</ul>
<hr />
<p><b><span style="text-decoration: underline;">Technical Issue</span>:-</b></p>
<ul>
<li>It is the player’s responsibility to check their device before starting their match.</li>
<li>Any disconnection issue(s) while being in the lobby or from the game will not be entertained unless the same issue(s) is/are faced by a major number of players.</li>
</ul>
<hr />
<p><b><span style="text-decoration: underline;">Scheduling:</span>&#8211;</b></p>
<ul>
<li>Players are advised to check their exact Match time for their Pool on the day of the tournament.</li>
<li>SMS/Mail notifications will be sent to players relaying their schedule, but it’s the player’s responsibility to be updated with the timings of their specific Pool.</li>
<li>Issue(s) regarding schedule change will not be entertained.</li>
</ul>
<p><strong>Please note: The registration fee is not refundable in case you don’t participate in the tournament.</strong></p>
</div>
                                </div></div>
                </div>
            </div><div class="col-lg-4"><div class="_st-shop-banner">
                    <a href="https://news.ultimatebattle.in" target="_blank">
                        <!--<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/ultimatebattle-shop.jpg" />-->
                        <img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/ultimate-battlenews.jpg" />
                    </a>
                </div><h3 class="hw-it-works">How it works?</h3>
                <div class="howitwork-wrapper"><div class="howitwork-process">
<div class="process-wrap-info">
<div class="process-bx-1 position-right">
<div class="icon"><i class="fa fa-user"> </i></div>
<div class="process-num"><span class="">1</span></div>
<h4 class="right animation-element ">Check-In for your Match</h4>
<p class="right animation-element ">Check-In button is available in MATCH AREA on the Tournament Page at your Match Round Time.</p>
</div>
</div>
<div class="process-wrap-info">
<div class="process-bx-1 offset-top position-right">
<div class="icon"><i class="fa fa-gamepad"> </i></div>
<div class="process-num"><span class="">2</span></div>
<h4 class="right animation-element ">Join Game Room to Play</h4>
<p class="right animation-element ">Room ID and Password will show in Match Area 20 min before Round Time.</p>
</div>
</div>
<div class="process-wrap-info">
<div class="process-bx-1 offset-top position-right">
<div class="icon"><i class="fa fa-bullhorn"> </i></div>
<div class="process-num"><span class="">3</span></div>
<h4 class="right animation-element ">Play your Match</h4>
<p class="right animation-element ">Play your match after joining the Room. Keep a screenshot of your scoreboard.</p>
</div>
</div>
<div class="process-wrap-info">
<div class="process-bx-1 offset-top position-right">
<div class="icon"><i class="fa fa-money"> </i></div>
<div class="process-num"><span class="">4</span></div>
<h4 class="right animation-element ">Winner Prize Distribution</h4>
<p class="right animation-element ">Once the Match is over, Winners are announced and Winning Amount is credited to Winner’s Wallet.</p>
</div>
</div>
</div>
</div>
            </div></div></div>
</section><section id="tournament-list-related">
  <div class="container">
    <h2 class="h2_heading">Free Fire Max <span>Tournaments</span></h2>
    <div class="tournament-category">
      <ul>
        <div class="_gtlw-wrap">
            <div class="tournament-table-information33">
                <div class="ub-tournament-game-table333">
                    <table
                        width="100%"
                        border="0"
                        cellpadding="0"
                        cellspacing="0"
                        id="table-related-tournaments"
                        class="mt-0"
                    >
                        <thead>
                            <tr><th width="4%" class="series-type-h">&nbsp;</th><th width="4%" class="tid-h">TID</th><th width="25%" class="title-h">Title</th><th width="15%" class="type-h" style="text-align: center">Type</th><th width="12%" class="platform-h" style="text-align: center">Platform</th><th width="15%" class="start-time-h">Start Time</th><th width="6%" class="participants-h" style="text-align: center">Participants</th><th width="10%" class="reg-fee-h">Reg. Fee</th><th width="10%" class="prize-pool-h">Prize Pool</th><th width="11%" class="action-h">&nbsp;</th></tr>
                        </thead>
                        <tbody><tr class="_gt-row _gt-fun _free"><td class="tbl-td-1 series-type-d">fun</td><td class="tbl-td-2 tid-d">36625</td><td class="tbl-td-3 title-d"><a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins-2.html">FREE FIRE MAX FUN SERIES</a></td><td class="tbl-td-4 type-d" style="text-align: center">Solo - Battle Royale</td><td class="tbl-td-4 platform-d" style="text-align: center">FFM MOBILE</td><td class="tbl-td-6 start-time-d"><span class="day-name">tomorrow</span>, <strong>6:00 PM</strong></td><td class="tbl-td-5 participants-d" style="text-align: center">
                                        <strong>21/90</strong>
                                    </td><td  class="tbl-td-7 fee-d" style="text-align: center"><div class="tbl-fee">Free</div></td><td class="tbl-td-8 prize-d" style="text-align: center">
                                            <div class="_prize-coins"><strong><div class="total-game-prize-pull-left"><span class="ub-coin-icon">200<sub>Coins</sub></span></div></strong></div>
                                        </td><td  class="tbl-td-9 action-d"><a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins-2.html" class="more-view-link view-tourney-btn  Join " data-mesg="">Join</a>
                                    </td></tr><tr class="_gt-row _gt-fun _free"><td class="tbl-td-1 series-type-d">fun</td><td class="tbl-td-2 tid-d">36288</td><td class="tbl-td-3 title-d"><a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-24-feb-2023.html">FREE FIRE MAX-WEEKLY BATTLE CUP</a></td><td class="tbl-td-4 type-d" style="text-align: center">Solo - Battle Royale</td><td class="tbl-td-4 platform-d" style="text-align: center">FFM MOBILE</td><td class="tbl-td-6 start-time-d">14<sup class="date-ordinal-indicator">th</sup> Mar, <strong>3:00 PM</strong></td><td class="tbl-td-5 participants-d" style="text-align: center">
                                        <strong>352/630</strong>
                                    </td><td  class="tbl-td-7 fee-d" style="text-align: center"><div class="tbl-fee">Free</div></td><td class="tbl-td-8 prize-d" style="text-align: center">
                                            <div class="_prize-cash"><strong><div class="total-game-prize-pull-left"><i class="fa fa-inr"></i> 1000</div></strong></div>
                                        </td><td  class="tbl-td-9 action-d"><a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-24-feb-2023.html" class="more-view-link view-tourney-btn  Join " data-mesg="">Join</a>
                                    </td></tr></tbody>
                    </table>
                </div>
            </div>
        </div><div class="_gtlm-wrap"><div class="mobile-datalist-table _gt-row _gt-fun _Solo-Battle-Royale">
				    <div class="_stype"><span class="t-s-z">Solo - Battle Royale</span>  <span class="_u_date"><span class="day-name">tomorrow</span> <span class="_ts-time">6:00 PM</span></span></div>
				   
                    <div class="_ub_tournament_list_l">
                        <h3><a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins-2.html">FREE FIRE MAX FUN SERIES</a></h3>
                        <p class="_p_row"><span class="tid">TID: 36625</span></p>
                        <div class="_ub_prize-mob">
                            <span class="_u">PRIZE</span><span class="_r"><span class="ub-coin-icon"></span>200<sub>Coins</sub></span> <span class="_u_player"><i class="fa fa-user-circle-o" aria-hidden="true"></i> 21/90</span></div>
                    </div><div class="_ub_tournament_list_R">
                        <div class="_u-btn Join ">
                            <a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins-2.html" class="">Join <small>Free</small></a>
                        </div>
                    </div>
                </div><div class="mobile-datalist-table _gt-row _gt-fun _Solo-Battle-Royale">
				    <div class="_stype"><span class="t-s-z">Solo - Battle Royale</span>  <span class="_u_date">14<sup class="date-ordinal-indicator">th</sup> Mar <span class="_ts-time">3:00 PM</span></span></div>
				   
                    <div class="_ub_tournament_list_l">
                        <h3><a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-24-feb-2023.html">FREE FIRE MAX-WEEKLY BATTLE CUP</a></h3>
                        <p class="_p_row"><span class="tid">TID: 36288</span></p>
                        <div class="_ub_prize-mob">
                            <span class="_u">PRIZE</span><span class="_r"><i class="fa fa-inr"></i> 1000</span> <span class="_u_player"><i class="fa fa-user-circle-o" aria-hidden="true"></i> 352/630</span></div>
                    </div><div class="_ub_tournament_list_R">
                        <div class="_u-btn Join ">
                            <a href="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-24-feb-2023.html" class="">Join <small>Free</small></a>
                        </div>
                    </div>
                </div></div>      </ul>
    </div>
  </div>
</section>
<!-- Game News -->
<section id="gameNews"></section>
<div id="join_modal" class="modal fade" role="dialog">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<button type="button" class="btn btn-default _modelclose" data-dismiss="modal">X</button>
					<div class="model-join-tournament">
						<div class="_ub-head_madel">
							<figure><img src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/freefire-max-game-page-banner-498x114.png" /></figure>
							<div class="_ub_head_model-title">
								<h2>FREE FIRE MAX FUN SERIES</h2></div>
						</div>
						<div class="model-confirm-box">
							<form action="https://www.ultimatebattle.in/join-tournament.php" method="post" onsubmit="return submitJoinBattleForm()">
								<input type="hidden" name="tournament_id" value="36617">
								<input type="hidden" name="user_id" value="362242">
								<input type="hidden" name="tournament_join_option" value="ub_wallet">

								<div class="join-tournament-msg"></div>

								<p class="joinbattle text-center"><button type="submit" class="join-battle join-tournament-btn" name="join_battle">Join Tournament</button></p>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div><div id="qualifierJoinModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body-ub">
        <h5>You are joining</h5>
        <h3 class="modal-title qualifier-title"></h3>
        <p class="qualifier-start-time"></p>
        <div class="_u_btn qualifier-join-button"></div>
      </div>
    </div>
  </div>
</div>
<div id="get_network_modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <div class="model-bx">
                        <h3>Free Fire In-Game Username:</h3>
                        <div class="modal-box-inner"><input type="text" id="network_id" name="network_id" value="" placeholder="ex: abcd1234" class="form-control ffm_mobile-label" /><a href="javascript:gamerIdHelp()" class="_help-anchor" title="Help?"><i class="fa fa-question-circle"></i></a><small class="error error-text"></small><p class="text-left"><small><i class="fa fa-info-circle" style="color: #a00404"></i> Network ID is your <strong>UID / IN GAME USERNAME / PSN ID</strong> depends upon the game.</small></p>
                                <p class="text-left" style="padding-top: 0; margin-top: 3px"><small><i class="fa fa-info-circle" style="color: #a00404"></i> Players with Game names Containing inappropriate and/or derogatory/offensive word(s) will not be allowed inside game rooms.</small></p>
                                <p><input type="submit" name="save_network_id" value="Save" onclick="saveNetworkId()" data-tournament="36617" data-user="362242" class="btn ub-btn-dark-red" /> <button class="btn btn-default" data-dismiss="modal">Cancel</button></p></div>
                    </div>
                </div>
            </div>
        </div><div id="join_error_modal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="position: absolute;right: 0;top: 0;z-index: 9;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div id="join-error-msg" class="modal-body" style="font-size: 20px"></div>
            </div>
        </div>
    </div><div id="tournamentJoinModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
      <div class="join_now_model">
        <div class="_ubs_model_head">
          <div class="_ubs_model_row sorry">
            <h3>Sorry</h3>
            <p></p>
          </div>
          <div class="_tjar-points clear alert alert-info">
            <ul>
              <li>The Tournament can be Rescheduled / Canceled if the minimum participant criteria are not
                fulfilled.</li>
              <li>In case the tournament is canceled, money will be refunded to your wallet.</li>
            </ul>
          </div>
                    <div class="_tjrgam"><section id="ga_tournament-join-result-modal" class="_ga-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1266332067754233" data-ad-slot="3964381656" data-ad-format="rectangle" data-full-width-responsive="true"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>
        </div>
    </section></div>
                              <p class="text-right">
            <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
            <a href="https://www.ultimatebattle.in/subscription.html" target="_blank"
                            class="btn btn-primary">Get Subscription</a> </p>
                  </div>
      </div>
    </div>
  </div>
</div>
<script>
jQuery(".cl-networks-wrap input[name='ch_network']").on('change', function() {
    $network = jQuery(".cl-networks-wrap input[name='ch_network']:checked");
    if ($network.val()) {
        jQuery("#clNetworkForm").submit();
    }
});
</script>
<!-- Report issue modal -->
<div id="createClanModal" class="modal ub-model-form" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h2 class="modal-title">REGISTER CLAN TO JOIN</h2>
                        <p class="clear">This is a Clan (Team Size: 0) Tournament. Please create a clan and provide clan member details to proceed and join the Tournament.</p>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table no-border">
                            <tbody>
                                <tr>
                                    <td colspan="4">
                                        <label for="game_clan_name">Clan Name:</label>
                                        <input type="text" id="game_clan_name" name="game_clan_name" class="form-control" placeholder="Enter Clan name" />
                                        <span id="clan_availability"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="4" class="_clan-members">Members:</th> 
                                </tr>
                                <tr>
                                    <th></th>
                                    <th>Name</th>
                                    <th>Ffm Mobile ID (<a href="javascript:gamerIdHelp()">Help?</a>)</th>
                                    <th>Phone</th> 
                                </tr></tbody> 
                        </table>
                        <p class="team-invite-note">Team invite SMS will be sent to above players. Please ensure they signin/register with provided numbers to join your Team.</p>
                        <p class="model-note">Please ensure gamer ids are correct to avoid problem in server joining/prize distribution.</p>
                    </div>
                    <div class="modal-footer">
                        <span class="_processing"></span>
                        <input type="hidden" name="clabn_to_join_tournament" id="clan_to_join_tournament" value="36617" />
                        <button type="button" name="create_clan" class="btn ub-btn-dark-red">Create and Proceed</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div><div id="chooseClanMembersModal" class="modal ub-model-form" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h2>CLAN MEMBERS</h2>
                         <p class="clear">This is a Clan (Team Size: 0) Tournament. Please provide details of team members who will play in the tournament.</p>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h4 class="_user-clan-name">Your Free Fire Max Clan: <h4/>
                        <h5 class="_clan-member-details">Member Deatils</h5>
                        <table class="table no-border">
                            <tbody></tbody>
                        </table>
                        <p class="team-invite-note">Team invite SMS will be sent to above players. Please ensure they signin/register with provided numbers to join your Team.</p>
                        <p class="model-note">Please ensure gamer ids are correct to avoid problem in server joining/prize distribution.</p>
                    </div>
                    <div class="modal-footer">
                        <span class="_processing"></span>
                        <input type="hidden" name="clabn_to_join_tournament" id="clan_to_join_tournament" value="36617" />
                        <button type="button" name="save_clan_participants" class="btn ub-btn-dark-red">Save and Proceed</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div><div id="teamMembersModal" class="modal ub-model-form" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">Team members</h2>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h4 class="_user-clan-name">Your Free Fire Max Clan: <h4/>
                        <h5 class="_clan-member-details">Member Deatils</h5>
                        <div class="clan-members-table-wrap"><p class="text-center alert"><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" alt="Loading..." style="width: 30px; height: 30px" /></p></div>
                    </div>
                </div>
            </div>
        </div><div id="gamerIdHelp" class="modal ub-model-form" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h2 class="modal-title">Ffm Mobile ID Help</h2>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body"><p><a href="https://www.ultimatebattle.in/wp-content/uploads/2019/09/game-name-.png"><img class="alignnone size-full wp-image-20856" src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/game-name-.png" alt="" /></a></p>
</div>
                </div>
            </div>
        </div><div id="reportscoremodal"></div><div id="reportfoulplaymodal"></div><script>
const variables = {
    userId: '362242',
    userName: 'Playunite',
    userDisplayName: 'Playunite Krypton',
    tournamentId: '36617',
    tournamentType: 'solo',
    coinParticipation: '0',
    feeCash: '0',
    feeCoins: '0',
    participants: '53',
    maxParticipants: '90',
    gameId: '12670',
    network: 'ffm_mobile',
    clanSize: '0',
    userClan: '',
    clanTitle: '',
    clanLink: '',
    maxQualifiersToJoin: '',
    utjs: 'network_id_not_found',
    userCash: '0',
    fromDeposit: '0',
    userCoins: '0',
    userBracket: '',
    regCoins: '',
    applicableBonusCash: '0',
    amountToJoin: '0',
    fromWallet: '0',
    remainingCash: '0',
    roomId: '8hMcmNHszMTS7u8cT',
    channel: 'Free_Fire_Max_Tournament_FUN_Series_10_Mar_2023_Prize_200_Coins_1678363156',
    rocketAdminUsername: 'ultimatebat',
    buttonData: jQuery('._tjb > a').html(),
    tournamentData: '{"post_name":"free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins","post_author":"108","post_parent":"0","tournament_id":"36617","game_id":"12670","network":"ffm_mobile","maps":["15"],"other_settings":{"game_mode":"Battle Royale"},"bracket_elimination":"single elimination","h1_title":"FREE FIRE MAX FUN SERIES","is_online":"1","type":"solo","clan_size":"0","participant_group_type":"pool","faster_bracket":"0","participation_type":"fixed","third_place_match":"0","venue":"","min_participants":"40","max_participants":"90","team_size":"Solo - Battle Royale","match_type":"ko","aiel":"0","bonus_cash":"0","participation_open_time":"2023-03-09 11:45:15","participation_close_time":"2023-03-13 11:40:00","tournament_start_time":"2023-03-13 12:00:00","tournament_start_time_unix":"1678689000","qualifying_players":"winner","checkinwaittime":"900","fee_cash":"0","coin_participation":"0","fee_coins":"0","prize_type":"fixed","max_prize_pool_cash":"0","max_prize_pool_coins":"200","current_prize_pool_cash":"0","current_prize_pool_coins":"200","other_prize":"","other_prize_amount":"0","prize_distribution_note":"","subscription":"0","series_type":"fun","state":"pending","total_winners":"5","organized_by":null,"invitational":"0","url":"https:\/\/www.ultimatebattle.in\/tournament\/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html"}',
    mode: 'live',
    aiel: 0}
</script>
<script>
let {userId, userName, userDisplayName, tournamentId, tournamentType, coinParticipation, feeCash, feeCoins, participants, maxParticipants, gameId, network, clanSize, userClan, clanTitle, clanLink, maxQualifiersToJoin, utjs, userCash,userDepositedCash, userCoins, userBracket, regCoins, applicableBonusCash, amountToJoin, fromWallet,fromDeposit, remainingCash, roomId, channel, rocketAdminUsername, buttonData, tournamentData, mode, aiel} = variables

tournamentData = JSON.parse(tournamentData)

amountToJoin = +amountToJoin
applicableBonusCash = +applicableBonusCash
clanSize = +clanSize
coinParticipation = !!+coinParticipation
feeCash = +feeCash
feeCoins = +feeCoins
fromWallet = +fromWallet
gameId = +gameId
maxParticipants = +maxParticipants
maxQualifiersToJoin = +maxQualifiersToJoin
participants = +participants
regCoins = +regCoins
remainingCash = +remainingCash
tournamentId = +tournamentId
userBracket = +userBracket
userCash = +userCash
userDepositedCash = +userDepositedCash
userCoins = +userCoins
userClan = +userClan
userId = +userId
aiel = !!+aiel


let interval

let tournamentToJoin, userToJoinTournament

const verifyMyDate = d => {
    let re = /^\d{4}-(0[1-9]|1[0-2])-([0-2]\d|3[01]) (0\d|1\d|2[0-3]):[0-5]\d:[0-5]\d$/;    
    return re.test(d);
}

function sendOppChatMessage(recipientUsername, chatMessage) {
    let d = new Date();
    let hr = d.getHours();
    let min = d.getMinutes();
    let meridian = (hr < 12) ? 'am' : 'pm';
    let hours = (hr > 12) ? hr - 12 : hr;
    let minutes = (min < 10) ? "0"+min : min;
    let current_chat_time = hours+':'+minutes+' '+meridian;
    let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();

    let chatMessage2 = createLink(chatMessage);
    let messageClass = 'chatline'+Date.now();
    let chat_date_str;

    let headerId = '#h_'+currentUsername.replace('.', '')+'_'+recipientUsername.replace('.', '');
    if (jQuery('#oppchatwrap').find(headerId).length > 0) {
        chat_date_str = '';
        if (jQuery("#oppchatwrap #oppchatbody").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
            chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
        }
        jQuery('#oppchatwrap #oppchatbody .current-chats').append(`${chat_date_str}<div class="message-strip sent"><div class="msg pending ${messageClass}">${chatMessage2}<span class="_dct">${current_chat_time}</span><small class="chat-status"><i class="fa fa-spinner fa-pulse"></i></small></div></div>`);
        jQuery('#oppchatwrap #oppchatbody').animate({scrollTop: 100000}, 'normal');
    }

    // let chatBoxId = '#chatbox_'+currentUsername.replace('.', '')+'_'+recipientUsername.replace('.', '');
    // if (jQuery("#chatbox_container").find(chatBoxId).length > 0) {
        chat_date_str = '';
        if (jQuery("#oppchatwrap .chat-body").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
            chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
        }
        jQuery('#oppchatwrap .chat-body .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg pending '+messageClass+'">'+chatMessage2+'<span class="_dct">'+current_chat_time+'</span><small class="chat-status"><i class="fa fa-spinner fa-pulse"></i></small></div></div>');
        jQuery('#oppchatwrap .chat-body').animate({scrollTop: 100000}, 'normal');
    // }

    jQuery.get(
        siteUrl+"ubchat/index.php",
        {action: 'send', sendTo: recipientUsername, me: currentUsername, message: chatMessage},
        function(response){
            if ('success' == response) {
                playBeep()
                jQuery(`.${messageClass} small.chat-status`).remove()
                jQuery(`.${messageClass}`).removeClass('pending')
                jQuery.get(`${siteUrl}ubchat/ajax.php`, {action: 'update_recent_chats', from: currentUsername, to: recipientUsername }, function(response) {})
            } else {
                jQuery(`.${messageClass} small i.fa-spinner`).addClass('fa-exclamation-circle')
                jQuery(`.${messageClass} small i`).removeClass('fa-spinner fa-pulse')
                jQuery(`.${messageClass} small i.fa-exclamation-circle`).attr('title', 'failed')
                let errorText = `<div class="chat-error-strip"><p><i class="fa fa-warning"></i> '+response+'</p></div>`
                // jQuery(`#oppchatwrap #oppchatbody .current-chats`).append(errorText)
                jQuery.get(`${themeDir}ajax.php`, {action: 'create_rocket_token'}, function(token){})
            }
        }
    );
}

/**
 * [createLink make urls clicable in a string]
 * @param  {string} text [string without clickable urls]
 * @return {string}      [string with clicable urls]
 */
function createLink(text) {
    let exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
    let text1 = text.replace(exp, "<a href='$1'>$1</a>");
    let exp2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
    return text1.replace(exp2, '$1<a target="_blank" href="http://$2">$2</a>');
}

function gamerIdHelp() {
    // jQuery('.modal').modal('hide');
    jQuery("#gamerIdHelp").modal('show');
}

function displayJoinTournamentModal() {
    jQuery("input[name='rtj_payment_method']").prop('checked', false)
    jQuery(".payment-options-wrap").hide()
    jQuery(".joinbattle .pspm").remove()
    jQuery("#join_modal").modal('show')
}

function validateClanName(clan_name) {
    let name_length = clan_name.length;
    if (name_length > 0) {
        jQuery('#clan_availability').text('Checking...');
        jQuery('#clan_availability').show();
        if (name_length < 3) {
            jQuery("#clanres").val(0);
            jQuery('#clan_availability').html("<small style='color: #C30303'><i class='fa fa-times'></i> clan name cannot be less than 3 characters.</small>");
        } else if (name_length > 20) {
            jQuery("#clanres").val(0);
            jQuery('#clan_availability').html("<small style='color: #C30303'><i class='fa fa-times'></i> clan name cannot be more than 20 characters.</small>");
        } else if (!clan_name.match(/^[a-zA-Z][a-zA-Z0-9\-\s]+$/)) {
            jQuery("#clanres").val(0);
            jQuery('#clan_availability').html("<small style='color: #C30303'><i class='fa fa-times'></i> invalid clan name.</small>");     
        } else {
            jQuery.get(
                themeDir+'ajax.php',
                {action: 'check_clan_availability', clan_name: clan_name},
                function(response) {
                    if (response == 1) {
                        jQuery("#clanres").val(1);
                        jQuery('#clan_availability').html("<small style='color: #0A7F0E'><i class='fa fa-check'></i> clan name <strong>"+clan_name+"</strong> is available.</small>");
                    } 
                    if (response == 0) {
                        jQuery("#clanres").val(0);
                        jQuery('#clan_availability').html("<small style='color: #C30303'><i class='fa fa-times'></i> clan name <strong>"+clan_name+"</strong> is not available.</small>");
                    }
                }
            );
        }
    } else {
        jQuery("#clanres").val(0);
        jQuery('#clan_availability').html("<span style='color: #C30303'>Please enter clan name.</span>");
    }
    return (jQuery("#clanres").val() == 1) ? true : false;
}

function leaveTournament() {
    if (confirm('We\'re sad to see you Leave the Tournament. Your Tournament Fees will be refunded to your Wallet.')) {
        jQuery('.leave-tournament a').html(`${loadingSpinner(15)} Processing...`);
        jQuery.get(
            themeDir+'ajax.php',
            {action: 'leave_tournament', player: userId, tournament: tournamentId},
            function(response) {
                if (response == 'success') {
                    location.reload(true);
                } else {
                   jQuery('.alert-modal-content').html('<p class="alert alert-danger"><i class="fa fa-warning"></i> '+response+'</p>');
                   jQuery("#alertModal").modal('show');
                   jQuery(".leave-tournament a").text('Leave tournament');
                }
            }
        );            
    }
}

function renderTournamentParticipants(participants) {
    let participantsHtml = `<div class="row _3-in-row">`;
    jQuery.each(participants, (index, participant) => {
        if (!participant.user_id) return
        participantsHtml += `<div class="col-md-4 padding-bottom-10">
            <div class="participant-list-item ${participant.online_status ?? 'offline'}">
                <div class="img img${participant.avatar_size ?? 40}">
                    <a href="${participant.link ?? '#'}" target="_blank" title="${participant.name ?? ''}">
                        ${participant.avatar ? `<img src="${participant.avatar}" />` : ``}
                        <span class="overlay-link"></span>
                    </a>
                </div>
                <div class="info">
                    <div class="user-address">
                        <p class="tournament-participant-name">
                            <a href="${participant.link ?? '#'}" target="_blank" title="${participant.name ?? ''}">${participant.name ?? ''}</a>
                            <small class="tournament-participant-username" title="${participant.username ? `@${participant.username}` : ``}">${participant.username ? `@${participant.username}` : ``}</small>
                        </p>`;
                        if (participant.loggedin) {
                            participantsHtml += `<p>
                                <small style="color: #888">${participant.address ?? ''}</small>
                            </p>`
                            if (participant.user_id != currentUserId) {
                                participantsHtml += `<p class="participant-actions">
                                    ${participant.username ? `<a href="javascript:chat(${participant.user_id}, '${participant.username}', '${participant.name}')">Chat</a>` : ``}
                                    <a href="javascript:challengePop(${participant.user_id})">Challenge</a>
                                </p>`
                            }
                        }
                        participantsHtml += `<p class="tournament-participants-chat-wrap">
                            <span class="user-device">${participant.online_status == 'online' ? `<i class="fa fa-${participant.device}"></i>` : ``}</span>
                        </p>`
                    participantsHtml += `</div>
                </div>
            </div>
        </div>`
    })
    participantsHtml += `</div>`
    return participantsHtml
}

/**
 * [getParticipantList display tournament participants]
 * @param  {integer} tournament_id [tournament id]
 */
function getParticipantList(tournamentId) {
    if (!tournamentId) return

    jQuery.ajax({
        url: `${themeDir}ajax.php`,
        type: 'POST',
        dataType: 'json',
        data: {action: 'get_tournament_participants', tournament_id: tournamentId},
        success: function(data, textStatus, xhr) {
            debugger
            if (!'result' in data) {
                jQuery(".tournament-participant-list").html(`<p class="alert">Something went wrong</p>`)
                return
            }

            if (!data.result) {
                if (data.is_parent)
                    jQuery(".tournament-participant-list").html(`<p class="alert">Currently, no Team/Player has Qualified for the Main Event.</p>`)
                else
                    jQuery(".tournament-participant-list").html(`<p class="alert">No participants till now.</p>`)
                return
            }

            const participantsHtml = renderTournamentParticipants(data.participants)
            jQuery(".tournament-participant-list").html(participantsHtml)
        },
        error: function(xhr, textStatus, errorThrown) {
            jQuery(".tournament-participant-list").html(`<p class="alert">Something went wrong</p>`)
        }
    });
}


jQuery(function(){
    jQuery(document).on('click', '.get-network-id', function(){
        let $this = jQuery(this)
        tournamentToJoin = $this.data('tournament')
        userToJoinTournament = $this.data('user')
        getNetworkId()
    })
})


/**
 * [get network id if not available on click of join now button]
 */
function getNetworkId() {
    jQuery("#get_network_modal").modal('show');
    jQuery("#network_id").focus();
};

/**
 * [saveNetworkId save network id]
 */
function saveNetworkId() {
    let flag = true;
    $networkId = jQuery("#network_id");
    $networkId2 = jQuery("#network_id2");
    let networkId = jQuery("#network_id").val();
    let networkId2 = jQuery("#network_id2").val();
    if (['pubg_mobile', 'pubg_mobile_lite', 'bgmi_mobile'].includes(network)) {
        if (networkId) {
            if (!networkId.match(/^[0-9]{8,13}$/)) {
                flag = false;
                $networkId.next('.error-text').html('<i class="fa fa-warning"></i> Invalid network ID');
            } else {
                $networkId.next('.error-text').html('&nbsp;');                
            }
        } else {
            flag = false;
            $networkId.next('.error-text').html('<i class="fa fa-warning"></i> Please enter network ID');
        }
        if (networkId2) {
            if (!networkId2.match(/^[ A-Za-z0-9_@./#&+-~!$%^&*)/\(_=]{3,20}$/)) {
                flag = false;
                $networkId2.next('.error-text').html('<i class="fa fa-warning"></i> Invalid network ID');
            } else {
                $networkId2.next('.error-text').html('&nbsp;');
            }
        } else {
            flag = false;
            $networkId2.next('.error-text').html('<i class="fa fa-warning"></i> Please enter network ID');
        }
    } else if (['free_fire_emulator', 'free_fire_mobile', 'ffm_mobile'].includes(network)) {
        if (networkId) {
            // if (!networkId.match(/^[ a-zA-Z!@#$%^&*()_+\-=]{2,25}$/)) {
            if (networkId.toLowerCase().indexOf('free') != -1) {
                flag = false;
                $networkId.parent().find('.error-text').html('<i class="fa fa-warning"></i> Invalid In-Game username');
            } else if (jQuery.isNumeric(networkId)) {
                flag = false;
                $networkId.parent().find('.error-text').html('<i class="fa fa-warning"></i> Invalid In-Game username');
            } else {
                $networkId.parent().find('.error-text').html('');
            }
        } else {
            flag = false;
            $networkId.parent().find('.error-text').html('<i class="fa fa-warning"></i> Please enter network ID');
        }
    } else {
        if (!networkId) {
            flag = false;
            $networkId.parent().find('.error-text').html('<i class="fa fa-warning"></i> Please enter network ID');
        } else {
            $networkId.parent().find('.error-text').html('');
        }
    }

    if (!flag) return

    let params = {action: 'save_network', user_id: userId, game_id: gameId, network: network, network_id: networkId};
    if (networkId2) params.network_id2 = networkId2;
    if (jQuery("#network_id").parent().find(".save-network-error").length == 0) {
        jQuery("#network_id").parent().append(`<small class="save-network-error" style="color: #777777">${loadingSpinner(15)} Saving network id.</small>`);
    } else {
        jQuery(".save-network-error").html(`${loadingSpinner(15)} Saving network id.`);
        jQuery(".save-network-error").css('color', '#777777');
    }
    jQuery.post(
        themeDir+'ajax.php',
        params,
        function(response) {
            if (response == 'success') {
                if (jQuery("#network_id").parent().find(".save-network-error").length == 0) {
                    jQuery("#network_id").parent().append('<small class="save-network-error" style="color: red"><i class="fa fa-check"></i> Network id saved successfully.</small>');
                } else {
                    jQuery(".save-network-error").html('<i class="fa fa-check"></i> Network id saved successfully.');
                    jQuery(".save-network-error").css('color', 'green');
                }
                jQuery("#get_network_modal").modal('hide');
                if (tournamentToJoin && userToJoinTournament) {
                    jQuery("._tjb > a").attr('href', `javascript:joinTournament(${tournamentToJoin}, ${userToJoinTournament})`)
                    joinTournament(tournamentToJoin, userToJoinTournament)
                } else {
                    jQuery("._tjb > a").attr('href', 'javascript:joinTournament()')
                    joinTournament()
                }
                // location.reload();
            } else {
                if (jQuery("#network_id").parent().find(".save-network-error").length == 0) {
                    jQuery("#network_id").parent().append('<small class="save-network-error" style="color: red"><i class="fa fa-warning"></i> Something went wrong, please try again.</small>');
                } else {
                    jQuery(".save-network-error").html('<i class="fa fa-warning"></i> Something went wrong, please try again.');
                    jQuery(".save-network-error").css('color', 'red');
                }
            }
        }
    );
};

/**
 * [selectScreenshot display filename on selection of screenshot user while reporting score]
 * @param  {string} field_id [input field id]
 */
function selectScreenshot(field_id) {
    let filename = jQuery("#"+field_id).val().split('\\').pop();
    let filename_new = '';
    if (filename.length > 15) {
      filename_new = filename.substr(0, 12)+'...';
    } else {
      filename_new = filename;
    }
    jQuery("#"+field_id+" + .file-name small").text(filename_new);
    jQuery("#"+field_id+" + .file-name small").attr('title', filename);
    jQuery("#"+field_id+" + .file-name").show();
};

/**
 * [reportScore validate report match score]
 * @return {boolean} [true/false]
 */
function reportScore() {
    let val = true;
    let reported_by = jQuery("#submitted_by").val();
    let winner = jQuery("input[name='winner']:checked").val();
    if (!winner) {
        val = false;
        jQuery(".select-winner-error small").html('<i class="fa fa-warning"></i> Please select winner');
        jQuery(".select-winner-error").show();
    } else {
        jQuery(".select-winner-error").hide();
        jQuery(".select-winner-error small").html('');
    }
    let player1 = jQuery("#foption").val();
    let player2 = jQuery("#soption").val();
    let loser = (winner == player2) ? player1 : player2;
    let player1_score = +jQuery("input[name='player1_score']").val();
    let player2_score = +jQuery("input[name='player2_score']").val();
    let winner_score = +jQuery("#player_"+winner).val();
    let loser_score = +jQuery("#player_"+loser).val();
    if (!isNaN(player1_score) && !isNaN(player2_score)) {
        if (loser_score >= winner_score) {
            val = false;
            jQuery(".score-error small").html("<i class='fa fa-warning'></i> Winner's score must be greater");
            jQuery(".score-error").show();
        } else {
            jQuery(".score-error").hide();
            jQuery(".score-error small").html("");
            let score_sum = winner_score + loser_score;
            let match_type = jQuery("#match_type").val();
            if (((match_type == 3) && (score_sum > 3)) || ((match_type == 5) && (score_sum > 5))) {
                val = false;
                jQuery(".invalid-score-error small").html("<i class='fa fa-warning'></i> Invalid score");
                jQuery(".invalid-score-error").show();
            } else {
                jQuery(".invalid-score-error").hide();
                jQuery(".invalid-score-error small").html('');
            }
        }
    } else {
        val = false;
        jQuery(".score-error small").html("<i class='fa fa-warning'></i> Please enter valid scores");
        jQuery(".score-error").show();
    }
    if (winner == reported_by) {
        if (match_type == 3) {
            if ((!jQuery('#ss1').val()) || (!jQuery("#ss2").val()) || (!jQuery("#ss3").val())) {
                val = false;
                jQuery(".upload-screenshot-error small").html("<i class='fa fa-warning'></i> Please upload screenshots of your win");
                jQuery(".upload-screenshot-error").show();
            } else {
                jQuery(".upload-screenshot-error").hide();
                jQuery(".upload-screenshot-error small").html('');
            }
        } else if (match_type == 5) {
            if ((!jQuery('#ss1').val()) || (!jQuery("#ss2").val()) || (!jQuery("#ss3").val()) || (!jQuery("#ss4").val()) || (!jQuery("#ss5").val())) {
                val = false;
                jQuery(".upload-screenshot-error small").html("<i class='fa fa-warning'></i> Please upload screenshots of your win");
                jQuery(".upload-screenshot-error").show();
            } else {
                jQuery(".upload-screenshot-error").hide();
                jQuery(".upload-screenshot-error small").html('');
            }
        } else {
            if (!jQuery("#ss").val()) {
                val = false;
                jQuery(".upload-screenshot-error small").html("<i class='fa fa-warning'></i> Please upload screenshot of your win");
                jQuery(".upload-screenshot-error").show();
            } else {
                jQuery(".upload-screenshot-error").hide();
                jQuery(".upload-screenshot-error small").html('');
            }
        }
    } else {
        jQuery(".upload-screenshot-error").hide();
        jQuery(".upload-screenshot-error small").html('');
    }
    if (val) {
        jQuery(".saving-score-error small").css('color', 'black');
        jQuery(".saving-score-error small").html(`${loadingSpinner(15)} Saving score...`);
        jQuery(".saving-score-error").show();
    } else {
        jQuery(".saving-score-error").hide();
        jQuery(".saving-score-error small").css('color', 'red');
        jQuery(".saving-score-error small").html('');
    }
    return val;
};

/**
 * [beforeJoinTournament display message before join tournament]
 * @param  {string} paymentOption [payment method]
 */
const beforeJoinTournament = params => {
    let {feeCash, applicableBonusCash:bonusCash, fromWallet, remainingCash, tournamentJoinOption:paymentOption} = params;
    if (!(feeCash > 0)) return;
    if (!paymentOption) return;
    if ('ub_wallet' != paymentOption) return;

    let htmlString = `<h3>Confirm Charges</h3>
    <ol>
        <li>Entry Fee <div class="_ts"><small><i class="fa fa-inr" aria-hidden="true"></i></small><span>${Math.round(feeCash).toFixed(2)}</span></div></li>
        <li>You Are Paying    <div class="_ts"> <small><i class="fa fa-inr" aria-hidden="true"></i></small> <span>${Math.round(feeCash).toFixed(2)}</span></div></li>`;
        if (applicableBonusCash > 0) {
            htmlString += `<li>From Bonus Cash <div class="_ts"><small><i class="fa fa-inr" aria-hidden="true"></i></small><span>${Math.floor(applicableBonusCash).toFixed(2)}</span></div></li>`
        }
         if (fromDeposit > 0) {
            htmlString += `<li>From Deposit <div class="_ts"><small><i class="fa fa-inr" aria-hidden="true"></i></small><span>${Math.floor(fromDeposit).toFixed(2)}</span></div></li>`
        }
        if (fromWallet > 0) {
            htmlString += `<li>From Winning <div class="_ts"><small><i class="fa fa-inr" aria-hidden="true"></i></small><span>${Math.floor(fromWallet).toFixed(2)}</span></div></li>`
        }
        if (remainingCash > 0) {
            htmlString += `<li>Remaining amount <div class="_ts"><small><i class="fa fa-inr" aria-hidden="true"></i></small><span>${Math.ceil(remainingCash).toFixed(2)}</span></div></li>`
        }
    htmlString += `</ol>`

    if (remainingCash > 0) {
        let joinBtn = `<a href="${siteUrl}my-wallet.html?rac=${remainingCash}" class="_jtba">Recharge Wallet</a>`;
        jQuery(".joinbattle").html(joinBtn);
    }

    jQuery("#join_modal .join-tournament-msg").html(htmlString);
}

let tournamentJoinOption = jQuery("#join_modal input[name='tournament_join_option']").val()
let args = {feeCash, applicableBonusCash, fromWallet, remainingCash, tournamentJoinOption}
beforeJoinTournament(args)

/**
 * [submitJoinBattleForm validate join tournament form buy one time payment]
 * @return {boolean} [true/false]
 */
function submitJoinBattleForm() {
    if (jQuery('#clan_name').length) {
        if (jQuery('#clan_name').val().length > 0) {              
            let status = false;
            let clan_name = jQuery('#clan_name').val();
            jQuery("._ub_clan_info").find('._field_').find('p.pspm').remove();
            jQuery.ajax({
                'async': false,
                // 'global': false,
                'type': "POST",
                'url': `${themeDir}clan-ajax.php`,
                'data': {action: 'create_clan', clan_name, gameId},
                'success': function(response){
                   response = response.trim();
                    if (response == 'success') {
                        jQuery("._ub_clan_info").find('._field_').find('p.pspm').remove();
                        jQuery("._ub_clan_info").remove();
                    } else {
                        jQuery("._ub_clan_info").find('._field_').append('<p class="text-center error pspm"><i class="fa fa-warning"></i> '+ response +'.</p>');
                        status = true;
                    }
                }
            });
            if(status){
                return false;
            }
        } else {
            jQuery("._ub_clan_info").find('._field_').append('<p class="text-center error pspm"><i class="fa fa-warning"></i> Please enter your clan name.</p>');
            return false;
        }
    }
    jQuery("#join_modal button[name='join_battle']").hide();
    jQuery("#join_modal button[name='join_battle']").parent().prepend(`<p class="text-center _p-progress">${loadingSpinner(15)} Join tournament in progress...</p>`);
    return true;
}

/**
 * [playBeep play sound]
 * @return {[type]} [description]
 */
function playBeep() {
    const _beep = new window.Audio(`${siteUrl}ubchat/sounds-900-you-know.mp3`);
    _beep.play();
}

/**
 * [sendGroupChat send group chat message]
 * @return {boolean} [false]
 */
function sendGroupChat() {
    let d = new Date();
    let hr = d.getHours();
    let min = d.getMinutes();
    let meridian = (hr < 12) ? 'am' : 'pm';
    let hours = (hr > 12) ? hr - 12 : hr;
    let minutes = (min < 10) ? "0"+min : min;
    let current_chat_time = hours+':'+minutes+' '+meridian;
    let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();
    let message = jQuery("input[name='text_to_send']").val();
    message = message.trim();
    if (message.length > 0) {
        let message2 = createLink(message);
        let gcid = Date.now();
        jQuery("input[name='text_to_send']").val('');
        let chat_date_str = '';
        if (jQuery(".group-chat").find(jQuery("p.group-chat-date small:contains("+current_chat_date+")")).length == 0) {
            let chat_date_str = '<p class="text-center group-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
        }
        jQuery(".group-chat").append(chat_date_str+'<div class="message-strip text-right ct_'+gcid+'"><div class="group-chat-msg pending">'+message2+'<small class="msg-status"><i class="fa fa-spinner fa-pulse"></i></small></div><div class="clear"></div></div>');
        jQuery(".group-chat").animate({ scrollTop: jQuery('.group-chat').prop("scrollHeight")}, 1000);
        jQuery.get(
            themeDir+"group-chat.php",
            {action: 'group_chat_send_message', room_id: roomId, channel: channel, text: message},
            function(response) {
                response = response.trim();
                if (response == 'failed') {
                    jQuery(".group-chat .ct_"+gcid+" .msg-status i").removeClass('fa-spinner fa-pulse');
                    jQuery(".group-chat .ct_"+gcid+" .msg-status i").addClass('fa-times');
                    jQuery(".group-chat .ct_"+gcid+" .msg-status i").attr('title', 'failed');
                } else {
                    jQuery(".group-chat .ct_"+gcid+" .group-chat-msg").removeClass('pending');
                    jQuery(".group-chat .ct_"+gcid+" .msg-status").remove();
                    jQuery(".group-chat .ct_"+gcid+" .group-chat-msg").append('<span class="_gct">'+current_chat_time+'</span>');
                    jQuery(".group-chat").animate({ scrollTop: jQuery('.group-chat').prop("scrollHeight")}, 1000);
                }
            }
        );
    }
    return false;
}

function validateReportIssueForm() {
    $issueType = jQuery("#riForm select[name='issue_type']");
    if (!$issueType.val()) {
        if ($issueType.parent().find(".error").length == 0)
            $issueType.parent().append('<p class="error"><small><i class="fa fa-warning"></i> Please select issue type</small></p>');
        else
            $issueType.parent().find(".error").html('<small><i class="fa fa-warning"></i> Please select issue type</small>');
        return false;
    } else {
        jQuery("#riForm button[type='submit']").html('Sending...').attr('disabled', 'disabled').addClass('disabled');
        $issueType.parent().find(".error").remove();
        return true;
    }
}

function validateFoulPlayForm() {
    let res = true;
    $file = jQuery("input[name='foul_play_screenshot']");
    $comment = jQuery("#rfpForm textarea[name='comment']");
    if (!$file.val()) {
        res = false;
        if ($file.parent().find(".error").length == 0) {
            $file.parent().append('<p class="error"><small><i class="fa fa-warning"></i> Please upload screenshot.</small></p>');                
        } else {
            $file.parent().find(".error").html('<small><i class="fa fa-warning"></i> Please upload screenshot.</small>');
        }
    } else {
        $file.parent().find(".error").remove();
    }
    if (!$comment.val()) {
        res = false;
        if ($comment.parent().find(".error").length == 0) {
            $comment.parent().append('<p class="error"><small><i class="fa fa-warning"></i> Please write comment.</small></p>');
        } else {
            $comment.parent().find(".error").html('<small><i class="fa fa-warning"></i> Please write comment.</small>');
        }
    } else {
        $comment.parent().find(".error").remove();
    }
    return res;
}

function displayClanMembers(clanId) {
    jQuery('#teamMembersModal').modal('show');
    jQuery(".clan-members-table-wrap").html(`<p class="alert text-center">${loadingSpinner(50)}</p>`)

    jQuery.ajax({
        url: `${themeDir}ajax.php`,
        type: 'POST',
        dataType: 'json',
        data: {action: 'display_team_member_details', clan_id: clanId, tournament_id: tournamentId},
    })
    .done(function(data) {
        if (!data.result) {
            jQuery(".clan-members-table-wrap").html('<p class="alert">No members found</p>')
            return
        }

        let membersTable = `<table class="table no-border team-members">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Gamer ID</th>
                </tr>
            </thead>
            <tbody>`
                let playerNumber = 1
                for (let member of data.members) {
                    membersTable += `<tr>
                        <td>Player ${playerNumber++}</td>
                        <td class="_td-gid-wrap">
                            <input type="hidden" name="id" value="${member.ID}" />
                            <input type="hidden" name="tournament_id" value="${member.tournament_id}" />
                            <input type="hidden" name="clan_id" value="${member.clan_id}" />
                            <input type="hidden" name="gamer_id_val" value="${member.gamer_id}" />
                            <input type="text" name="gamer_id" value="${member.gamer_id}" class="form-control" readonly />
                        </td>
                        <td>
                            <button class="btn btn-sm btn-primary edit-gamer-id" title="Edit GamerId"><i class="fa fa-pencil"></i></button>
                            <button class="btn btn-sm btn-primary save-gamer-id hidden">Update</button>
                        </td>
                    </tr>`
                }
            membersTable += `</tbody>
        </table>`
        jQuery(".clan-members-table-wrap").html(membersTable)
    })
    .fail(function() {
        console.log("error");
    })
    .always(function() {
        console.log("complete");
    });
}

const participateTournament = (user_id, tournament_id) => {
    jQuery.ajax({
        url: `${themeDir}participate-tournament.php`,
        type: 'POST',
        dataType: 'json',
        data: {action: 'participate_tournament', user_id, tournament_id},
    })
    .done(function(data) {
        console.log("success");
    })
    .fail(function() {
        console.log("error");
    })
    .always(function() {
        console.log("complete");
    })
}

const updateTournamentClanMember = _ => {
    const formData = jQuery('#updateTournamentClanMember').serialize()

    jQuery.ajax({
        url: `${themeDir}ajax.php`,
        type: 'POST',
        dataType: 'json',
        data: formData,
        success: function(data, textStatus, xhr) {
            if (!data.result) {
                if (0 == jQuery(`#updateTournamentClanMember`).find('.error').length) {
                    jQuery(`#updateTournamentClanMember input[name='action']`).closest('td').prepend('<p class="error"><i class="fa fa-warning"></i> Updation failed, please try again.</p>')
                    return
                }

                jQuery(`#updateTournamentClanMember .error`).html('<i class="fa fa-warning"></i> Updation failed, please try again.')
                return
            }

            jQuery(`.clan_members_info_wrap ul li[data-id=${data.id}] p .member-gamer-id`).text(data.gamer_id)

            jQuery('.alert-modal-content').html('<p class="success"><i class="fa fa-check-circle"></i> Member data updated successfully.</p>')
        },
        error: function(xhr, textStatus, errorThrown) {
            jQuery(`#updateTournamentClanMember input[name='action']`).closest('td').prepend('<p>Something went wrong, please try again.</p>')
        }
    });
    
    return false
}

const addTournamentClanMembers = _ => {
    const formId = 'addTournamentClanMemberForm'
    jQuery(`#${formId} button.btn-success`).html('<i class="fa fa-spinner fa-spin"></i> Processing...').attr('disabled', 'disabled')

    const $tournament = jQuery(`#${formId} input[name='tournament_id']`)
    const $clan = jQuery(`#${formId} input[name='clan_id']`)
    const $name = jQuery(`#${formId} input[name='name']`)
    const $gamerId = jQuery(`#${formId} input[name='gamer_id']`)
    const $phone = jQuery(`#${formId} input[name='phone']`)

    if (!($tournament.val() && $clan.val() && $name.val() && $gamerId.val() && $phone.val())) {
        jQuery(`#${formId} button.btn-success`).text('Add Member').removeAttr('disabled')
        if (0 == jQuery(`#${formId}`).find('.error').length) {
            jQuery(`#${formId} button`).closest('td').prepend('<p class="error"><i class="fa fa-warning"></i> Please fill all mandatory fields.</p>')
            return false
        }

        jQuery(`#${formId} .error`).html('<i class="fa fa-warning"></i> Please fill all mandatory fields.')
        return false
    }

    const nameValidate = $name.val().match(/^[a-zA-Z ]{2,30}$/)
    const phoneValidate = $phone.val().match(/^[5-9]{1}[0-9]{9}$/)

    if (!(nameValidate && phoneValidate)) {
        jQuery(`#${formId} button.btn-success`).text('Add Member').removeAttr('disabled')
        let errorMessage = 'Invalid '
        if (!nameValidate) errorMessage += 'name'
        if (!nameValidate && !phoneValidate) errorMessage += ' & '
        if (!phoneValidate) errorMessage += 'phone number'
            errorMessage += '.'

        if (0 == jQuery(`#${formId}`).find('.error').length) {
            jQuery(`#${formId} button`).closest('td').prepend(`<p class="error"><i class="fa fa-warning"></i> ${errorMessage}</p>`)
            return false
        }

        jQuery(`#${formId} .error`).html(`<i class="fa fa-warning"></i> ${errorMessage}`)
        return false
    }

    jQuery(`#${formId} .error`).remove()

    const formData = jQuery(`#${formId}`).serialize()

    jQuery.ajax({
        url: `${themeDir}ajax.php`,
        type: 'POST',
        dataType: 'json',
        data: formData,
        success: function(data, textStatus, xhr) {
            jQuery(`#${formId} button.btn-success`).text('Add Member').removeAttr('disabled')

            if (!data.result) {
                if (0 == jQuery(`#${formId}`).find('.error').length) {
                    jQuery(`#${formId} button`).closest('td').prepend(`<p class="error"><i class="fa fa-warning"></i> ${data.message}</p>`)
                    return
                }

                jQuery(`#${formId} .error`).html(`<i class="fa fa-warning"></i> ${data.message}`)
                return
            }

            // prepend or append member data
            let memberBox = `${data.ub_member ? `<span class="ub-member verified-member">Verified Member</span>` : `<span class="ub-member invited">Unverified</span>`}
            <div class="edit-post-records">
                <button class="edit-tournament-clan-member"><i class="fa fa-pencil"></i></button>
                <button class="remove-tournament-clan-member"><i class="fa fa-trash"></i></button>
            </div>
            <div class="_cpw">
                <figure>
                    <img src="${data.avatar}" alt="">
                </figure>
                <h3>${data.name}</h3>
                <p><span>Game ID</span> <strong class="member-gamer-id">${data.gamer_id}</strong></p>
            </div>`

            jQuery(`.clan-pro-wrap ul li[boxid='${data.box_id}']`).html(memberBox).attr('data-id', data.id)

            jQuery(`#${formId}`).trigger('reset')
            jQuery('#addTournamentClanMember').modal('hide')
            jQuery('#alertModal .alert-modal-content').html('<p class="success"><i class="fa fa-check-circle"></i> Member added successfully.</p>')
            jQuery('#alertModal').modal('show')
        },
        error: function(xhr, textStatus, errorThrown) {
            jQuery(`#${formId} button.btn-success`).text('Add Member').removeAttr('disabled')
            if (0 == jQuery(`#${formId}`).find('.error').length) {
                jQuery(`#${formId} button`).closest('td').prepend('<p class="error"><i class="fa fa-warning"></i> Failed, please try again.</p>')
                return
            }

            jQuery(`#${formId} .error`).html('<i class="fa fa-warning"></i> Failed, please try again.')
        }
    });
    
    return false
}

// Render Game News
(gameId => {
    jQuery.ajax({
      url: `${themeDir}ajax.php`,
      type: 'GET',
      data: {action: 'render_game_news', game_id: gameId},
      success: function(response) {
        jQuery('#gameNews').html(response)
      },
      async: true
    })
})(gameId)

jQuery(document).ready(function(){

    let joinBtnContent = jQuery('.join-qualifier').html()
    let qualifierJoinButtonContent

    jQuery(document).on('click', '.clan-add-model-btn', function(){
        let $this = jQuery(this)
        jQuery('#addTournamentClanMember .error').remove()
        jQuery('#addTournamentClanMemberForm').trigger('reset')
        jQuery(`#addTournamentClanMemberForm input[name='user_id']`).val('')
        jQuery(`#addTournamentClanMemberForm input[name='ub_member']`).val(0)
        jQuery(`select[name='choose_clan_member']`).val('')
        jQuery(`#addTournamentClanMemberForm .invite-note`).show()
        jQuery(`#addTournamentClanMemberForm input[type='text']`).removeAttr('readonly')
        const boxId = $this.closest('li').attr('boxid')
        jQuery(`input[name='box_id']`).val(boxId)
    })

    jQuery('.join-qualifier').on('click', function(){
        let $this = jQuery(this)
        $this.html(`${loadingSpinner(15)} Processing...`)

        const tournament = $this.data('tournament')
        jQuery.ajax({
            url: `${themeDir}ajax.php`,
            type: 'POST',
            dataType: 'json',
            data: {action: 'join_qualifier', tournament, user: userId},
        })
        .done(function(response) {
            if (!response.result) {
                $this.text('Join Now')
                jQuery('#qualifierJoinModal .modal-body-ub').html(`<p>${response.message}</p>`)
                jQuery('#qualifierJoinModal').modal('show')
                return
            }

            jQuery('#qualifierJoinModal .qualifier-title').text(response.data.h1_title)

            let playerPromoteInfo = `${response.data.max_winners} ${'clan' == response.data.type ? 'Teams' : 'Players'} from each Qualifier will advance to Main Event.`

            if (0 == jQuery('#qualifierJoinModal').find('._ppi').length)
                jQuery('#qualifierJoinModal .qualifier-title').after(`<p class="_ppi">${playerPromoteInfo}</p>`)
            else
                jQuery('#qualifierJoinModal ._ppi').text(playerPromoteInfo)

            jQuery('#qualifierJoinModal .qualifier-start-time').text(`Qualifier Date & Time: ${response.data.tournament_start_time}`)
            response.data.button = response.data.button.replace('Join', 'Join Qualifier')
            qualifierJoinButtonContent = response.data.button

            jQuery('#qualifierJoinModal .qualifier-join-button').html(response.data.button)

            jQuery('#qualifierJoinModal').modal('show')
        })
        .fail(function() {
            console.log("error");
        })
    })

    jQuery('#qualifierJoinModal').on('hidden.bs.modal', function(){
        jQuery('.join-qualifier').html(joinBtnContent)
    })

    jQuery('#chooseClanMembersModal').on('hidden.bs.modal', function(){
        jQuery('.qualifier-join-button').html(qualifierJoinButtonContent)
        jQuery('#qualifierJoinModal').modal('hide')
    });

    if (aiel) {
        jQuery('#tile-1 .nav-tabs a').on('click', function(){
            let $this = jQuery(this)
            let position = $this.parent().position()
            let width = $this.parent().width()
            jQuery('#tile-1 .slider').css({'left':+ position.left, 'width':width})
        })

        let actWidth = jQuery('#tile-1 .nav-tabs').find('.active').parent('li').width()
        let actPosition = jQuery('#tile-1 .nav-tabs .active').position()
        jQuery('#tile-1 .slider').css({'left':+ actPosition.left, 'width': actWidth})
    }

    // render participants
    jQuery('#Participants-tab').on('click', function(){
        getParticipantList(tournamentId)
    })

    jQuery('.participate-tournament').on('click', function(e){
        e.preventDefault()

        const $button = jQuery(this)
        const tournamentId = $button.data('tournament')

        let res = participateTournament(userId, tournamentId);
    })

    if (typeof reportScoreResponse !== 'undefined') {
        if ('result' in reportScoreResponse) {
            let message, className;
            if (reportScoreResponse.result) {
                className = 'success';
                message = 'Score submitted successfully.';
            } else {
                className = 'danger';
                message = `Score submission failed, ${reportScoreResponse.error}`;
            }
            jQuery("#alertModal").modal('show');
            jQuery(".alert-modal-content").html(`<p class="alert alert-${className}" style="margin: 0">${message}</p>`);
        }
    }

    setTimeout(function() {
        if (jQuery('.login-error-wrap').is(":visible")) {
            jQuery(".login-error-wrap").hide('blind', {}, 500);
        }
    }, 10000)

    jQuery(window).scroll(function(){
        if (jQuery(window).scrollTop() >= 500) {
            jQuery('.game-wrap').addClass('fixed-header-game');
        }
        else {
            jQuery('.game-wrap').removeClass('fixed-header-game');
        }
    })

    jQuery(window).scroll(function() {    
        let scroll = jQuery(window).scrollTop();
        if (scroll >= 80) {
            jQuery(".game-nav").addClass("fixednav");
        } else {
            jQuery(".game-nav").removeClass("fixednav");
        }
    })

    jQuery('.menuquicknav').click(function(e){
        e.preventDefault();
        jQuery(this).toggleClass('s1');
        jQuery('.optiongamenav').slideToggle();
    })

    jQuery('html').click(function(event) {
        if (jQuery(event.target).closest('.games-logo').length === 0) {
            jQuery(".menuquicknav").removeClass('s1');
            jQuery('.optiongamenav').slideUp();
        }
    })

    jQuery("._jemt-tooltip").on('mouseenter', function(){
        $this = jQuery(this);
        let error = $this.attr('data-error');
        if (error) {
            $this.parent('._tjb').find('.ub-tooltip').html('<span>'+error+'</span>');
        }   
    })

    jQuery("._jemt-tooltip").on('mouseleave', function(){
        $this = jQuery(this);   
        $this.parent('._tjb').find('.ub-tooltip').html('');
    })

    // tabs setting
    /*jQuery('#verticalTab').easyResponsiveTabs({
        type: 'vertical',
        width: 'auto',
        fit: true
    });*/

    // display title
    jQuery('.join-now.disabled').mouseenter(function(){
      let title = jQuery('.join-now.disabled').data('title');
        jQuery('.join-now.disabled').parent().append('<p class="join-now-warning-msg">'+title+'</p>');
    })

    // hide title
    jQuery('.join-now.disabled').mouseleave(function(){
        jQuery('.join-now-warning-msg').remove();
    })

    // update ad banner click count
    jQuery(".prachar-banner-link").on('click', function(){
        jQuery.get(
            themeDir+'ajax.php',
            {action: 'update_ad_banner_click', ad_id: jQuery(this).data('adid')}
        );
    })

    // save network id
    jQuery("#network_id").keypress(function (e) {
        let key = e.which;
        if (key == 13) {
            saveNetworkId();
        }
    })

    // display payment method box on selection of join method type
    jQuery("#join_modal input[name='join_method']").on('change', function(){
        let divId = jQuery("#join_modal input[name='join_method']:checked").val();
        jQuery("#join_modal .join-modal-box").hide();
        jQuery("#"+divId).show();  
    })

    jQuery(".group-chat").animate({ scrollTop: jQuery('.group-chat').prop("scrollHeight")}, 1000);

    jQuery(".view-tourney-btn").on('mouseenter', function(){
        $this = jQuery(this);
        let msg = $this.data('mesg');            
        if (msg) $this.before('<span class="tool-tip">'+msg+'</span>');
    })

    jQuery(".view-tourney-btn").on('mouseleave', function(){
        jQuery(this).parent().find('.tool-tip').remove();
    })

    jQuery('.complete-game').click(function(){
        jQuery('.complete-game').toggleClass('op');
        jQuery(this).parent().find('.cmp-game').toggle();
    })

    /* progress bar */

    /*jQuery(document).on('click', '.bracket-tabbing-module .clickme a', function(){
        jQuery('.bracket-tabbing-module .clickme a').removeClass('activelink');
        jQuery(this).addClass('activelink');
        let tagid = jQuery(this).data('tag');
        jQuery('#bracket-tbs .list').removeClass('active').addClass('hide');
        jQuery('#'+tagid).addClass('active').removeClass('hide');
    })*/


    jQuery('.bracket-tabbing-module .clickme a').on('click' , function(e){
        e.preventDefault()
        jQuery('.bracket-tabbing-module .clickme a').removeClass('activelink');
        jQuery(this).addClass('activelink');
        let tagid = jQuery(this).data('tag');
        jQuery('#bracket-tbs .list').removeClass('active').addClass('hide');
        jQuery('#'+tagid).addClass('active').removeClass('hide');
    })

    jQuery('.progress-round ul.round-tabs li.tab-link').on('click', function(){
        $this = jQuery(this);
        let contId = $this.parents('.list').attr('id');
        jQuery('.progress-round ul.round-tabs li.tab-link').removeClass('current');
        $this.addClass('current');
        jQuery('._rndwrapper').hide();
        jQuery('#'+contId+' .tab-content').hide();
        jQuery('#'+contId+' .tab-content ._rndwrapper').hide();
        // jQuery(".tab-content ._buttonRd").addClass('c');
        jQuery("#"+contId+" .tab-content ._buttonRd").removeClass('v');
        let tab = +jQuery(this).data('tab');    
        if (tab > 0) {
            for(let i = 1; i <= tab; i++) {
                jQuery("#"+contId+" #tab"+i+" ._buttonRd").addClass('v');
                jQuery('#'+contId+' #tab'+i).show();
            }
        } else {
            for(let i = -1; i >= tab; i--) {
                jQuery("#tab"+i+" ._buttonRd").addClass('v');
                jQuery('#tab'+i).show();
            }
        }
        jQuery('#'+contId+' #tab'+tab+' ._rndwrapper').slideDown();
        jQuery("#"+contId+" #tab"+tab+" ._buttonRd").removeClass('c');
    })
    
    jQuery(document).on('click', '._buttonRd.c', function(){
        jQuery("._buttonRd").addClass('c');
        jQuery(this).removeClass('c');
        jQuery("._rndwrapper").slideUp();
        jQuery(this).next('._rndwrapper').slideDown();
    })

    /* /progress bar */

    /* bracket schedule */
    /*jQuery("._bs-tab-wrap ul li a").on('click', function(e){
        e.preventDefault();
        let boxId = jQuery(this).attr('href');
        let roundNum = jQuery(this).data('round');
        jQuery(".round-content").hide();
        jQuery(boxId).show();
        jQuery('._bs-tab-wrap ul li').removeClass('active');
        jQuery('.round-li-'+roundNum).addClass('active');
    })*/

    jQuery(document).on("click", "._gnid-action", function(){
        $this = jQuery(this);
        $wrapper = $this.parents("._gnid-wrapper");
        $envWrap = $wrapper.find("._env-wrap");
        let action = $this.attr('action');
        let network, networkId;
        switch(action) {
            case 'edit':
                // $ee = jQuery("._gnid-wrapper._ee");
                // $wrapper.addClass('_ee');
                $vLabel = $envWrap.find("._gnid-value");
                network = $vLabel.attr('network');
                networkId = $vLabel.text();
                let actSave = '<span class="_gnid-action" action="save" title="Save"><i class="fa fa-check"></i></span>';
                let actCancel = '<span class="_gnid-action" action="cancel" title="Cancel"><i class="fa fa-times"></i></span>';
                let editField = '<input type="text" name="enid_field" network="'+network+'" value="'+networkId+'" />';
                let action = $this.prev("._gnid-value").remove();
                $envWrap.find("span._gnid-action[action='edit']").remove();
                $envWrap.append(editField+actSave+actCancel);
                break;
            case 'save':
                $envWrap.find("._gnid-action[action='save']").attr('action', 'disabled');
                $envWrap.find("._gnid-action[action='cancel']").attr('action', 'disabled');
                $wrapper.find('.enid-res-wrap').html(`<small class="enid-res saving">${loadingSpinner(10)} Saving...</small>`);
                $eField = $envWrap.find("input[name='enid_field']");
                network = $eField.attr('network');
                networkId = $eField.val();
                jQuery.post(
                    themeDir+'ajax.php',
                    {action: 'update_network_id', user_id: currentUserId, network: network, network_id: networkId},
                    function(response) {
                        $envWrap.find("._gnid-action[action='disabled']").remove();
                        let resObj = jQuery.parseJSON(response);
                        $envWrap.find("input[name='enid_field']").remove();
                        $envWrap.find("span._gnid-action[action='save']").remove();
                        $envWrap.find("span._gnid-action[action='cancel']").remove();
                        if ($envWrap.find("._gnid-value").length > 0) {
                            $envWrap.find("._gnid-value").text(resObj.network_id);
                        } else {
                            $envWrap.append('<label class="_gnid-value" network="'+network+'">'+resObj.network_id+'</label>');
                        }
                        $envWrap.append('<span class="_gnid-action" action="edit" title="Edit"><i class="fa fa-pencil"></i></span>');
                        if (resObj.res) {
                            $wrapper.find('.enid-res-wrap').html('<small class="enid-res saved"><i class="fa fa-check"></i> Saved</small>');
                        } else {
                            $wrapper.find('.enid-res-wrap').html('<small class="enid-res failed"><i class="fa fa-exclamation"></i> Failed</small>');
                        }
                        setTimeout(function(){
                            $wrapper.find(".enid-res-wrap .enid-res").remove();
                        }, 5000);
                    }
                );
                break;
            case 'cancel':
                $eField = $envWrap.find("input[name='enid_field']");
                network = $eField.attr('network');
                networkId = $eField.val();
                $envWrap.find("input[name='enid_field']").remove();
                $envWrap.find("span._gnid-action[action='save']").remove();
                $envWrap.find("span._gnid-action[action='cancel']").remove();
                if ($envWrap.find("._gnid-value").length > 0) {
                    $envWrap.find("._gnid-value").text(networkId);
                } else {
                    $envWrap.append('<label class="_gnid-value" network="'+network+'">'+networkId+'</label>');
                }
                $envWrap.append('<span class="_gnid-action" action="edit" title="Edit"><i class="fa fa-pencil"></i></span>');
                break;
        }
    })

    jQuery(".add-member").on('click', function(){
        let trHtml = `<tr class="_acptr">
            <td><input type="text" name="member_name" class="form-control" placeholder="Enter name" /></td>
            <td class="_td-gid-wrap">
                <input type="text" name="gamer_id" class="form-control" placeholder="Enter Gamer ID" />
                <input type="hidden" name="gamer_id_val" />
            </td>
            <td><input type="text" name="member_phone" class="form-control" placeholder="Enter phone number" /></td>
        </tr>`;
        jQuery(this).parents('tr').before(trHtml);
    })

    jQuery("input[name='game_clan_name']").on('blur', function(){
        let clan_name = jQuery("input[name='game_clan_name']").val();
        validateClanName(clan_name);
    })

    jQuery(`#createClanModal button[name="create_clan"]`).on('click', function(){
        let res = true
        
        const tournamentId = jQuery('#clan_to_join_tournament').val()

        jQuery('#createClanModal .modal-footer ._processing').html(`${loadingSpinner(15)} Processing...`)

        let $clanTitle = jQuery(`#createClanModal input[name="game_clan_name"]`)

        if (!$clanTitle.val()) {
            res = false
            $clanTitle.css('border-color', 'red')
            if ($clanTitle.parent().find('.cc-error').length > 0) {
                $clanTitle.parent().find('.cc-error').html('<small class="error"><i class="fa fa-warning"></i> Please enter clan name</small>')
            } else {
                $clanTitle.parent().append('<p class="cc-error"><small class="error"><i class="fa fa-warning"></i> Please enter clan name</small></p>')
            }
        } else {
            $clanTitle.css('border-color', '#CCC')

            jQuery.get(
                `${themeDir}ajax.php`,
                {action: 'check_clan_availability', clan_name: $clanTitle.val()},
                function(response) {
                    if (0 == response) {
                        res = false
                        jQuery('#createClanModal .modal-footer ._processing').html('')
                        if (jQuery('#createClanModal .modal-footer').find('.cc-notice').length > 0) {
                            jQuery('#createClanModal .modal-footer').find('.cc-notice').html(`<span class="error"><i class="fa fa-warning"></i> <strong>${$clanTitle.val()}</strong> is not available.</span>`)
                        } else {
                            jQuery('#createClanModal .modal-footer').prepend(`<p class="cc-notice text-center"><span class="error"><span class="error"><i class="fa fa-warning"></i> <strong>${$clanTitle.val()}</strong> is not available.</span></p>`)
                        }
                        $clanTitle.css('border-color', 'red')
                        jQuery("#clan_availability").html(`<small class="error"><i class="fa fa-times"></i> <strong>${$clanTitle.val()}</strong> is not available.</small>`)
                        return
                    } 

                    $clanTitle.css('border-color', '#CCC')
                    jQuery('#clan_availability').html(`<small class="success"><i class="fa fa-check"></i> <strong>${$clanTitle.val()}</strong> is available.</small>`)
                }
            )
        }

        let i = 0
        let members = []
        jQuery('#createClanModal tr.add-member-row input').css('border-color', '#CCC')


        jQuery('#createClanModal .add-member-row').each(function(){
            let $tr = jQuery(this)
            let $name = $tr.find("input[name='gamer_name']")
            let $gamerId = $tr.find("input[name='gamer_id']")
            let gamerIdVal = $gamerId.val()
            if (4833 == gameId && 'steam' == network) {
                gamerIdVal = $tr.find(`input[name="gamer_id_val"]`).val()
            }
            let $phone = $tr.find(`input[name="gamer_phone"]`)

            members[i++] = {
                name: $name.val(),
                gamer_id: gamerIdVal,
                phone: $phone.val()
            }

            if (!($name.val() && $gamerId.val() && $phone.val())) {
                if (!$name.val()) $name.css('border-color', 'red')
                if (!$gamerId.val()) $gamerId.css('border-color', 'red')
                if (!$phone.val()) $phone.css('border-color', 'red')
                res = false
            }

            if ((!$phone.val().match(/^[5-9]{1}[0-9]{9}$/))) {
                $phone.css('border-color', 'red')
                res = false
            }
        })

        if (members.length != (clanSize - 1)) {
            if (jQuery('#createClanModal .modal-footer').find('.cc-notice').length > 0) {
                jQuery('#createClanModal .modal-footer ._processing').html('')
                jQuery('#createClanModal .modal-footer').find('.cc-notice').html(`<span class="error"><i class="fa fa-warning"></i> Please add ${clanSize - 1} members.</span>`)
            } else {
                jQuery('#createClanModal .modal-footer').prepend(`<p class="cc-notice text-center"><span class="error"><i class="fa fa-warning"></i> Please add ${clanSize - 1} members.</span></p>`)
            }
            return
        }

        jQuery('#createClanModal .modal-footer .cc-notice').html('')

        if (!res) {
            jQuery('#createClanModal .modal-footer ._processing').html('')
            if (jQuery('#createClanModal .modal-footer').find('.cc-notice').length > 0) {
                jQuery('#createClanModal .modal-footer').find('.cc-notice').html('<span class="error"><i class="fa fa-warning"></i> Please input valid data to all mandatory fields</span>')
                return
            }

            jQuery('#createClanModal .modal-footer').prepend('<p class="cc-notice text-center"><span class="error"><i class="fa fa-warning"></i> Please input valid data to all mandatory fields</span></p>')
            return
        }

        jQuery(`#createClanModal .modal-footer`).find('.cc-notice').remove()

        const args = {
            action: 'create_clan',
            game_id: gameId,
            network: network,
            tournament: tournamentId,
            clan_name: $clanTitle.val(),
            members: members,
            user_id: currentUserId
        }

        jQuery.get(
            `${themeDir}clan-ajax.php`,
            args,
            function(response) {
                console.log(response);
                if ('success' != response) {
                    jQuery('#alertModal .alert-modal-content').html(`<p class="alert alert-danger">${response}</p>`)
                    return
                }

                jQuery('#createClanModal').modal('hide')
                jQuery('#qualifierJoinModal').modal('hide')
                displayJoinTournamentModal()
            }
        )
    })

    jQuery("input[name='clan_participant']").on('change', function(){
        $this = jQuery(this);
        if ($this.prop('checked')) {
            let gamerId = $this.parents('tr').find("input[name='gamer_id']").val();
            if (!gamerId) {
                $this.prop('checked', false);
                alert('Please enter Gamer ID first');
            }
        }
    })

    jQuery(`#chooseClanMembersModal button[name='save_clan_participants']`).on('click', function(){
        let res = true
        let members = []
        let i = 0, j = 0
        let gamerIdsArr = []

        const tournamentId = jQuery('#clan_to_join_tournament').val()

        jQuery("#chooseClanMembersModal ._ccptr").each(function(){
            $tr = jQuery(this)
            if (jQuery("#chooseClanMembersModal input[name='clan_participant']").prop('checked')) {
                let userId = $tr.find("input[name='clan_participant']").val()
                let name = $tr.find("input[name='member_name']").val()
                let gamerId = $tr.find("input[name='gamer_id']").val()
                if (4833 == gameId && 'steam' == network) {
                    gamerId = $tr.find("input[name='gamer_id_val']").val()
                }
                let phone = $tr.find("input[name='member_phone']").val()
                members[i++] = {user_id: userId, name: name, gamer_id: gamerId, phone: phone, ubmember: 1}
                gamerIdsArr[j++] = gamerId
            }
        });

        jQuery("._acptr input").css('border-color', '#CCC')

        jQuery("#chooseClanMembersModal ._acptr").each(function(){
            $tr = jQuery(this)
            let userId = 0
            let $name = $tr.find("input[name='member_name']")
            let $gamerId = $tr.find("input[name='gamer_id']")
            let gamerIdVal = $gamerId.val()
            if (gameId == 4833 && network == 'steam') {
                gamerIdVal = $tr.find("input[name='gamer_id_val']").val()
            }
            let $phone = $tr.find("input[name='member_phone']")

            if (!($name.val() || $gamerId.val() || $phone.val())) return

            members[i++] = {user_id: userId, name: $name.val(), gamer_id: gamerIdVal, phone: $phone.val(), ubmember: 0}

            if (!$name.val()) {
                res = false
                $name.css('border-color', 'red')
            }

            if (!$gamerId.val()) {
                res = false
                $gamerId.css('border-color', 'red')
            } else {
                if (jQuery.inArray($gamerId.val(), gamerIdsArr) == -1) {
                    gamerIdsArr[j++] = $gamerId.val()
                    $gamerId.parent().find('.error').remove()
                    $gamerId.css('border-color', '#CCC')
                } else {
                    res = false
                    if ($gamerId.parent().find('.error').length > 0) {
                        $gamerId.parent().find('.error').text('Duplicate gamer ID')
                    } else {
                        $gamerId.parent().append('<small class="error">Duplicate gamer ID</small>')
                    }
                    $gamerId.css('border-color', 'red')
                }
            }
            if (!$phone.val()) {
                res = false
                $phone.css('border-color', 'red')
            }
            if ((!$phone.val().match(/^[5-9]{1}[0-9]{9}$/))) {
                $phone.css('border-color', 'red')
                res = false
            }
        })

        if (members.length != (clanSize - 1)) {
            if (jQuery("#chooseClanMembersModal .modal-footer").find('.cc-notice').length > 0) {
                jQuery("#chooseClanMembersModal .modal-footer ._processing").html('')
                jQuery("#chooseClanMembersModal .modal-footer").find('.cc-notice').html(`<span class="error"><i class="fa fa-warning"></i> Please add ${clanSize - 1} members.</span>`)
            } else {
                jQuery("#chooseClanMembersModal .modal-footer").prepend(`<p class="cc-notice text-center"><span class="error"><i class="fa fa-warning"></i> Please add ${clanSize - 1} members.</span></p>`)
            }
            return false;
        } else {
            jQuery("#chooseClanMembersModal .modal-footer .cc-notice").html('')
        }

        if (!res) {
            jQuery("#chooseClanMembersModal .modal-footer ._processing").html('')
            if (jQuery("#chooseClanMembersModal .modal-footer").find('.cc-notice').length > 0) {
                jQuery("#chooseClanMembersModal .modal-footer").find('.cc-notice').html('<span class="error"><i class="fa fa-warning"></i> Please input valid data to all mandatory fields</span>')
            } else {
                jQuery("#chooseClanMembersModal .modal-footer").prepend('<p class="cc-notice text-center"><span class="error"><i class="fa fa-warning"></i> Please input valid data to all mandatory fields</span></p>')
            }
        } else {
            jQuery("#chooseClanMembersModal .modal-footer ._processing").html(`${loadingSpinner(15)} Processing... `)
            jQuery("#chooseClanMembersModal .modal-footer").find('.cc-notice').remove()
            const args = {
                action: 'save_clan_participants',
                game_id: gameId,
                network,
                tournament: tournamentId,
                clan_id: userClan,
                members
            }
            jQuery.get(
                `${themeDir}ajax.php`,
                args,
                function(response) {
                    if ('success' != response) {
                        jQuery("#alertModal .alert-modal-content").html(`<p class="alert alert-danger">${response}</p>`)
                        return
                    }

                    jQuery("#chooseClanMembersModal").modal('hide')
                    jQuery('#qualifierJoinModal').modal('hide')
                    displayJoinTournamentModal()
                    // joinTournament(tournamentId, currentUserId)
                }
            )
        }
    })

    jQuery(document).on("click", ".edit-gamer-id", function(){
        $this = jQuery(this);
        $tr = $this.parents('tr');
        $gamerIdField = $tr.find("input[name='gamer_id']");
        $gamerIdField.removeAttr('readonly');
        $this.addClass('cancel-edit-gamer-id').removeClass('edit-gamer-id').html('<i class="fa fa-times"></i>');
        $this.attr('title', 'Cancel');
        $tr.find(".save-gamer-id").removeClass('hidden');
    })

    jQuery(document).on("click", ".cancel-edit-gamer-id", function(){
        $this = jQuery(this);
        $tr = $this.parents('tr');
        $gamerIdField = $tr.find("input[name='gamer_id']");
        $gamerIdField.attr('readonly', 'readonly');
        $this.addClass('edit-gamer-id').removeClass('cancel-edit-gamer-id').html('<i class="fa fa-pencil"></i>');
        $this.attr('title', 'Edit Gamer ID');
        $tr.find(".save-gamer-id").addClass('hidden');
    })

    jQuery(document).on("click", ".save-gamer-id", function(){
        $this = jQuery(this);
        $td = $this.parent();
        if ($td.find('._p-state').length > 0) {
            $td.find('._p-state').text(' Updating...').removeClass('success error');
        } else {
            $td.append('<span class="_p-state"> Updating...</span>');
        }
        $tr = $this.parents('tr');
        let id = $tr.find("input[name='id']").val();
        let gamerId = $tr.find("input[name='gamer_id']").val();
        if (gameId == 4833 && network == 'steam') {
            gamerId = $tr.find("input[name='gamer_id_val']").val();
        }
        jQuery.get(
            themeDir+'ajax.php',
            {action: 'update_gamer_id', id: id, game_id: gameId, network: network, gamer_id: gamerId},
            function(response) {
                if (response == 'success') {
                    if ($td.find('._p-state').length > 0) {
                        $td.find('._p-state').text(' Updated').addClass('success').delay(5000).remove();
                    } else {
                        $td.append('<span class="_p-state success"> Updated</span>').delay(5000).remove();
                    }
                } else {
                    if ($td.find('._p-state').length > 0) {
                        $td.find('._p-state').text(' Failed').addClass('error').delay(5000).remove();
                    } else {
                        $td.append('<span class="_p-state error"> Failed</span>').delay(5000).remove();
                    }
                }
            }
        );
    })

    jQuery(document).on("change", "#chooseClanMembersModal input[name='gamer_id'], #createClanModal input[name='gamer_id'], .team-members input[name='gamer_id']", function(){
        $this = jQuery(this);
        if ($this.val()) {
            if (gameId == 4833 && network == 'steam') {
                $td = $this.parent();
                if ($td.find('._gid-checking').length > 0) {
                    $td.find('._gid-checking').html(`<i>${loadingSpinner(14)}<i/>`);
                } else {
                    $td.append(`<span class="_gid-checking"><i>${loadingSpinner(14)}</i></span>`);
                }
                $this.next("input[name='gamer_id_val']").val($this.val());
                jQuery.get(
                    themeDir+'ajax.php',
                    {action: 'validate_gamer_id', gamer_id: $this.val()},
                    function(response) {
                        if (response != 'failed') {
                            $this.next("input[name='gamer_id_val']").val(response);
                            $this.css('border-color', '#CCC');
                            if ($td.find('._gid-checking').length > 0) {
                                $td.find('._gid-checking').html('<i class="fa fa-check success"></i>');
                            } else {
                                $td.append('<span class="_gid-checking"><i class="fa fa-check success"></i></span>');
                            }
                        } else {
                            $this.next("input[name='gamer_id_val']").val('');                                
                            $this.css('border-color', 'red');
                            if ($td.find('._gid-checking').length > 0) {
                                $td.find('._gid-checking').html('<i class="fa fa-times error"></i>');
                            } else {
                                $td.append('<span class="_gid-checking"><i class="fa fa-times error"></i></span>');
                            }
                        }
                    }
                );
            }
        }
    })

    // Send chat
    jQuery(document).on('click', `button[name='send_opp_chat']`, function(e){
        let chatMessage = jQuery(this).prev(`input[name='opp_chat_message']`).val().trim()
        if (0 == chatMessage.length) {
            jQuery(this).prev().val(chatMessage)
            return
        }

        let recipientUsername = jQuery(this).prev().attr('data-sendto')
        jQuery(this).prev().val('')
        sendOppChatMessage(recipientUsername, chatMessage)
    })

    // Send chat on enter
    jQuery(document).on('keypress', `input[name='opp_chat_message']`, function(e){
        let key = e.which
        if (13 != key) return

        let chatMessage = jQuery(this).val().trim()
        if (0 == chatMessage.length) {
            jQuery(this).val(chatMessage)
            return
        }

        let recipientUsername = jQuery(this).attr('data-sendto')
        jQuery(this).val('')
        sendOppChatMessage(recipientUsername, chatMessage)
    })

    // Remove tournament clan member
    jQuery(document).on('click', '.remove-tournament-clan-member', function(){
        if (!confirm('Are you sure?')) return

        const $this = jQuery(this)
        const $li = $this.closest('li')
        const id = $this.closest('li').attr('data-id')

        $this.find('i').addClass('fa-spinner fa-spin').removeClass('fa-trash')

        jQuery.ajax({
            url: `${themeDir}ajax.php`,
            type: 'POST',
            dataType: 'json',
            data: {action: 'remove_tournament_clan_member', id},
            success: function(data, textStatus, xhr) {
                if (!data.result) {
                    $this.find('i').addClass('fa-trash').removeClass('fa-spinner fa-spin')
                    alert('Something went wrong, please try again.')
                    return
                }

                $li.fadeOut('slow')
                $li.removeAttr('data-id')

                let addNewMemberBox = `<div class="clan-add-model-btn" data-toggle="modal" data-target="#addTournamentClanMember">
                    <span>+</span>
                    <p>Add New Member</p>
                </div>`

                $li.html(addNewMemberBox)
                $li.fadeIn('slow')
            },
            error: function(xhr, textStatus, errorThrown) {
                $this.find('i').addClass('fa-trash').removeClass('fa-spinner fa-spin')
                alert('Something went wrong, please try again.')
            }
        })
    })

    jQuery(document).on('click', '.edit-tournament-clan-member', function(){
        const $this = jQuery(this)
        const id = $this.closest('li').data('id')

        $this.find('i').addClass('fa-spinner fa-spin').removeClass('fa-pencil')

        jQuery.ajax({
            url: `${themeDir}ajax.php`,
            type: 'POST',
            dataType: 'json',
            data: {action: 'edit_tournament_clan_member', id},
            success: function(data, textStatus, xhr) {
            $this.find('i').addClass('fa-pencil').removeClass('fa-spinner fa-spin')
            if (!data.result) {
                $this.find('i').addClass('fa-pencil').removeClass('fa-spinner fa-spin')
                alert('Something went wrong, please try again.')
                return
            }

            let formHtml = `<form id="updateTournamentClanMember" method="post" onsubmit="return updateTournamentClanMember()">
                <p class="text-center">
                    <img src="${data.avatar}" />
                </p>
                <table class="table table-sm table-borderless">
                    <tr>
                        <td>Name:</td>
                        <td>
                            <input type="hidden" name="id" value="${data.ID}" readonly />
                            <input type="text" name="member_name" value="${data.name}" class="form-control" readonly />
                        </td>
                    </tr>
                    <tr>
                        <td>Game ID:</td>
                        <td><input type="text" name="member_game_id" value="${data.gamer_id}" class="form-control" /></td>
                    </tr>
                    <tr>
                        <td>Mobile:</td>
                        <td><input type="text" name="member_mobile" value="${data.phone}" class="form-control" readonly /></td>
                    </tr>
                    <tr>
                        <td colspan="2" class="text-right">
                            <input type="hidden" name="action" value="update_tournament_clan_member" readonly>
                            <button class="btn btn-sm btn-link text-light" data-dismiss="modal">Cancel</button>
                            <button class="btn btn-sm btn-success">Update</button>
                        </td>
                    </tr>
                </table>
            </form>`

            jQuery('#alertModal .alert-modal-content').html(formHtml)
            jQuery('#alertModal').modal('show')
          },
          error: function(xhr, textStatus, errorThrown) {
            $this.find('i').addClass('fa-pencil').removeClass('fa-spinner fa-spin')
            alert('Something went wrong, please try again.')
          }
        });
    })

    jQuery(`select[name='choose_clan_member']`).on('change', function(){
        const $this = jQuery(this)

        const userId = $this.val()
        if (!userId) {
            jQuery(`#addTournamentClanMemberForm input[name='user_id']`).val('')
            jQuery(`#addTournamentClanMemberForm input[name='ub_member']`).val(0)
            jQuery(`#addTournamentClanMemberForm input[name='name']`).val('').removeAttr('readonly')
            jQuery(`#addTournamentClanMemberForm input[name='gamer_id']`).val('').removeAttr('readonly')
            jQuery(`#addTournamentClanMemberForm input[name='phone']`).val('').removeAttr('readonly')
            jQuery(`#addTournamentClanMemberForm .invite-new-member`).show()
            jQuery(`#addTournamentClanMemberForm .invite-note`).show()
            jQuery('#addTournamentClanMember .error').remove()
            return
        }

        const $user = $this.find(':selected')
        const username = $user.data('username')
        const name = $user.data('name')
        const phone = $user.data('phone')
        const gamerId = $user.data('gamerid')

        jQuery(`#addTournamentClanMemberForm .invite-new-member`).hide()
        jQuery(`#addTournamentClanMemberForm .invite-note`).hide()
        jQuery(`#addTournamentClanMemberForm input[name='user_id']`).val(userId)
        jQuery(`#addTournamentClanMemberForm input[name='ub_member']`).val(1)
        jQuery(`#addTournamentClanMemberForm input[name='name']`).val(name).attr('readonly', 'readonly')
        jQuery(`#addTournamentClanMemberForm input[name='gamer_id']`).val(gamerId)
        if (gamerId) {
            jQuery(`#addTournamentClanMemberForm input[name='gamer_id']`).attr('readonly', 'readonly')
        } else {
            jQuery(`#addTournamentClanMemberForm input[name='gamer_id']`).removeAttr('readonly')
        }
        jQuery(`#addTournamentClanMemberForm input[name='phone']`).val(phone).attr('readonly', 'readonly')
    })

    let tournamentMatchAreaWrapper = document.querySelector('.tournament-match-area-wrapper')
    let tournamentChatWrapper = document.querySelector('.tournament-chat-wrapper')
    if (tournamentMatchAreaWrapper) {
        if (0 == tournamentMatchAreaWrapper.childElementCount) {
            tournamentChatWrapper.classList.remove('col-lg-6')
            tournamentChatWrapper.classList.add('col-lg-12')
        }
        if (0 == tournamentChatWrapper.childElementCount) {
            tournamentMatchAreaWrapper.classList.remove('col-lg-6')
            tournamentMatchAreaWrapper.classList.add('col-lg-12')
        }
    }
});

jQuery('#tournamentJoinModal').on('hidden.bs.modal', function(){
    if ('Thanks' != jQuery("#tournamentJoinModal ._ubs_model_row h3").text()) return
    jQuery('#how_to_play_modal').modal('show')
});

jQuery("#createClanModal").on('hidden.bs.modal', function(){
    jQuery("._tjb > a").html(buttonData).removeAttr('disabled').removeClass('disabled')
});

// receive group chat message
let groupchat = pusher.subscribe('groupchat');
groupchat.bind(roomId, function(data){
    if (data.from != currentUsername) {
        let d = new Date();
        let hr = d.getHours();
        let min = d.getMinutes();
        let meridian = (hr < 12) ? 'am' : 'pm';
        let hours = (hr > 12) ? hr - 12 : hr;
        let minutes = (min < 10) ? "0"+min : min;
        let current_chat_time = hours+':'+minutes+' '+meridian;
        let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();
        let msgFrom = (data.from == rocketAdminUsername) ? 'ADMIN' : data.from;
        let className = (msgFrom == 'ADMIN') ? 'admin-message-strip' : '';
        let chat_date_str = '';
        if (jQuery(".group-chat").find(jQuery("p.group-chat-date small:contains("+current_chat_date+")")).length == 0) {
            let chat_date_str = '<p class="text-center group-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
        }
        jQuery("#"+data.group_id).append(chat_date_str+'<div class="message-strip '+className+'"><div class="group-chat-msg"><p class="group-chat-from"><small>@'+msgFrom+'</small></p>'+data.message+'<span class="_gct">'+current_chat_time+'</span></div></p><div class="clear"></div></div>');
        jQuery("#"+data.group_id).animate({ scrollTop: jQuery('#'+data.group_id).prop("scrollHeight")}, 1000);
        playBeep();
    }
});

// get sent message
    let stChatChannelSent = pusher.subscribe('directchatsend');
    stChatChannelSent.bind(currentUsername, function(data) {
        let d = new Date();
        let hr = d.getHours();
        let min = d.getMinutes();
        let meridian = (hr < 12) ? 'am' : 'pm';
        let hours = (hr > 12) ? hr - 12 : hr;
        let minutes = (min < 10) ? "0"+min : min;
        let current_chat_time = hours+':'+minutes+' '+meridian;
        let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();
        let chat_date_str;
        if (document.hidden) {
            let chatMessage = createLink(data.message);
            let headerId = '#h_'+data.sender.replace('.', '')+'_'+data.receiver.replace('.', '');
            if (jQuery('#oppchatwrap').find(headerId).length > 0) {
                chat_date_str = '';
                if (jQuery('#oppchatwrap #oppchatbody').find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
                    chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
                }                    
                jQuery('#oppchatwrap #oppchatbody .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg">'+chatMessage+'<span class="_dct">'+current_chat_time+'</span></div></div>');
                jQuery('#oppchatwrap #oppchatbody').animate({scrollTop: 100000}, 'normal');
            }

            // let chatBoxId = '#chatbox_'+currentUsername.replace('.', '')+'_'+data.receiver.replace('.', '');
            // if (jQuery('#chatbox_container').find(chatBoxId).length > 0) {
                chat_date_str = '';
                if (jQuery("#oppchatwrap .chat-body").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
                    chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
                }                    
                jQuery('#oppchatwrap .chat-body .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg">'+chatMessage+'<span class="_dct">'+current_chat_time+'</span></div></div>');
                jQuery('#oppchatwrap .chat-body').animate({scrollTop: 100000}, 'normal');
            // }
        }
    });

// receive message
    let stChatChannelReceived = pusher.subscribe('directchatreceive');
    stChatChannelReceived.bind(currentUsername, function(data) {
        // update trigger num
            if (jQuery("._uc-num blink").length > 0) {
                let ucNum = +jQuery("._uc-num blink").text();
                ucNum = ucNum + 1;
                jQuery("._uc-num blink").text(ucNum);
            } else {
                jQuery("._uc-num").append('<blink>1</blink>');
            }
        // update recent chat row and num
            let num = +jQuery(".rcfid"+data.sender_id).find("._rc-num").text();
            num = num + 1;
            jQuery(".rcfid"+data.sender_id).remove();
            let chatRow = '<li class="rcfid'+data.sender_id+'">'
                +'<a href="javascript:chat('+data.sender_id+', \''+data.sender+'\', \''+data.sender_name+'\')">'
                    +'<figure class="'+data.ost+'">'+data.avatar+'</figure>'
                    +'<div class="sp"><span>'+data.sender_name+'</span><small>@'+data.sender+'</small></div>'
                    +'<blink class="_rc-num">'+num+'</blink><div class="ub_online-btns"><div class="challenge_btn12 ch"><span>Chat</span></div>'
                    +'</div>'
                +'</a>'
            +'</li>';
            jQuery("._ud-my-chats ul").prepend(chatRow);
        // notify user
            playBeep();
            let isOldTitle = true;
            let oldTitle = document.title;
            let newTitle = "new message";
            let interval = null;
            function changeTitle() {
                document.title = isOldTitle ? oldTitle : newTitle;
                isOldTitle = !isOldTitle;
            }
            if (document.hidden) {
                interval = setInterval(changeTitle, 500);
            }
            jQuery(window).focus(function () {
                clearInterval(interval);
                jQuery("title").text(oldTitle);
            });
        // if chatbox open populate chat
            // let chatBoxId = '#chatbox_'+currentUsername.replace('.', '')+'_'+data.sender.replace('.', '');
            // if (jQuery('#chatbox_container').find(chatBoxId).length > 0) {
                let d = new Date();
                let hr = d.getHours();
                let min = d.getMinutes();
                let meridian = (hr < 12) ? 'am' : 'pm';
                let hours = (hr > 12) ? hr - 12 : hr;
                let minutes = (min < 10) ? "0"+min : min;
                let current_chat_time = hours+':'+minutes+' '+meridian;
                let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();
                let chatMessage = createLink(data.message);

                let headerId = '#h_'+data.receiver.replace('.', '')+'_'+data.sender.replace('.', '');
                if (jQuery('#oppchatwrap').find(headerId).length > 0) {
                    let chat_date_str = '';
                    if (jQuery("#oppchatwrap #oppchatbody").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
                        let chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
                    }
                    jQuery('#oppchatwrap #oppchatbody .current-chats').append(chat_date_str+'<div class="message-strip received"><div class="msg">'+chatMessage+'<span class="_dct">'+current_chat_time+'</span></div></div>');
                    jQuery('#oppchatwrap #oppchatbody').animate({scrollTop: 100000}, 'normal');
                }
            // }
        // store in chat session
            let ubUnreadChatsObj;
            if (document.cookie.indexOf('ubunreadchats') != -1) {
                ubUnreadChatsObj = jQuery.parseJSON(jQuery.cookie('ubunreadchats'));
                if (!(data.sender in ubUnreadChatsObj)) {
                    let un = +jQuery("._ud-my-chats .rcfid"+data.sender_id+" ._rc-num").text();
                    un = un + 1;
                    ubUnreadChatsObj[data.sender] = {num: un, user_id: data.sender_id};
                }
            } else {
                ubUnreadChatsObj = {[data.sender]: {un: 1, user_id: data.sender_id}};
            }
            jQuery.cookie('ubunreadchats', JSON.stringify(ubUnreadChatsObj), {expires: expireIn});
            // console.log(jQuery.cookie);
    });

// is user logged in
if (isUserLoggedIn) {
    let matchAreaCounter;
    /**
     * [getUserMatchAreaContent display participant's match area content]
     * @param  {integer} user_id       [user id]
     * @param  {integer} tournament_id [tournament id]
     */
    function getUserMatchAreaContent(user_id, tournament_id) {
        clearInterval(matchAreaCounter);
        let target = `${themeDir}user-bracket-match${+tournamentData.faster_bracket ? '-faster' : ''}.php`;
        jQuery.get(
            target,
            {action: 'get_user_match_content', tournament_id: tournament_id, current_player: user_id},
            function(response) {
                data = jQuery.parseJSON(response);
                let matchArea;
                matchArea = +tournamentData.faster_bracket ? createFasterMatchArea(data) : createMatchArea(data);
                jQuery("#current_match").html(matchArea);
                if ('match' in data) {
                    if (!data.player.is_score_reported && data.match.end_time_unix > data.match.now) {
                        let scorReportModal = createMatchReportScoreModal(data);
                        jQuery("#reportscoremodal").html(scorReportModal);
                    }
                    if (!data.match.fpissuereported) {
                        let foulPlayModal = createMatchReportFoulPlayModal(data);
                        jQuery("#reportfoulplaymodal").html(foulPlayModal);
                    }
                }
                remSecs = +jQuery(".rem-sec").attr('data-remsec');
                if (remSecs) if(remSecs > 0) startCountdown(remSecs);
                if ('chat' in data) {
                    if (data.tournament.state != 'complete' && data.chat.id) {
                        let chatBox = createMatchChatBox(data.chat);
                        jQuery(".group-chat-heading").show();
                        jQuery("#oppchatwrap").html(chatBox);
                        loadChatHistory(data.chat);
                    } else {
                        jQuery(".group-chat-heading").hide();
                        jQuery("#oppchatwrap").html('');
                    }
                } else {
                    jQuery("#oppchatwrap").html('<div class="_ocw-placeholder"></div>');
                }
            }
        );
    };

    getUserMatchAreaContent(userId, tournamentId);

    function createMatchArea(data) {
        // console.log(data)
        let matchArea = ``;

        if ('match' in data) {
            if ('finalist' == data.tournament.qualifying_players && data.last_round == data.match.round) {
                return `<div class="league-match-bx">
                    <p class="alert promo">You are promoted to main event.</p>
                </div>`
            }
        }

        // instruction
        if (data.instruction) {
            matchArea += `<div class="match-instructions-wrap">
                <div class="match-instructions">`;
                    if (data.bracket.state == 'underway') {
                        matchArea += `<p class="inst"><i class="fa fa-hand-o-right"></i> ${data.instruction}</p>`;
                    }
                matchArea += `</div>
            </div>`;
        }
        matchArea += ('match' in  data) ? `<div class="league-match-bx _cm-${data.match.match_id}" data-bracket="${data.bracket.bracket_id}" data-match_id="${data.match.match_id}">` : `<div class="league-match-bx _cm-" data-bracket="${data.bracket.bracket_id}" data-match_id="">`;
            /*if (data.message) {
                matchArea += `<p style="margin-bottom: 10px">${data.message}</p>`;
            }*/
            matchArea += `<ul>
                <li class="_pbox _p1box _uid-${data.player.user_id}">
                    <h4>
                        <strong>${data.player.name}</strong>
                        ${data.player.username ? '<span>@'+data.player.username+'</span>' : ''}
                    </h4>
                    <figure><img src="${data.player.avatar}" /></figure>
                    <div class="chk-col">`;
                    if ('match' in data) {
                        if (data.match.state == 'complete' && data.match.winner_ub_id) {
                            matchArea += `<p class="text-center match-result">${data.match.winner_ub_id == data.player.id ? '<span class="you-win">You won!</span>' : '<span class="you-lose">You lost!</span>'}</p>`;
                        }
                    }
                    if (tournamentData.game_id != 12217) {
                        matchArea += `<p class="teamsteam"><span>${tournamentData.network.replace(/_/g, ' ').toUpperCase()}: </span><br />${data.player.network_id}</p>`;
                    }
                    if ('match' in data) {
                        if (data.player.checkedin) {
                            if (data.opponent.checkedin) {
                                if (!data.player.is_score_reported) {
                                    if (data.match.now < data.match.end_time_unix) {
                                        if ([4833, 12217].includes(+tournamentData.game_id)) {
                                            if (data.match.state != 'complete') {
                                                matchArea += `<p>Finish your match in<br /><strong class="rem-sec" data-remsec="${data.match.match_end_rem_secs}">${data.match.match_end_rem_time}</strong></p>`;
                                            }
                                        } else {
                                            matchArea += `<p>Finish your match in<br /><strong class="rem-sec" data-remsec="${data.match.match_end_rem_secs}">${data.match.match_end_rem_time}</strong></p>`;
                                        }
                                        if (tournamentData.game_id == 12217) {
                                            matchArea += `<div class="_ma-btn">
                                                <form id="playMatchForm${data.match.match_id}" action="${data.match.play_chess_action}" method="post" target="_blank">
                                                    <input type="hidden" name="userid" value="${data.player.user_id}" />
                                                    <input type="hidden" name="bracket" value="${data.bracket.bracket_id}" />
                                                    <input type="hidden" name="match" value="${data.match.match_id}" />
                                                    <input type="hidden" name="matchtype" value="tournament" />
                                                    <input type="hidden" name="waittime" value="${data.tournament.waittime}" />
                                                    <button type="submit" class="report-btn ${data.match.state == 'complete' ? 'disabled' : ''}" ${data.match.state == 'complete' ? 'disabled' : ''}>Play Match</button>
                                                </form>
                                            </div>`;
                                        } else if (tournamentData.game_id == 4833) {
                                            if (data.match.server_ip && data.match.server_port) {
                                                matchArea += `<div class="_ma-btn"><a href="steam://connect/'+data.match.server_ip+':'+data.match.server_port+'" class="report-btn ${data.match.state == 'complete' ? 'disabled' : ''}" data-ip="'+data.match.server_ip+'" data-port="'+data.match.server_port+'" ${data.match.state == 'complete' ? 'disabled' : ''}>Join Server</a></div>`;
                                            } else {
                                                matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Join server</button></div>`;
                                            }
                                        } else {
                                            matchArea += `<div class="_ma-btn"><button class="report-btn ${data.match.fpissuereported ? 'disabled' : ''}" data-toggle="modal" data-target="#report_score_modal" ${data.match.fpissuereported ? 'disabled' : ''}>Submit Score</button></div>`;
                                        }
                                    } else {
                                        matchArea += `<p>Score report time expired</p>`;
                                        if (tournamentData.game_id == 12217) {
                                            matchArea += `<div class="_ma-btn"><button type="submit" class="report-btn disabled" disabled>Play Match</button></div>`;
                                        } else if (tournamentData.game_id == 4833) {
                                            matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Join server</button></div>`;
                                        } else {
                                            matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Submit Score</button></div>`;
                                        }
                                    }
                                } else {
                                    if (tournamentData.game_id == 12217) {
                                        matchArea += `<div class="_ma-btn"><button type="submit" class="report-btn disabled" disabled>Play Match</button></div>`;
                                    } else if (tournamentData.game_id == 4833) {
                                        matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Join server</button></div>`;
                                    } else {
                                        matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Submit Score</button></div>`;
                                    }
                                }
                            } else {
                                matchArea += `<p><i class="fa fa-check-circle" style="color: green"></i> Checked in</p>`;
                            }
                        } else {
                            if (data.match.checkin_start_time > data.match.now) {
                                matchArea += `<p>Check-in starts in<br /><strong class="rem-sec" data-remsec="${data.match.checkin_start_rem_secs}">${data.match.checkin_start_rem_time}</strong></p>
                                <div class="_ma-btn"><button disabled class="report-btn disabled dcb1">Check in</button></div>`;
                            } else {
                                if (data.match.now <= data.match.checkin_end_time) {
                                    matchArea += `<p>Check-in ends in<br /><strong class="rem-sec" data-remsec="${data.match.checkin_end_rem_secs}">${data.match.checkin_end_rem_time}</strong></p>
                                    <div class="_ma-btn"><button class="report-btn checkin-button" onclick="checkIn(${data.player.user_id}, ${data.match.match_id})">Check in</button></div>`;
                                } else {
                                    matchArea += `<p>Check-in time expired</p>`;
                                }
                            }
                        }
                    } else {
                        if (data.tournament.checkin_start_time > data.tournament.now) {
                            matchArea += `<p>Check-in starts in<br /><strong class="rem-sec" data-remsec="${data.tournament.checkin_start_rem_secs}">${data.tournament.checkin_start_rem_time}</strong></p>
                            <div class="_ma-btn"><button disabled class="report-btn disabled dcb1">Check in</button></div>`;
                        }
                    }
                    // code...
                    matchArea += `</div>
                </li>
                <li class="mid">`;
                    if ('match' in data) {
                        if (data.match.round) matchArea += `<div class="round-num">${data.match.round < 0 ? 'LB Round: '+(-1 * data.match.round) : 'Round: '+data.match.round}</div>`;
                    }
                    matchArea += `<div class="vs">VS</div>`;
                    if ('match' in data) {
                        if (data.match.state == 'complete') {
                            matchArea += `<div class="match-scores">
                                <p>Scores</p>
                                <p class="_m-score-wrap">
                                    <span class="match-score cu-score">${data.player.score}</span> <span>-</span> 
                                    <span class="match-score opp-score">${data.opponent.score}</span>
                                </p>
                            </div>`;
                            if (data.match.match_id && tournamentData.game != 12217 && data.match.end_time_unix > data.match.now) matchArea += `<button class="btn btn-xs btn-report-foul-play ${!(data.player.checkedin && data.opponent.checkedin) || data.match.fpissuereported || data.player.is_score_reported ? 'disabled' : ''}" data-toggle="modal" data-target="#reportFoulPlayModal" ${!(data.player.checkedin && data.opponent.checkedin) || data.match.fpissuereported || data.player.is_score_reported ? 'disabled' : ''}>Report Foul Play</button>`;
                        }
                    }
                matchArea += `</li>`;
                matchArea += ('opponent' in data) ? `<li class="_pbox _p2box _uid-${data.opponent.user_id}">` : `<li class="_pbox _p2box _uid-">`;
                    if (!('match' in data)) {
                        if (data.tournament.checkin_start_time > data.tournament.now) {
                            matchArea += `<img src="${data.opponent_placeholder}" />`;
                        }
                    } else {
                        if (data.match.state == 'pending') {
                            matchArea += `<img src="${data.opponent_placeholder}" />`;
                        } else {
                            if ('opponent' in data) {
                                matchArea += `<h4>
                                    <strong>${data.opponent.name}</strong>
                                    ${data.opponent.name ? '<span>@'+data.opponent.username+'</span>' : ''}
                                </h4>
                                <figure><img src="${data.opponent.avatar}" /></figure>
                                <div class="chk-col">`;
                                    if (data.match.state == 'complete' && data.match.winner_ub_id) {
                                        matchArea += `<p class="text-center match-result">${data.match.winner_ub_id == data.opponent.id ? '<span class="you-win">Won</span>' : '<span class="you-lose">Lost</span>'}</p>`;
                                    }
                                    if (tournamentData.game_id != 12217) {
                                        if (data.player.checkedin && data.opponent.checkedin) {
                                            matchArea += `<p class="teamsteam"><span>${tournamentData.network.replace(/_/g, ' ').toUpperCase()}: </span><br />${data.opponent.network_id ? data.opponent.network_id : '&nbsp;'}</p>`;
                                        }
                                    }
                                    if (data.opponent.is_score_reported) {
                                        matchArea += `<p><span>Score reported</span></p>`;
                                    } else {
                                        if (data.opponent.checkedin) {
                                            matchArea += `<p><i class="fa fa-check-circle" style="color: green"></i> Checked in</p>`;
                                        } else {
                                            if (data.match.now > data.match.checkin_start_time && data.match.now < data.match.checkin_end_time) {
                                                if (data.player.checkedin) {
                                                    matchArea += `<p>Waiting to Check-in<br /><strong class="rem-sec" data-remsec="${data.match.checkin_end_rem_secs}">${data.match.checkin_end_rem_time}</strong></p>`;
                                                } else {
                                                    matchArea += `<p><span>Yet to check-in</span></p>`;
                                                }
                                            }
                                        }
                                    }
                                    matchArea += `<div class="opp-actions">
                                        <table class="table no-border" style="margin: 0">
                                            <tbody>
                                                <tr>
                                                    <td class="text-right" style="width: 50%">
                                                        <div class="chat-msg"><a href="javascript:chat(${data.opponent.user_id}, '${data.opponent.username}', '${data.opponent.name}')">Chat</a></div>
                                                    </td>
                                                    <td class="text-left" style="width: 50%">
                                                        <div class="inst-call click-to-call" data-callfrom="${data.player.user_id}" data-callto="${data.opponent.user_id}"><i class="fa fa-phone"></i> Call</div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>`;
                                matchArea += `</div>`;
                            }
                        }
                    }
                matchArea += `</li>
            </ul>
            <div class="clear"></div>`;
            if ('match' in data) {
                if (data.match.arbitration) {
                    matchArea += `<p class="text-center"><strong>Your match is in arbitration because your opponent reported different score.</strong></p>`;
                } else {
                    if (data.tournament.tournament_winner_id) {
                        matchArea += `<h4 class="text-center"><strong>You ${data.tournament.tournament_winner_id == data.player.id ? 'won' : 'lost'} the tournament.</strong></h4>`;
                    }
                }
            }
            if (data.bracket.state == 'pending') matchArea += `Round 1 checkin start time: <strong>${data.tournament.checkin_start_time_str}</strong>`;
            if (data.player.checkedin) {
                jQuery.each(data.match.notes, function(index, note) {
                    if (note) matchArea += `<p class="match-note"><i class="fa fa-hand-o-right"></i> ${note}</p>`;
                });
            }
        matchArea += `</div>`;
        return matchArea;
    }

    function createFasterMatchArea(data) {
        let matchArea = '';

        if ('match' in data) {
            if ('finalist' == data.tournament.qualifying_players && data.last_round == data.match.round) {
                return `<div class="league-match-bx">
                    <p class="alert promo">You are promoted to main event.</p>
                </div>`
            }
        }

        // instruction
        if (data.faster_bracket_note) {
            jQuery(".faster-bracket-note-wrap").html(`<p class="faster-bracket-note alert alert-danger"><i class="fa fa-hand-o-right"></i> ${data.faster_bracket_note}</p>`);
        }
        if (data.instruction) {
            matchArea += `<div class="match-instructions-wrap">
                <div class="match-instructions">`;
                    if (data.bracket.state == 'underway') {
                        matchArea += `<p class="inst"><i class="fa fa-hand-o-right"></i> ${data.instruction}</p>`;
                    }
                matchArea += `</div>
            </div>`;
        }
        matchArea += ('match' in  data) ? `<div class="league-match-bx _cm-${data.match.match_id}" data-bracket="${data.bracket.bracket_id}" data-match_id="${data.match.match_id}">` : `<div class="league-match-bx _cm-" data-bracket="${data.bracket.bracket_id}" data-match_id="">`;
            /*if (data.message) {
                matchArea += `<p style="margin-bottom: 10px">${data.message}</p>`;
            }*/
            matchArea += `<ul>
                <li class="_pbox _p1box _uid-${data.player.user_id}">
                    <h4>
                        <strong>${data.player.name}</strong>
                        ${data.player.username ? '<span>@'+data.player.username+'</span>' : ''}
                    </h4>
                    <figure><img src="${data.player.avatar}" /></figure>
                    <div class="chk-col">`;
                    if ('match' in data) {
                        if (data.match.state == 'complete' && data.match.winner_ub_id) {
                            matchArea += `<p class="text-center match-result">${data.match.winner_ub_id == data.player.id ? '<span class="you-win">You won!</span>' : '<span class="you-lose">You lost!</span>'}</p>`;
                        }
                    }
                    if (tournamentData.game_id != 12217) {
                        matchArea += `<p class="teamsteam"><span>${tournamentData.network.replace(/_/g, ' ').toUpperCase()}: </span><br />${data.player.network_id}</p>`;
                    }
                    if ('match' in data) {
                        if (data.match.state == 'open') {
                            if (data.player.checkedin) {
                                if (data.opponent.checkedin) {
                                    if (!data.player.is_score_reported) {
                                        if (data.match.now < data.match.end_time_unix) {
                                            if ([4833, 12217].includes(+tournamentData.game_id)) {
                                                if (data.match.state != 'complete') {
                                                    matchArea += `<p>Finish your match in<br /><strong class="rem-sec" data-remsec="${data.match.match_end_rem_secs}">${data.match.match_end_rem_time}</strong></p>`;
                                                }
                                            } else {
                                                matchArea += `<p>Finish your match in<br /><strong class="rem-sec" data-remsec="${data.match.match_end_rem_secs}">${data.match.match_end_rem_time}</strong></p>`;
                                            }
                                            if (tournamentData.game_id == 12217) {
                                                matchArea += `<div class="_ma-btn">
                                                    <form id="playMatchForm${data.match.match_id}" action="${data.match.play_chess_action}" method="post" target="_blank">
                                                        <input type="hidden" name="userid" value="${data.player.user_id}" />
                                                        <input type="hidden" name="bracket" value="${data.bracket.bracket_id}" />
                                                        <input type="hidden" name="match" value="${data.match.match_id}" />
                                                        <input type="hidden" name="matchtype" value="tournament" />
                                                        <input type="hidden" name="waittime" value="${data.tournament.waittime}" />
                                                        <button type="submit" class="report-btn ${data.match.state == 'complete' ? 'disabled' : ''}" ${data.match.state == 'complete' ? 'disabled' : ''}>Play Match</button>
                                                    </form>
                                                </div>`;
                                            } else if (tournamentData.game_id == 4833) {
                                                if (data.match.server_ip && data.match.server_port) {
                                                    matchArea += `<div class="_ma-btn"><a href="steam://connect/'+data.match.server_ip+':'+data.match.server_port+'" class="report-btn ${data.match.state == 'complete' ? 'disabled' : ''}" data-ip="'+data.match.server_ip+'" data-port="'+data.match.server_port+'" ${data.match.state == 'complete' ? 'disabled' : ''}>Join Server</a></div>`;
                                                } else {
                                                    matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Join server</button></div>`;
                                                }
                                            } else {
                                                matchArea += `<div class="_ma-btn"><button class="report-btn ${data.match.fpissuereported ? 'disabled' : ''}" data-toggle="modal" data-target="#report_score_modal" ${data.match.fpissuereported ? 'disabled' : ''}>Submit Score</button></div>`;
                                            }
                                        } else {
                                            matchArea += `<p>Score report time expired</p>`;
                                            if (tournamentData.game_id == 12217) {
                                                matchArea += `<div class="_ma-btn"><button type="submit" class="report-btn disabled" disabled>Play Match</button></div>`;
                                            } else if (tournamentData.game_id == 4833) {
                                                matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Join server</button></div>`;
                                            } else {
                                                matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Submit Score</button></div>`;
                                            }
                                        }
                                    } else {
                                        if (tournamentData.game_id == 12217) {
                                            matchArea += `<div class="_ma-btn"><button type="submit" class="report-btn disabled" disabled>Play Match</button></div>`;
                                        } else if (tournamentData.game_id == 4833) {
                                            matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Join server</button></div>`;
                                        } else {
                                            matchArea += `<div class="_ma-btn"><button class="report-btn disabled" disabled>Submit Score</button></div>`;
                                        }
                                    }
                                } else {
                                    matchArea += `<p><i class="fa fa-check-circle" style="color: green"></i> Checked in</p>`;
                                }
                            } else {
                                if (data.match.checkin_start_time > data.match.now) {
                                    matchArea += `<p>Check-in starts in<br /><strong class="rem-sec" data-remsec="${data.match.checkin_start_rem_secs}">${data.match.checkin_start_rem_time}</strong></p>
                                    <div class="_ma-btn"><button disabled class="report-btn disabled dcb1">Check in</button></div>`;
                                } else {
                                    if (data.match.now <= data.match.checkin_end_time) {
                                        matchArea += `<p>Check-in ends in<br /><strong class="rem-sec" data-remsec="${data.match.checkin_end_rem_secs}">${data.match.checkin_end_rem_time}</strong></p>
                                        <div class="_ma-btn"><button class="report-btn checkin-button" onclick="checkIn(${data.player.user_id}, ${data.match.match_id})">Check in</button></div>`;
                                    } else {
                                        matchArea += `<p>Check-in time expired</p>`;
                                    }
                                }
                            }
                        } else {
                            if (data.match.state) {
                                matchArea += `<div class="waiting-for-opponent">
                                    <p>Waiting for opponent</p>
                                    <p class="waiting-opponent-time">`;
                                    if (data.match.opponent_last_match_end_time_unix && (data.match.opponent_last_match_end_time_unix > data.match.now)) {
                                        let mwt = Math.ceil((data.match.opponent_last_match_end_time_unix - data.match.now) / 60);
                                        matchArea += `Max Wait Time: ${mwt}min${mwt > 1 ? 's' : ''}`;
                                    }
                                    matchArea += `</p>
                                </div>`;
                            }
                            if (data.match.opponent_last_match_end_time_unix && (data.match.opponent_last_match_end_time_unix > data.match.now)) {
                                let maxWaitTime = Math.ceil((data.match.opponent_last_match_end_time_unix - data.match.now) / 60);
                                let maxWaitTimeInterval = setInterval(function(){
                                    if (maxWaitTime > 0) {
                                        jQuery(".waiting-opponent-time").html(`Max Wait Time: ${maxWaitTime} min${maxWaitTime > 1 ? 's' : ''}`);
                                    } else {
                                        jQuery(".waiting-opponent-time").html('');
                                        clearInterval(maxWaitTimeInterval);
                                    }
                                    maxWaitTime--;
                                }, 60000);
                            }
                        }
                    } else {
                        if (data.tournament.checkin_start_time > data.tournament.now) {
                            matchArea += `<p>Check-in starts in<br /><strong class="rem-sec" data-remsec="${data.tournament.checkin_start_rem_secs}">${data.tournament.checkin_start_rem_time}</strong></p>
                            <div class="_ma-btn"><button disabled class="report-btn disabled dcb1">Check in</button></div>`;
                        }
                    }
                    matchArea += `</div>
                </li>
                <li class="mid">`;
                    if ('match' in data) {
                        if (data.match.round) matchArea += `<div class="round-num">${data.match.round < 0 ? 'LB Round: '+(-1 * data.match.round) : 'Round: '+data.match.round}</div>`;
                    }
                    matchArea += `<div class="vs">VS</div>`;
                    if ('match' in data) {
                        if (data.match.state == 'complete') {
                            matchArea += `<div class="match-scores">
                                <p>Scores</p>
                                <p class="_m-score-wrap">
                                    <span class="match-score cu-score">${data.player.score}</span> <span>-</span> 
                                    <span class="match-score opp-score">${data.opponent.score}</span>
                                </p>
                            </div>`;
                            if (data.match.match_id && tournamentData.game != 12217 && data.match.end_time_unix > data.match.now) matchArea += `<button class="btn btn-xs btn-report-foul-play ${!(data.player.checkedin && data.opponent.checkedin) || data.match.fpissuereported || data.player.is_score_reported ? 'disabled' : ''}" data-toggle="modal" data-target="#reportFoulPlayModal" ${!(data.player.checkedin && data.opponent.checkedin) || data.match.fpissuereported || data.player.is_score_reported ? 'disabled' : ''}>Report Foul Play</button>`;
                        }
                    }
                matchArea += `</li>`;
                matchArea += ('opponent' in data) ? `<li class="_pbox _p2box _uid-${data.opponent.user_id}">` : `<li class="_pbox _p2box _uid-">`;
                    if (!('match' in data)) {
                        if (data.tournament.checkin_start_time > data.tournament.now) {
                            matchArea += `<img src="${data.opponent_placeholder}" />`;
                        }
                    } else {
                        if (data.match.state == 'pending') {
                            matchArea += `<img src="${data.opponent_placeholder}" />`;
                        } else {
                            if ('opponent' in data) {
                                matchArea += `<h4>
                                    <strong>${data.opponent.name}</strong>
                                    ${data.opponent.name ? '<span>@'+data.opponent.username+'</span>' : ''}
                                </h4>
                                <figure><img src="${data.opponent.avatar}" /></figure>
                                <div class="chk-col">`;
                                    if (data.match.state == 'complete' && data.match.winner_ub_id) {
                                        matchArea += `<p class="text-center match-result">${data.match.winner_ub_id == data.opponent.id ? '<span class="you-win">Won</span>' : '<span class="you-lose">Lost</span>'}</p>`;
                                    }
                                    if (tournamentData.game_id != 12217) {
                                        if (data.player.checkedin && data.opponent.checkedin) {
                                            matchArea += `<p class="teamsteam"><span>${tournamentData.network.replace(/_/g, ' ').toUpperCase()}: </span><br />${data.opponent.network_id ? data.opponent.network_id : '&nbsp;'}</p>`;
                                        }
                                    }
                                    if (data.opponent.is_score_reported) {
                                        matchArea += `<p><span>Score reported</span></p>`;
                                    } else {
                                        if (data.opponent.checkedin) {
                                            matchArea += `<p><i class="fa fa-check-circle" style="color: green"></i> Checked in</p>`;
                                        } else {
                                            if (data.match.now > data.match.checkin_start_time && data.match.now < data.match.checkin_end_time) {
                                                if (data.player.checkedin) {
                                                    matchArea += `<p>Waiting to Check-in<br /><strong class="rem-sec" data-remsec="${data.match.checkin_end_rem_secs}">${data.match.checkin_end_rem_time}</strong></p>`;
                                                } else {
                                                    matchArea += `<p><span>Yet to check-in</span></p>`;
                                                }
                                            }
                                        }
                                    }
                                    matchArea += `<div class="opp-actions">
                                        <table class="table no-border" style="margin: 0">
                                            <tbody>
                                                <tr>
                                                    <td class="text-right" style="width: 50%">
                                                        <div class="chat-msg"><a href="javascript:chat(${data.opponent.user_id}, '${data.opponent.username}', '${data.opponent.name}')">Chat</a></div>
                                                    </td>
                                                    <td class="text-left" style="width: 50%">
                                                        <div class="inst-call click-to-call" data-callfrom="${data.player.user_id}" data-callto="${data.opponent.user_id}"><i class="fa fa-phone"></i> Call</div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>`;
                                matchArea += `</div>`;
                            }
                        }
                    }
                matchArea += `</li>
            </ul>
            <div class="clear"></div>`;
            if ('match' in data) {
                if (data.match.arbitration) {
                    matchArea += `<p class="text-center"><strong>Your match is in arbitration because your opponent reported different score.</strong></p>`;
                } else {
                    if (data.tournament.tournament_winner_id) {
                        matchArea += `<h4 class="text-center"><strong>You ${data.tournament.tournament_winner_id == data.player.id ? 'won' : 'lost'} the tournament.</strong></h4>`;
                    }
                }
            }
            if (data.bracket.state == 'pending') matchArea += `Round 1 checkin start time: <strong>${data.tournament.checkin_start_time_str}</strong>`;
            if (data.player.checkedin) {
                jQuery.each(data.match.notes, function(index, note) {
                    if (note) matchArea += `<p class="match-note"><i class="fa fa-hand-o-right"></i> ${note}</p>`;
                });
            }
        matchArea += `</div>`;
        return matchArea;
    }

    function createMatchReportScoreModal(data) {
        let modal = '';
        let matchType = 0;
        switch (tournamentData.match_type) {
            case 'ko':
                matchType = 1;
                break;

            case 'bo3':
                matchType = 3;
                break;

            case 'bo5':
                matchType = 5;
                break;

            case 'bo6':
                matchType = 6;
                break;
        }
        modal += `<div id="report_score_modal" class="modal fade reportscorebx" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body report-bx">
                        <h3>Submit Score</h3>
                        <h4>Select Winner</h4>
                        <div class="user-report">
                            <form action="${data.match.report_score_action}" method="post" enctype="multipart/form-data" onsubmit="return reportScore()">
                                <input type="hidden" name="match_type" id="match_type" value="${matchType}" />
                                <ul class="score-user-radio">
                                    <li>
                                        <input type="radio" id="foption" name="winner" value="${data.player.user_id}" />
                                        <label for="foption">${data.player.name}</label>
                                        <div class="check"></div>
                                    </li>
                                    <li>
                                        <input type="radio" id="soption" name="winner" value="${data.opponent.user_id}" />
                                        <label for="soption">${data.opponent.name}</label>
                                        <div class="check"><div class="inside"></div></div>
                                    </li>
                                </ul>
                                <p class="report-score-error select-winner-error"><small></small></p>
                                <h4>Enter Scores</h4>`;
                                modal += `<div class="scrore-form match-type-${tournamentData.match_type > 1 ? 'multiple' : 'single'}">
                                    <input type="number" min="0" id="player_${data.player.user_id}" name="${data.player.is_player1 ? 'player1_score' : 'player2_score'}" placeholder="${matchType > 1 ? 'No. of matches won by '+data.player.name : data.player.name+'\'s score'}" />
                                    <input type="number" min="0" id="player_${data.opponent.user_id}" name="${data.opponent.is_player1 ? 'player1_score' : 'player2_score'}" placeholder="${matchType > 1 ? 'No. of matches won by '+data.opponent.name : data.opponent.name+'\'s score'}" />
                                </div>
                                <p class="report-score-error score-error"><small></small></p>
                                <p class="report-score-error invalid-score-error"><small></small></p>
                                <div class="scorefile-upload">
                                    <div class="upload-btn-wrapper match-type-${matchType}">`;
                                        if (matchType > 1) {
                                            modal += `<h4>Upload screenshots</h4><div class="clear"></div>`;
                                            for (let i = 1; i <= matchType; i++) {
                                                modal += `<div class="upload-file">
                                                    <input type="file" id="ss${i}" name="screenshot[]" class="screenshot" onchange="selectScreenshot(this.id)" />
                                                    <p class="file-name"><small></small></p>
                                                    <label for="ss${i}" class="btn"> + Match ${i}</label>
                                                </div>`;
                                            }
                                        } else {
                                            modal += `<input type="file" id="ss" name="screenshot" class="screenshot" onchange="selectScreenshot(this.id)" />
                                            <p class="file-name"><small></small></p>
                                            <label for="ss" class="btn"> + Upload screenshot</label>`;
                                        }
                                    modal += `</div>
                                    <p class="report-score-error upload-screenshot-error"><small></small></p>
                                    <p class="report-score-error saving-score-error"><small></small></p>
                                </div>
                                <div class="container">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="_uss-note" style="margin-bottom: 10px">
                                                <p><small><i class="fa fa-caret-right"></i> Screenshot must clearly show you and your opponenet\'s gamename and score.</small></p>
                                                <p><small><i class="fa fa-caret-right"></i> Reporting Wrong Score may result in disqualification.</small></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <textarea class="form-control" name="comment" placeholder="Write comment... (optional)" rows="3" autocomplete="off"></textarea>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <input type="hidden" name="tmnt" value="${tournamentData.tournament_id}" />
                                            <input type="hidden" name="game" value="${tournamentData.game_id}" />
                                            <input type="hidden" name="network" value="${tournamentData.network}" />
                                            <input type="hidden" name="type" value="${tournamentData.type}" />
                                            <input type="hidden" name="participation_type" value="${tournamentData.participation_type}" />
                                            <input type="hidden" name="bkt" value="${data.bracket.bracket_id}">
                                            <input type="hidden" name="round" value="${data.match.round}" />
                                            <input type="hidden" name="match_id" value="${data.match.match_id}" />
                                            <input type="hidden" name="player1_ch_id" value="${data.match.player1_id}" />
                                            <input type="hidden" name="player2_ch_id" value="${data.match.player2_id}" />
                                            <input type="hidden" name="${data.player.is_player1 ? 'player1_id' : 'player2_id'}" value="${data.player.user_id}">
                                            <input type="hidden" name="${data.opponent.is_player1 ? 'player1_id' : 'player2_id'}" value="${data.opponent.user_id}">
                                            <input type="hidden" id="submitted_by" name="submitted_by" value="${data.player.user_id}">
                                            <input type="submit" value="Submit Score" name="save_score" class="report-sbt" />
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>`;
        return modal;
    }

    function createMatchReportFoulPlayModal(data) {
        let modal = '';
        modal += `<div id="reportFoulPlayModal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form id="rfpForm" action="${data.match.report_foul_play_action}" method="post" enctype="multipart/form-data" onsubmit="return validateFoulPlayForm()">
                        <div class="modal-header">
                            <h3 class="modal-title">Report Foul Play</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 12px; top: 13px;">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <table class="table no-border">
                                <tr>
                                    <td>
                                        <label for="issue_type">Upload Screenshot:</label>
                                        <input type="file" name="foul_play_screenshot" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="comment">Comment:</label>
                                        <textarea id="comment" name="comment" class="form-control" rows="6"></textarea>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <input type="hidden" name="game_id" value="${tournamentData.game_id}" />
                            <input type="hidden" name="item_name" value="tournament" />
                            <input type="hidden" name="item_id" value="${tournamentData.tournament_id}" />
                            <input type="hidden" name="bracket_id" value="${data.bracket.bracket_id}" />
                            <input type="hidden" name="match_id" value="${data.match.match_id}" />
                            <input type="hidden" name="redirect_to" value="${tournamentData.url}" />
                            <button type="submit" class="btn ub-btn-dark-red">Submit</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>`;
        return modal;
    }

    function createMatchChatBox(chat) {
        if (jQuery('body').find('#oppchatwrap').length == 0) return;
        let chatBox = `<header id="h_${cuData.user_login.replace(/./g, '')}_${chat.username.replace(/./g, '')}">
            <div class="opp-chat-avatar ${chat.online}"><img src="${chat.avatar}" /></div>
            <div class="opp-chat-user-details">
                <p class="_ocu-name">${chat.name}</p>
                <p class="_ocu-username">@${chat.username}</p>
            </div>
        </header>
        <div id="oppchatbody" class="chat-body">
            <div class="chat-history">${loadingSpinner(15)}</div>
            <div class="current-chats"></div>
        </div>
        <footer>
            <input type="text" name="opp_chat_message" data-sendto="${chat.username}" placeholder="Message" autocomplete="off" />
            <button name="send_opp_chat" title="Send"><i class="fa fa-paper-plane"></i></button>
        </footer>`;
        return chatBox;
    }

    function loadChatHistory(chat) {
        jQuery.get(
            siteUrl+"ubchat/ajax.php",
            {action: 'get_room_id', user1: cuData.user_login, user2: chat.username},
            function(roomId) {
                if (roomId) {
                    jQuery.get(
                        siteUrl+"ubchat/index.php",
                        {action: 'history', me: cuData.user_login, room_id: roomId, count: 10},
                        function(history) {
                            // console.log('Santy--'+history);
                            if (history) {
                                jQuery('#oppchatbody .chat-history').html(history);
                                jQuery('#oppchatbody .current-chats').html('');
                                jQuery('#oppchatbody').animate({scrollTop: 100000}, 'normal');            
                            } else {
                                jQuery('#oppchatbody .chat-history').html('');
                            }
                        }
                    );
                } else {
                    jQuery('#oppchatbody .chat-history').html('');
                }
            }
        );
    }

    function startCountdown(remSecs) {
        matchAreaCounter = setInterval(function(){
            remTime(remSecs);
            remSecs--;
        }, 1000);
    };

    function showTournamentJoinError(errorMessage) {
        if (!errorMessage) return

        jQuery("#tournamentJoinModal ._ubs_model_row").addClass('sorry').removeClass('thanks');
        jQuery("#tournamentJoinModal ._ubs_model_row h3").text('Sorry');
        jQuery("#tournamentJoinModal ._ubs_model_row p").html(errorMessage);
        jQuery("#tournamentJoinModal").modal('show');
    }

    /**
     * [joinTournament display join tournament modal]
     */
    function joinTournament(tournament = null, user = null) {
        jQuery("._tjb > a").attr('disabled', 'disabled').addClass('disabled');
        jQuery("._tjb > a").html(`${loadingSpinner(15)} Processing..`);
        jQuery(".qualifier-join-button > a").html(`${loadingSpinner(15)} Processing..`);

        if (!tournament && !aiel) {
            tournament = tournamentId
        }

        if (!tournament) return

        user = user || currentUserId

        jQuery.post(
            `${themeDir}ajax.php`,
            {action: 'user_tournament_join_status', tournament, user},
            function(response) {
                response = JSON.parse(response);
                switch (response.status) {
                    case 'reg_not_open':
                        alertCont = '<p class="alert alert-danger">Registration not open yet.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'reg_closed':
                        alertCont = '<p class="alert alert-danger">Registration closed.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'complete':
                        alertCont = '<p class="alert alert-danger">Tournament is complete.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'live':
                        alertCont = '<p class="alert alert-danger">Tournament is live.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'nested':
                        alertCont = '<p class="alert alert-danger">Please join qualifier tournament.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'user_not_logged_in':
                        alertCont = '<p class="alert alert-danger">Please login first.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'not_paid_gaming_eligible':
                        alertCont = '<p class="alert alert-danger">You are not eligible to join a paid tournament.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'not_clan_member':
                        jQuery("#createClanModal").modal('show');
                        break;
                    case 'not_clan_owner':
                        // if (clanTitle) {
                            alertCont = `<div class="alert alert-danger">
                                <p>${response.message}</p>
                                <p>You must be a clan owner to join this tournament.</p></div>`;
                        // }
                        showTournamentJoinError(alertCont);
                        break;
                    case 'already_joined':
                        alertCont = '<p class="alert alert-danger">You have already joined this tournament.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'qualifier_limit_exceeded':
                        alertCont = '<p class="alert alert-danger">You have already joined other qualifier tournament. You can only join upto '+maxQualifiersToJoin+' Qualifier tournaments of this Event.</p>';
                        showTournamentJoinError(alertCont);
                        break;
                    case 'free_tournaments_limit_exceeded':
                    case 'already_joined_a_free_tournament_on_same_game':
                        if ('buy_subscription' == response.act) {
                            jQuery('#buySubscriptionModal').modal('show')
                            if (response.message) {
                                const $wrap = jQuery('#buySubscriptionModal .play-subs-info')
                                if ($wrap.find('._sem').length == 0)
                                    $wrap.prepend(`<p class="_sem alert alert-danger"><i class="fa fa-warning"></i> ${response.message}</p>`)
                                else
                                    $wrap.find('._sem').html(`<i class="fa fa-warning"></i> ${response.message}`)
                            }
                            return
                        }
                        break;
                    case 'network_id_not_found':
                        jQuery("#get_network_modal").modal('show');
                        break;
                    case 'allowed':
                        if ('clan' == tournamentType) {
                            let tournament_id = tournamentToJoin || tournament
                            jQuery("#chooseClanMembersModal input[name='tournament_to_join']").val(tournament_id)
                            jQuery("#chooseClanMembersModal").modal('show');
                        } else {
                            if (!feeCash && !(coinParticipation && feeCoins)) {
                                // free tournament                                
                                jQuery.ajax({
                                    type: "POST",
                                    url: `${themeDir}ajax.php`,
                                    dataType: 'json',
                                    data: {action: 'join_tournament', user, tournament},
                                    beforeSend: function() {},
                                    success: function(data, textStatus, jqXHR){
                                        // console.log(data)
                                        if (!data.result) {
                                            jQuery("._tjb > a").html(buttonData).removeAttr('disabled').removeClass('disabled');
                                            jQuery("#tournamentJoinModal ._ubs_model_row").addClass('sorry').removeClass('thanks');
                                            jQuery("#tournamentJoinModal ._ubs_model_row h3").text('Sorry');
                                            jQuery("#tournamentJoinModal ._ubs_model_row p").text(data.message);
                                            jQuery("#tournamentJoinModal").modal('show');
                                        } else {
                                            jQuery("._tjb > a").text('Registered');
                                            // <div class="_t-players">Players: <strong>1/8</strong></div>
                                            jQuery("._t-players").html(`Players: <strong>${participants + 1}${maxParticipants ? `/${maxParticipants}` : ''}</strong>`);
                                            let cashHtml = `Rs. ${Math.round(data.cash)} <small>Deposits</small>`;
                                            let bonusCashHtml = `Rs. ${Math.round(data.bonus_cash)} <small>Bonus</small>`;
                                            jQuery('.leave-tournament').prepend('<a href="javascript:leaveTournament()">Leave tournament</a> ');
                                            jQuery(".get-deposit-cash").html(cashHtml);
                                            jQuery(".get-bonus-cash").html(bonusCashHtml);
                                            jQuery("#tournamentJoinModal ._ubs_model_row").addClass('thanks').removeClass('sorry');
                                            jQuery("#tournamentJoinModal ._ubs_model_row h3").text('Thanks');
                                            jQuery("#tournamentJoinModal ._ubs_model_row p").text(data.message);
                                            jQuery('#tournamentJoinModal .join_now_model').append(`<input type="hidden" id="tournament_link" name="tournament_link" value="${data.tournament_link}">`)
                                            jQuery("#tournamentJoinModal").modal('show');
                                            getUserMatchAreaContent(user, tournament);
                                            // location.reload();
                                        }
                                    }
                                });
                            } else {
                                // paid tournament
                                displayJoinTournamentModal();
                                jQuery("._tjb > a").html(buttonData).removeAttr('disabled').removeClass('disabled');
                            }
                        }
                        break;
                } // end of switch
            }
        );
    }

    function remTime(remSecs) {
        let str = '';
        if (remSecs > 0) {
            let d = Math.floor(remSecs / 86400);
            let h = Math.floor(remSecs % 86400 / 3600);
            let hh = h < 10 ? '0'+h : h;
            let m = Math.floor(remSecs % 86400 % 3600 / 60);
            let mm = m < 10 ? '0'+m : m;
            let s = Math.floor(remSecs % 86400 % 3600 % 60);
            let ss = s < 10 ? '0'+s : s;
            if (d > 0) {
                let remSecTxt = d;
                remSecTxt += d > 1 ? ' days' : ' day';
                remSecTxt += ', '+hh+':'+mm+':'+ss+' hrs';
                jQuery(".rem-sec").html(remSecTxt);
                return 0;
            }
            if (h > 0) {
                jQuery(".rem-sec").html(hh+':'+mm+':'+ss+' hrs');
                return 0;
            }
            if (m > 0) {
                jQuery(".rem-sec").html(mm+':'+ss+' mins');
                return 0;
            }
            if (s > 0) {
                jQuery(".rem-sec").html(ss+' seconds');
                return 0;
            }
        } else {
            jQuery(".rem-sec").html(str);
            // if (jQuery("#report_score_modal").is(":hidden")) {
                getUserMatchAreaContent(userId, tournamentId);
            // }
        }
    }

    /**
     * [checkIn user check in for a match]
     * @param  {integer} user_id  [user id]
     * @param  {integer} match_id [match id]
     */
    function checkIn(user_id, match_id) {
        let checkin_text = `${loadingSpinner(20)} Checking in...`;
        jQuery(".checkin-button").html(checkin_text);
        jQuery.get(
            `${themeDir}ajax.php`,
            {action: 'check_in', user_id: user_id, match_id: match_id},
            function(response) {
                if (response == 'failed') {
                    jQuery("#alertModal .alert-modal-content").html('<i class="fa fa-warning"></i> Checkin failed, please try again.');
                    jQuery("#alertModal").modal('show');
                } else {
                    jQuery(".checkin-button").html('Checked In').attr('disabled', 'disabled').addClass('disabled');
                    let responseArr = JSON.parse(response);
                    if (gameId == 4833) {
                        if (responseArr.length > 1) {
                            jQuery(".match-area-heading ._cmst").html(`${loadingSpinner(15)} Creating server...`);
                            jQuery.get(
                                `${themeDir}csgo-server.php`,
                                {action: 'start_server', match_id: match_id, match_type: 'tournament'},
                                function(res) {
                                    if (res == 'success') {
                                        jQuery(".match-area-heading ._cmst").html('');
                                    }
                                }
                            );
                        }
                    }
                    if (gameId == 12217) {
                        if (responseArr.length > 1) {
                            jQuery(".match-area-heading ._cmst").html(`${loadingSpinner(15)} Creating match...`);
                            jQuery.get(
                                themeDir+'ajax.php',
                                {action: 'chess_match_start', match_id: match_id},
                                function(matchId) {
                                    if (matchId != 'false') {
                                        jQuery(".match-area-heading ._cmst").html('');
                                        /*let src = `${siteUrl}/play/index.php?user=${currentUsername}&gameid=${matchId}`;
                                        jQuery("#chess_match_area iframe").attr('src', src);
                                        jQuery('#chess_match_area').show();*/
                                    }
                                }
                            );
                        }
                    }
                    getUserMatchAreaContent(userId, tournamentId);
                }
            }
        );
    };

    // update match area
    bracketChannel = pusher.subscribe('tournament_bracket');
    matchChannel = pusher.subscribe('tournament_bracket_match');

    matchChannel.bind('checkin', function(data){
        if (jQuery(".league-match-bx").attr('data-match_id') == data.match) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    matchChannel.bind('servercreated', function(data){
        if (jQuery(".league-match-bx").attr('data-match_id') == data.match_id) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    matchChannel.bind('checkin_start', function(data){
        if (jQuery(".league-match-bx").attr('data-bracket') == data.bracket) {
            getUserMatchAreaContent(userId, tournamentId);
            jQuery(".r1-cit").remove();
        }
    });
    matchChannel.bind('score_reported', function(data){
        if (jQuery(".league-match-bx").attr('data-match_id') == data.match) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    bracketChannel.bind('start', function(data){
        if (jQuery(".league-match-bx").attr('data-bracket') == data.bracket) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    bracketChannel.bind('schedule_updated', function(data){
        if (jQuery(".league-match-bx").attr('data-bracket') == data.bracket) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    matchChannel.bind('match_note', function(data){
        if (jQuery(".league-match-bx").attr('data-match_id') == data.match) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    chessMatch = pusher.subscribe('chessmatch');

    chessMatch.bind('update', function(data){
        let bracketMatchId = jQuery(".league-match-bx").data('match_id');
        if (data.tmatchid == bracketMatchId) {
            getUserMatchAreaContent(userId, tournamentId);
        }
    });

    chessMatch.bind('created', function(data){
        // console.log('chess match created: '+JSON.stringify(data));
        if (data.chessmatchid && ((currentUsername == data.white) || (currentUsername == data.black))) {
            getUserMatchAreaContent(userId, tournamentId);
            // console.log('display chess match');
            /*jQuery(".match-area-heading ._cmst").html('');
            let src = siteUrl+'play/index.php?user='+currentUsername+'&gameid='+data.chessmatchid;
            jQuery("#chess_match_area iframe").attr('src', src);
            jQuery('#chess_match_area').show();*/
            // location.reload();
        }
    });

    // save schedule
    jQuery(document).on("blur", "._br-time", function(){
        $this = jQuery(this);
        let rTime = $this.val();
        let bracket = $this.data('bracket');
        let round = $this.data('round');
        let se = $this.data('time');
        jQuery.get(
            themeDir+'ajax.php',
            {action: 'save_bracket_schedule', bracket: bracket, round: round, time: se, round_time: rTime},
            function(response) {
                $this.next('.response-text').text(response);
                $this.next('.response-text').fadeIn("fast");
                $this.next('.response-text').fadeOut(10000);
            }
        );
    });
}   // end of isUserLoggedIn
function updatePoolNotes(id, poolId){
    var roomId = jQuery('#'+id+' input[name=roomId]').val();
    var roomPassword = jQuery('#'+id+' input[name=roomPassword]').val();
    if(roomId.length > 0 && roomPassword.length > 0){
        jQuery('#'+id+' button').html('Wait...');
        var note = "RoomId="+roomId+",Password="+roomPassword;
        jQuery.ajax({
            url: `${themeDir}ajax.php`,
            type: 'POST',
            dataType: 'json',
            data: {action: 'update_pool_notes', poolId, note},
            success: function(data) {
                if(data.result=='success'){
                    jQuery('#'+id+' button').html('Updated');
                } else if(data.result=='fail'){
                    jQuery('#'+id+' button').prepend('<p class="error">Please try again.</p>');
                    jQuery('#'+id+' button').html('Save');
                } else if(data.result=='incomplete'){
                    jQuery('#'+id+' button').prepend('<p class="error">Room Id and/or password incomplete</p>');
                    jQuery('#'+id+' button').html('Save');
                }
            }
        });
    }

}

</script><div id="pool_participants_modal" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h2></h2>
                    </div>
                    <div class="modal-body">
                        <h4><span>Schedule</span></h4>
                        <div id="pool_schedule"><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" alt="Loading..." style="width: 35px; height: 35px" /></div>
                        <h4><span>Participants</span></h4>
                        <div id="pool_participants"><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" alt="Loading..." style="width: 35px; height: 35px" /></div>
                    </div>
                </div>
            </div>
        </div><div id="pqModal" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-body">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 4px; top: 3px;"><span aria-hidden="true">&times;</span></button>
                        <h2 class="_pqmh heading-bg"><span></span></h2>
                        <div class="container">
                            <div id="pqContent" class="row" style="background-color: #CCC; padding-top: 15px; padding-bottom: 8px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div><script>
userPool = "";

function getUserPoolCheckInContent(user_id, tournament_id) {
    jQuery.get(
        `${themeDir}ajax.php`, {
            action: 'get_user_pool_checkin_content',
            user_id: user_id,
            tournament_id: tournamentId
        },
        function(response) {
            jQuery("#pool_checkin").html(response);
        }
    );
}
getUserPoolCheckInContent(userId, tournamentId);
/*var updatePoolCheckin = setInterval(function(){
    getUserPoolCheckInContent(userId, tournamentId);
}, 30000);*/

// update pool area
poolChannel = pusher.subscribe('tournament_pool');

poolChannel.bind('start', function(data) {
    if (jQuery(".pool-chekin-wrapper").data('pool') == data.pool) {
        getUserPoolCheckInContent(userId, tournamentId);
    }
});

poolChannel.bind('schedule_updated', function(data) {
    if (jQuery(".pool-chekin-wrapper").data('pool') == data.pool) {
        getUserPoolCheckInContent(userId, tournamentId);
    }
});

poolChannel.bind('note', function(data) {
    if (jQuery(".pool-chekin-wrapper").data('pool') == data.pool) {
        getUserPoolCheckInContent(userId, tournamentId);
    }
});

jQuery(document).on('click', '.checkin-pool-trigger', function() {
    if (jQuery('.pool-chekin-wrapper').find('.pool-checking-in').length > 0) {
        jQuery('.pool-checking-in').html(`${loadingSpinner(15)} Cheking in...`)
        jQuery('.pool-checking-in').removeClass('error')
    } else {
        jQuery('.pool-chekin-wrapper').append(
            `<p class="text-center pool-checking-in">${loadingSpinner(15)} Cheking in...</p>`)
    }

    jQuery.get(
        `${themeDir}ajax.php`, {
            action: 'checkin_pool',
            user: userId,
            pool: userPool
        },
        function(response) {
            response = jQuery.parseJSON(response)

            if ('success' != response.result) {
                if (jQuery('.pool-chekin-wrapper').find('.pool-checking-in').length > 0) {
                    jQuery('.pool-checking-in').html(
                        '<i class="fa fa-warning"></i> Checking failed, please try again!')
                    return
                }

                jQuery('.pool-chekin-wrapper').append(
                    '<p class="text-center pool-checking-in error"><i class="fa fa-warning"></i> Checking failed, please try again!</p>'
                    )
                return
            }

            jQuery('.pool-checking-in').remove()
            jQuery('.btn-pool-checkin').addClass('btn-success').removeClass(
                'checkin-pool-trigger ub-btn-dark-red')
            jQuery('.btn-pool-checkin .fa').addClass('fa-check').removeClass('fa-sign-in')
            jQuery('.btn-pool-checkin .checkin-text').html('Checked in<small>successfully</small>').css(
                'cursor', 'default')

            if (!response.note) return

            if (jQuery('.pool-chekin-wrapper').find('.ub-alert').length > 0) {
                jQuery('.pool-chekin-wrapper').find('.ub-alert').append(
                    `<p class="text-left">${response.note}</p><p class="text-left">Your slot number is ${response.slot}</p>`
                    )
                return
            }
            jQuery('.pool-chekin-wrapper').append(
                `<div class="ub-alert"><p class="text-left">${response.note}</p><p class="text-left">Your slot number is ${response.slot}</p></div>`
                )
        }
    )
});
</script>
<script>
function displayPools() {
    jQuery.get(
        `${themeDir}ajax.php`,
        {
            action: 'display_pools',
            tournament_id: "36617"
        },
        function(response) {
            jQuery("#pool_box").html(response);
        }
    );
}

jQuery(document).on('click', '.btn-pool', function() {
    jQuery("#pool_schedule").html(
        `<p class="text-center">${loadingSpinner(40)}<br /><small>Loading...</small></p>`);
    jQuery("#pool_participants").html(
        `<p class="text-center">${loadingSpinner(40)}<br /><small>loading...</small></p>`);
    $this = jQuery(this);
    $poolModal = jQuery("#pool_participants_modal");
    var poolId = $this.attr('id');
    poolId = poolId.substr(4);
    $poolModal.modal('show');
    jQuery("#pool_participants_modal h2").html('<i class="fa fa-users"></i> Pool ' + $this.data('pool_num'));
    jQuery.get(
        themeDir + 'ajax.php', {
            action: 'display_pool_schedule',
            pool_id: poolId
        },
        function(response) {
            if (response == 'not_found') {
                jQuery("#pool_schedule").html("<p>Schedule yet to be announced.</p>");
            } else {
                jQuery("#pool_schedule").html(response);
            }
        }
    );
    jQuery.get(
        themeDir + 'ajax.php', {
            action: 'display_pool_participants',
            pool_id: poolId,
            tournament_id: "36617"
        },
        function(response) {
            if (response == 'not_found') {
                jQuery("#pool_participants").html("<p>No participants found.</p>");
            } else {
                jQuery("#pool_participants").html(response);
            }
        }
    );
});

jQuery(function() {
    jQuery(document).on('click', '._pq-btn', function() {
        $this = jQuery(this);
        jQuery("._pqmh span").text('Pool ' + $this.data('poolsn') + ' Winners');
        jQuery("#pqContent").html(`<p class="text-center">${loadingSpinner(45)}</p>`);
        jQuery("#pqModal").modal('show');
        jQuery.get(
            `${themeDir}ajax.php`, {
                action: 'get_pool_qualifiers',
                pool: $this.data('pool')
            },
            function(response) {
                jQuery("#pqContent").html(response);
            }
        );
    });
});
</script>
<script>
const showJoinError = (act, errorMessage) => {
    errorMessage = errorMessage.trim()
    if ('buy_subscription' == act) {
        jQuery('#buySubscriptionModal').modal('show')
        if (errorMessage) {
            const $wrap = jQuery('#buySubscriptionModal .play-subs-info')
            if ($wrap.find('._sem').length == 0)
                $wrap.prepend(
                    `<p class="_sem alert alert-danger"><i class="fa fa-warning"></i> ${errorMessage}</p>`)
            else
                $wrap.find('._sem').html(`<i class="fa fa-warning"></i> ${errorMessage}`)
        }
        return
    }

    if ('invite_friend' == act) {
        const inviteLink = 'https://www.ultimatebattle.in/clan/.html?act=invite'
        jQuery('#join-error-msg').append(
            `<p style="padding-bottom: 0 !important;"><a href="${inviteLink}" target="_blank" class="btn btn-xs ub-btn-dark-red">Invite friend</a></p>`
            )
        return
    }

    if ('create_or_join' == act) {
        const clansLink = 'https://www.ultimatebattle.in/clans.html'
        jQuery('#join-error-msg').append(
            `<p style="padding-bottom: 0 !important;"><a href="${clansLink}" target="_blank" class="btn btn-xs ub-btn-dark-red">Create or Join Clan</a></p>`
            )
        return
    }

    if (errorMessage) {
        jQuery('#join-error-msg').html(
            `<h5 class="error" style="margin: 0"><i class="fa fa-warning"></i> ${errorMessage}</h5>`);
        jQuery("#join_error_modal").modal('show');
    }
}

jQuery("._jemt").on('click', function(e) {
    e.preventDefault()
    let $button = jQuery(this)
    const act = $button.data('act')
    const errMsg = $button.data('error')

    showJoinError(act, errMsg)
});
// added by santy start
const calculateUserPoolMatchPoints = (rank, kills) => {
    rank = +rank;
    kills = +kills;
    let rankPoints
    switch (rank) {
        case 1:
            rankPoints = 15
            break;
        case 2:
            rankPoints = 12
            break;
        case 3:
            rankPoints = 10
            break;
        case 4:
            rankPoints = 8
            break;
        case 5:
            rankPoints = 6
            break;
        case 6:
            rankPoints = 4
            break;
        case 7:
            rankPoints = 2
            break;
        case 8:
        case 9:
            rankPoints = 1
            break;
        default:
            rankPoints = 0
            break;
    }
    return rankPoints + kills
}
jQuery('.rank, .kills').keyup(function(){
    const id = jQuery(this).parent().parent().attr('id');
    var rank = jQuery("#"+id).find('.rank').val();
    var kills = jQuery("#"+id).find('.kills').val();
    jQuery("#"+id).find('.points').val(calculateUserPoolMatchPoints(rank, kills));
});
function updatescore(element, elementid, user_id, tournament_id, pool_id, match_no){
    var rank = parseInt(jQuery("#row_"+elementid+" .rank").val());
    var kills = parseInt(jQuery("#row_"+elementid+" .kills").val());
    var points = parseInt(jQuery("#row_"+elementid+" .points").val());
    if(points > 0){
        jQuery(element).html('wait...');
        jQuery(element).prop('disabled', true);
        jQuery.ajax({
            url: `${themeDir}ajax.php?action=update_pool_scores`,
            type: "POST",
            data: { rank, kills, points, user_id, tournament_id, pool_id, match_no},
            success: function (result) {
                response = jQuery.parseJSON(result)
                if(response.result=='success'){
                    jQuery(element).html('updated');
                }else{
                    jQuery(element).html('update');
                }
                jQuery(element).prop('disabled', false);
            }
        });
    }
}
jQuery("#update_all_score").click(function(){
    jQuery('.btn-button1').prop('disabled', true);
    jQuery('.btn-button1').html('wait...');
    jQuery.ajax({
        url: `${themeDir}ajax.php?action=update_pool_scores_all&tournamentid=36617`,
        type: "POST",
        data: jQuery('#updatescore').serialize(),
        success: function (result) {
            jQuery('.btn-button1').html('update');
            jQuery('.btn-button1').prop('disabled', false);
        }
    });
})
// end santy
</script>
	<!-- modal - chat under maintenance -->
	<div id="chatUnderMaintenance" class="modal fade" role="dialog">
		<div class="modal-dialog modal-dialog-centered">
			<div id="cum" class="modal-content"></div>
		</div>
	</div>

	<!-- challenge ad & face-off pop-up -->
	<div id="challengeReqModal" class="modal fade" role="dialog">
	    <div class="modal-dialog modal-md">
	        <div class="modal-content">
	            <div class="modal-body-ub">
	                <h3 class="modal-title">Challenge Joined successfully</h3>
	                <p>Notifications have been sent to active players to join the challenge.</p>
	                <p>Average wait time: 30 seconds</p>
	                <div class="_u_btn"> <button type="button" class="btn btn-default" data-dismiss="modal">OK</button></div>
	            </div>
	        </div>
	    </div>
	</div>

			<div class="modal fade" id="alertModal" tabindex="-1" role="dialog" aria-labelledby="alertModalLabel" aria-hidden="true">
		    <div class="modal-dialog modal-md modal-dialog-centered">
		        <div class="modal-content">
		            <div class="modal-body-ub">
		            	<button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span></button>
		            			                <div class="alert-modal-content">
		                <p class="text-center"><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" alt="Loading..." style="width: 50px; height: 50px" /></p>		                </div>
		                		            </div>
		        </div>
		    </div>
		</div>
		<!-- modal - report issue modal -->
	<div id="reportIssueModalFooter" class="modal" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<form id="riFormFooter" action="https://www.ultimatebattle.in/wp-content/themes/blackfyre/report-issue.php" method="post" onsubmit="return validateReportIssueFooterForm()">
					<div class="modal-header">
						<h3 class="modal-title">Report Issue</h3>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 12px; top: 13px;">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<table class="table no-border">
							<tr>
								<td>
									<label for="rimf_issue_type">Issue Type:</label>
									<select id="rimf_issue_type" name="issue_type" class="form-control">
										<option value="">- Select -</option>
										<option value="score reporting">Score Reporting</option>
										<option value="foul play">Foul Play</option>
										<option value="account">Account</option>
										<option value="other">Other</option>
									</select>
								</td>
							</tr>
							<tr>
								<td>
									<label for="rimf_comment">Comment:</label>
									<textarea id="rimf_comment" name="comment" class="form-control" rows="6"></textarea>
								</td>
							</tr>
							<tr>
								<td colspan="2" class="_maw"><i class="fa fa-whatsapp"></i> To talk with support, you can whatsapp us at: <a href="https://wa.me/+919899212401" target="_blank">(+91) 9899-212-401</a></td>
							</tr>
						</table>
					</div>
					<div class="modal-footer">
						<input type="hidden" name="redirect_to" value="https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html" />
						<button type="submit" class="btn ub-btn-dark-red">Submit</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
					</div>
				</form>
			</div>
		</div>
	</div>

<footer id="footerinfoarea">
		<div class="footer-appliction">
    	<div class="container">
      		<div class="row">
        		<div class="col-md-6 col-6">
          			<figure class="_mbapp"><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/moobile-app.png" /></figure>
        		</div>
        		<div class="col-md-6  col-6">
          			<div class="_ub-app-ft">
            			<h3><span>Fast & Easy to Use</span></h3>
            			<figure class="scanbar"><img src="https://www.ultimatebattle.in/wp-content/uploads/qrcode.svg" /></figure>
            			<ul>
              				<li class="wn">Win Cash Prize Money</li>
              				<li class="acf">Access exclusive Features</li>
            			</ul>

            			<!-- Download app button -->
	            		<div class="ubapp-dwn">
	            			<a href='https://www.ultimatebattle.in/ub-android-app/ub.apk' class="ub2-app-download mdn _da">
	            				<i class="fa fa-download" aria-hidden="true"></i> <span>Download App</span>
	            			</a> 
	            			<a href='https://www.ultimatebattle.in/ub-android-app/ub.apk' class="ub2-app-download dwnloand-apk _da">
	            				<i class="fa fa-download" aria-hidden="true"></i><span>Download App</span>
	            			</a>
	            		</div>

	            		<!-- Get app link -->
          				<div class="ft-field">
          					<label>Get the link on your mobile</label>
          					<div class="phone-num-bx">
          						<span>+91</span>
          						<input type="text" name="mobile_number" placeholder="Input your mobile number">
          						<a href="javascript:getAppLink()" style="float: right; font-size: 28px; margin-top: -31px; padding-right: 13px; "><i class="fa fa-paper-plane"></i></a>
          					</div>
          					<p class="mobile-number-error"></p>
          					<div class="note">Don’t worry we respect your privacy, we won’t use your number for any thing else</div>
          				</div>
          			</div>
		        </div>
			</div>
	    </div>
	</div>
	
	<!-- modal - vip subscriber -->
	<div id="vip_subscibe" class="modal fade" role="dialog">
	  	<div class="modal-dialog">
	  		<!-- Modal content-->
	  		<div class="modal-content">
	  			<div class="vip_subscription-popup">
	  				<h4 class="modal-title">Congratulations! <span> You're now VIP member</span></h4>
	  				<div class="modal-body">
	  					<div class="vip-logo">
	  						<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/vip-logo-app.png" />
	  					</div>
	  					<p>Enjoy Unlimited* free gameplay and Redeem UB coins to get exciting in-game items</p>
	  					<div class="_v-btn-close">
	  						<button type="button" class="btn btn-default" data-dismiss="modal">ok</button>
	  					</div>
	  				</div>
	  			</div>
	  		</div>
	  	</div>
	</div>
  
	<!--div class="top-footerinfo">
		<div class="container">
			<div class="row">
				<div class="col-lg-4 col-md-4"> 
					<h2 class="h2_heading">UB <span>Pro App</span><small>Fast &amp; Easy to Use</small></h2>
					<div class="_footer-ub-gpb">
						<!-- <a href='https://play.google.com/store/apps/details?id=com.brainpulse.ultimatebattle&pcampaignid=pcampaignidMKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1' target="_blank"> -->
						<!--a href='' class="mdn">
							<img alt='Get it on Google Play' src='/images/google-play-badge.png' />
						</a>
                        <a href='' class="dwnloand-apk">
							<img alt='Get it on Google Play' src='/images/google-play-badge.png' />
						</a>
					</div>
					<!-- <div class="ft-field">
						<label>Get the link on your mobile</label>
						<div class="phone-num-bx">
							<span>
								+91
							</span>
							<input type="text" name="mobile_number" placeholder="Input your mobile number">
							<a href="javascript:getAppLink()" style="float: right; font-size: 28px; margin-top: -31px; padding-right: 13px; "><i class="fa fa-paper-plane"></i></a>
						</div>
						<p class="mobile-number-error"></p>
						<div class="note">Don’t worry we respect your privacy, we won’t
						use your number for any thing else</div>
					</div> -->
				<!--/div>
				<div class="col-lg-3 col-md-3 col-md-offset-1 scan-code-bx">
					<h4 style="margin-bottom: 0" class="mobile-text">Scan QR Code to Download App</h4>
					<div class="app-qr-code">
						<img src="" />
											</div>
				</div>
				<div class="col-lg-4 col-md-4">
					<div class="app-img"><img class="appimg" src="/img/app-img.jpg"></div>
				</div>
			</div>
		</div>
	</div-->

	<div class="footer-middle">
		<div class="container">
			<div class="row">
				<div class="col-md-4">
					<h3 class="h3_title">Important <small>Links</small></h3>
										<div id="footer_menu">
						<ul>
							<li><a href="https://www.ultimatebattle.in/about-us.html">About Us</a></li>

														<li><a href="https://www.ultimatebattle.in/how-it-works.html">How It Works?</a></li>
							<li><a href="https://www.ultimatebattle.in/aiel-2021.html" target="_blank">AIEL 2021</a></li>
							<li><a href="https://www.ultimatebattle.in/organizer.html">Organize your Event</a></li>
							<!--li><a href="">Blog</a></li-->
							

														<li><a href="https://www.ultimatebattle.in/contact.html">Contact Us</a></li>
							<li><a href="https://www.ultimatebattle.in/help-faq.html">Help & FAQ</a></li>
							<li><a href="https://www.ultimatebattle.in/fair-play.html">Fair Play</a></li>
							<li><a href="https://www.ultimatebattle.in/return-refund-policy.html">Return and Refund Policy</a></li>
							<li><a href="https://www.ultimatebattle.in/disclaimer.html">Disclaimer</a></li>
							
							<li><a href="https://www.ultimatebattle.in/privacy-policy.html">Privacy Policy</a></li>
							<li><a href="https://www.ultimatebattle.in/terms-and-conditions.html">Terms and Conditions</a></li>

														<li><a href="https://www.ultimatebattle.in/shipping-policy.html">Shipping Policy</a></li>
							<li><a href="https://www.ultimatebattle.in/intellectual-property.html">Intellectual Property</a></li>
							<li><a href="https://www.ultimatebattle.in/career.html">Jobs and Career</a></li>
							<li><a href="https://www.ultimatebattle.in/press-releases.html">In the Press</a></li>
							<li><a href="https://www.ultimatebattle.in/advertise-with-us.html">Advertise With Us</a></li>
													</ul>
					</div>
				</div>

				<div class="col-md-4">
											<h3 class="h3_title text-center">We are <small>Social</small> <span>Follow UB pages for latest updates</span></h3>
						<div class="social-area">
							<ul>
																	<li>
										<a href="https://www.facebook.com/UltimateBattleIndia" target="_blank" class="fb">facebook</a>
									</li>
								
																	<li>
										<a href="https://www.youtube.com/channel/UCIB9pxmYXV2RvGaaWBy9ppw" target="_blank" class="ytb">youtube</a>
									</li>
								
																	<li>
										<a href="https://www.instagram.com/ultimatebattleindia/" target="_blank" class="ins">instagram</a>
									</li>
								
																	<li>
										<a href="https://www.twitch.tv/ultimatebattleindia" target="_blank" class="twitch">twitch</a>
									</li>
								
																	<li>
										<a href="https://twitter.com/ultimatebatle" target="_blank" class="tw">twitter</a>
									</li>
								
								
								
																	<li>
										<a href="https://discord.gg/AfTNZZPQVA" target="_blank" class="discord">Discord</a>
									</li>
															</ul>
						</div>
					
					<div class="ft-logo" >
						<a href="https://www.ultimatebattle.in">
														<img src="https://www.ultimatebattle.in/wp-content/uploads/2015/02/ub-logo-beta.png" alt="Ultimate Battle - Online Gaming">
													</a>
																				<!-- <p>&copy; </p> -->
							<p>&copy; 2023 Powered By Ultimate Battle Pvt Ltd </p>
																		</div>
				</div>

				<div class="col-md-4 address-bx">
											<h3 class="h3_title">Connect <small>With Us</small></h3>
						<div class="ub-address">
							<!--p><i class="fa fa-phone"></i> <a href="tel:9899212401">(+91) 9899-212-401</a><small class="footer-support-timing">( 10 am to 8 pm )</small></p-->
								<p><i class="fa fa-whatsapp"></i> <a href="https://wa.me/+919899212401" target="_blank">(+91) 9899-212-401</a></p><p><span><i class="fa fa-envelope-o"></i> <a href="mailto:support@ultimatebattle.in">support@ultimatebattle.in</a></span></p><div><p style="display:inline-block"><i class="fa fa-map-marker"></i> <span class="footer-address">C-102, Sector 65,<br />
Noida, Uttar Pradesh</span></p></div>						</div>
									</div>
			</div>

						<div class="row">
				<div class="col-lg-2"></div>
				<div class="col-lg-8">
					<div class="_disclaimer">
						<p class="text-center">Disclaimer</p>
												<p class="text-center">Ultimate Battle does not offer its services in assam, odisha, sikkim, nagaland, telangana, karnataka, meghalaya, arunachal pradesh and andhra pradesh</p>
					</div>
				</div>
				<div class="col-lg-2"></div>
			</div>

					</div>
	</div>

			<div class="footer-last">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/payment-method-img-2.png">
					</div>
				</div>
			</div>
		</div>
	
	<div class="_occ-wrapper">
		<div class="clear"></div>
	</div>
</footer>

<div class="ub-apk-app">
	<button>X</button>
	<h3>HOW TO INSTALL <span>UB PRO App</span></h3>
	<ul>
		<li><span>1</span>Download the APK</li>
		<li><span>2</span>Allow Install from unknown Sources.</li>
		<li><span>3</span>Install the Apk</li>
		<li><span>4</span>Open Ultimate Battle to Play & Win Rewards</li>
	</ul>
</div>

</div><!-- end of div.wrapper.new -->

		<div id="buySubscriptionModal" class="modal fade" data-backdrop="static">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="play-subs-info">
						<h4 class="modal-title">Get Subscription</h4>

						<button type="button" class="close" data-dismiss="modal">&times;</button>

						<div class="modal-body">
							<div class="row">
																	<div class="col-6 _ubx1 plan-free">
										<div class="ub-fun-info ">
											<figure>
												<img id="subs-plan-img" src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/fun-free.jpg">
											</figure>

											
											<ul>
												<li>
													<p>free Tournaments</p>
													<div class="_nm">
														<span>3 </span>
																												in a week*
																											</div>
												</li>
												<li>
													<p>Redeem Coins In Shop <a href="https://www.ultimatebattle.in/redeem-coins-shop.html" target="_blank"><i class="fa fa-external-link"></i></a></p>
													<div class="_nm"><span>YES</span></div>
												</li>
												<li>
													<p>free Leaderboard Tournaments</p>
													<div class="_nm"><span>NO</span></div>
												</li>
												<li>
													<p>Battle Cup Qualifier</p>
													<div class="_nm"><span>1 Try</span></div>
												</li>
												<li>
													<p>Ad Free</p>
													<div class="_nm"><span>No</span></div>
												</li>
											</ul>

																					</div>
									</div>
																	<div class="col-6 _ubx2 vip-plan">
										<div class="ub-fun-info prime">
											<figure>
												<img id="subs-plan-img" src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/images/vip-quaterly.jpg">
											</figure>

																							<div class="vip-plans-box">
													<div class="pr-bx qty">
														<label class="container_abs"> 
															3 MONTHS PLAN <small>Rs. 99</small>
															<input type="radio" name="subsplan2" value="3" checked="checked">
															<span class="checkmark"></span>
														</label>
													</div>
													<div class="pr-bx yrl">
														<label class="container_abs"> YEARLY PLAN 
															<small>
																Rs. <i>399</i> 299 
																<span class="spt">25% OFF</span>
															</small> 
															<input type="radio" name="subsplan2" value="2">
															<span class="checkmark"></span>
														</label>
													</div>
												</div>
											
											<ul>
												<li>
													<p>free Tournaments</p>
													<div class="_nm">
														<span>Unlimited </span>
																											</div>
												</li>
												<li>
													<p>Redeem Coins In Shop <a href="https://www.ultimatebattle.in/redeem-coins-shop.html" target="_blank"><i class="fa fa-external-link"></i></a></p>
													<div class="_nm"><span>YES</span></div>
												</li>
												<li>
													<p>free Leaderboard Tournaments</p>
													<div class="_nm"><span>YES</span></div>
												</li>
												<li>
													<p>Battle Cup Qualifier</p>
													<div class="_nm"><span>3 Try</span></div>
												</li>
												<li>
													<p>Ad Free</p>
													<div class="_nm"><span>Yes</span></div>
												</li>
											</ul>

																							
												
												<button name="buy_subs_plan" class="btn btn-primary subscibe-btn buy-subs-plan" data-plan_id="3">Subscribe <span><i class="fa fa-inr"></i>99 / 3 months</span></button>
																					</div>
									</div>
															</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	<script>

		// var $ =jQuery;
		jQuery(document).ready(function(){
			jQuery(document).on("change", "input[name='paymentType']", function(){
			
				if(jQuery("#phonepe").prop("checked") == true){
					jQuery("#paytmRechargeWalletForm").attr("action", "https://www.ultimatebattle.in/wp-content/themes/blackfyre/recharge-wallet-phonepe.php")
					jQuery("#subsPlansForm").attr("action", "https://www.ultimatebattle.in/wp-content/themes/blackfyre/buy-subscription-plan.php")
				}
				else{
					jQuery("#paytmRechargeWalletForm").attr("action", "https://www.ultimatebattle.in/wp-content/themes/blackfyre/recharge-wallet-paytm.php")
					jQuery("#subsPlansForm").attr("action", "https://www.ultimatebattle.in/wp-content/themes/blackfyre/buy-subscription-plan-paytm.php")
				}
			});
		});   
		const buySubscriptionPlanModalForm = planId => {
			if (!planId) return

			const currentPageUrl = 'https://www.ultimatebattle.in/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html';

			let preCon = `<div class="modal-body">
				<p class="text-center">${loadingSpinner(30)}</p>
			</div>`
			jQuery("#confirmSubsBuyModal .modal-content").html(preCon)
			jQuery("#buySubscriptionModal").modal('hide')
			jQuery("#confirmSubsBuyModal").modal('show')

			jQuery.ajax({
			  url: `${themeDir}ajax.php`,
			  type: 'GET',
			  dataType: 'json',
			  data: {action: 'buy_subs_plan_data', plan_id: planId, user_id: currentUserId},
			  success: function(data, textStatus, xhr) {
			  	if (!data.result) {
					jQuery("#confirmSubsBuyModal .modal-content").html(`<p class="alert alert-danger" style="margin: 0">Something went wrong, please try again.</p>`)
			  	} else {
			  		let modalContent = `<div class="modal-body">
			  			<h4 class="text-center">Confirm Subscription Buy</h4><hr />
			  			<table class="table table-borderless table-sm" style="margin: 0">
			  				<tr>
			  					<td>Plan name:</td>
			  					<td class="text-right">${data.plan_name.toUpperCase()}</td>
			  				</tr>
			  				<tr>
			  					<td>Validity:</td>
			  					<td class="text-right">${data.validity} days</td>
			  				</tr>
			  				<tr>
			  					<td>Plan price:</td>
			  					<td class="text-right"><i class="fa fa-inr"></i> ${data.plan_price}</td>
			  				</tr>
			  			<tr><td colspan="2"><hr /><strong>Payment</strong></td></tr>`
							if(data.deposit_deduction > 0){							
								modalContent += `<tr>
			  					<td>Deposit deduction:</td>
			  					<td class="text-right"><i class="fa fa-inr"></i> ${data.deposit_deduction}</td>
			  				</tr>`
							}
							if(data.wallet_deduction > 0){		
								modalContent +=`<tr>
			  					<td>Winning deduction:</td>
			  					<td class="text-right"><i class="fa fa-inr"></i> ${data.wallet_deduction}</td>
			  				</tr>`
							}
			  				if (data.remaining_cash > 0) {
				  				modalContent += `<tr>
				  					<td>Remaining amount to pay:</td>
				  					<td class="text-right"><i class="fa fa-inr"></i> ${data.remaining_cash}</td>
				  				</tr>`
			  				}
							modalContent += `<tr>
				  					<td>Pay With:</td>
				  					<td class="text-right"><div>
										<input type="radio" id="paytm" name="paymentType" value="paytm" checked />
										<label for="paytm">Paytm</label>
										<input type="radio" id="phonepe" name="paymentType" value="phonepe" />
										<label for="phonepe">PhonePe</label>										
									</div></td>
				  				</tr>`;
			  			modalContent += `</table>
					</div>
					<div class="modal-footer">
						<form id="subsPlansForm" action="${siteUrl}wp-content/themes/blackfyre/buy-subscription-plan-paytm.php" method="post">
							${data.nonce_field}
							<input type="hidden" id="plan${data.plan_price}" name="subs_plan" value="${data.plan_id}">
							<input type="hidden" name="redirect_url" value="${currentPageUrl}">
									
							<button type="submit" name="buy_subs_plan" class="btn btn-primary subscibe-btn" data-plan_id="${data.plan_id}">Buy</button>
						</form>
					</div>`
					jQuery("#confirmSubsBuyModal .modal-content").html(modalContent)
			  	}
			  },
			  error: function(xhr, textStatus, errorThrown) {
			  	jQuery("#confirmSubsBuyModal .modal-content").html(`<p class="alert alert-danger" style="margin: 0">Something went wrong, please try again.</p>`)
			  }
			});
		}

		jQuery('.vip-subscribed').on('click', function(){
			if (jQuery('._occ-wrapper').find('.vip-subscribed').length > 0) return
			const args = {
				recipient: [currentUserId],
				content: 'You are already a VIP member.',
				theme: 'indianred',
				time: false,
				class: 'vip-subscribed'
			}
			renderWebNotification(args)
		})

		jQuery(".buy-subs-plan").on('click', function(){
			const $button = jQuery(this)

			let buttonText = $button.html()
			$button.html(`<i class="fa fa-spinner fa-spin"></i> Processing...`)

			// check if user can subscribe?
			jQuery.ajax({
				url: `${themeDir}ajax.php`,
				type: 'POST',
				dataType: 'json',
				data: {action: 'can_buy_subscription'},
				success: function(data) {
					console.log(data)
					if (!data.result) {
						$button.html(buttonText)
						jQuery('#buySubscriptionModal').modal('hide')
						alertModal(`Subscription services are not available for players from ${data.state}`)
						return
					}
					const planId = $button.attr('data-plan_id')
					buySubscriptionPlanModalForm(planId)
				}
			});
		})

		// subs plan switch
		jQuery(`input[name="subsplan2"]`).on('change', function(){
			const planId = jQuery(this).val()

			jQuery('.vip-plan #subs-plan-img').attr('src', `${themeDir}images/${2 == planId ? `vip-yearly` : `vip-quaterly`}.jpg`)
			jQuery(".vip-plan button[name='buy_subs_plan']").attr('data-plan_id', planId)
			jQuery(".vip-plan button[name='buy_subs_plan'] span").html(`<i class="fa fa-inr"></i>${2 == planId ? 299 : 99} / ${2 == planId ? `yr` : `3 months`}`)

			if (2 == planId) {
				jQuery('.play-subs-info.subscription .month').removeClass('active')
		    	jQuery('.play-subs-info.subscription .yrl').addClass('active')
		    	return
			}

			if (3 == planId) {
				jQuery('.play-subs-info.subscription .yrl').removeClass('active')
		    	jQuery('.play-subs-info.subscription .month').addClass('active')
		    	return
			}
		})

		jQuery('._da').on(
		    'click',
		    function(){
		        fbq('track', 'download app');
		    }
		)
	</script>

	<div id="confirmSubsBuyModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirmSubsBuyModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-content" style="padding: 0"></div>
			</div>
		</div>
	</div>

			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBw_iYiWQSKwgVzeeziY-n-iYQazJhIfa0"></script>
		<script>
			(_ => {
				if (!navigator.geolocation) return

	            navigator.geolocation.getCurrentPosition(
	            	position => {
			            let latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
			            let geocoder = new google.maps.Geocoder()

			            geocoder.geocode({latLng}, (results, status) => {
			            	if (status != google.maps.GeocoderStatus.OK) return
			            	if (!results[0]) return

			            	let locationData = results[0].address_components, address = {}

			            	for (let i = 0; i < locationData.length; i++) {
			            		if (address.postal_code && address.country && address.state && address.district && address.city)
			            			break

			            		if (locationData[i].types.includes('postal_code'))
			            			address.postal_code = locationData[i].long_name

			            		if (locationData[i].types.includes('country'))
			            			address.country = locationData[i].long_name

			            		if (locationData[i].types.includes('administrative_area_level_1'))
			            			address.state = locationData[i].long_name

			            		if (locationData[i].types.includes('administrative_area_level_2'))
			            			address.district = locationData[i].long_name

			            		if (locationData[i].types.includes('locality'))
			            			address.city = locationData[i].long_name
							}

							jQuery.ajax({
								url: `${themeDir}ajax.php`,
								type: 'POST',
								dataType: 'json',
								data: {action: 'save_user_address', user_id: currentUserId, address},
							});
			            })
		            },

		            _ => console.log('Geolocation failed!')
		        )
			})()
		</script>
		
<script>
	function alertModal(message = '') {
		message = message.trim()
		if (!message) return
		jQuery('#alertModal .alert-modal-content').html(message)
		jQuery('#alertModal').modal('show')
	}


	function download_file(fileURL, fileName) {
		if (!window.ActiveXObject) {
			// for non-IE
			let save = document.createElement('a')
			save.href = fileURL
			save.target = '_blank'
			let filename = fileURL.substring(fileURL.lastIndexOf('/') + 1)
			save.download = fileName || filename
			if (navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/) && navigator.userAgent.search("Chrome") < 0) {
				document.location = save.href
				// window event not working here
			} else {
				let evt = new MouseEvent('click', {
					'view': window,
					'bubbles': true,
					'cancelable': false
				})

				save.dispatchEvent(evt)

				(window.URL || window.webkitURL).revokeObjectURL(save.href)
			}
		} else if (!!window.ActiveXObject && document.execCommand) {
			// for IE < 11
			let _window = window.open(fileURL, '_blank')
			_window.document.close()
			_window.document.execCommand('SaveAs', true, fileName || fileURL)
			_window.close()
		}
	}

	let ubSubsResponse = ''	
	ubSubsResponse = ubSubsResponse ? JSON.parse(ubSubsResponse) : {};
	if ('buy' in ubSubsResponse) {
		if (ubSubsResponse.buy.result) {
			jQuery("#vip_subscibe").modal('show')
		} else {
			let message = `<p class="alert alert-danger"><i class="fa fa-times"></i> ${ubSubsResponse.buy.message}</p>`
			alertModal(message)
		}
	}
</script>

	<!--[if lte IE 8]>
	<style>
		.attachment:focus {
			outline: #1e8cbe solid;
		}
		.selected.attachment {
			outline: #1e8cbe solid;
		}
	</style>
	<![endif]-->
	<script type="text/html" id="tmpl-media-frame">
		<div class="media-frame-menu"></div>
		<div class="media-frame-title"></div>
		<div class="media-frame-router"></div>
		<div class="media-frame-content"></div>
		<div class="media-frame-toolbar"></div>
		<div class="media-frame-uploader"></div>
	</script>

	<script type="text/html" id="tmpl-media-modal">
		<div class="media-modal wp-core-ui">
			<button type="button" class="media-modal-close"><span class="media-modal-icon"><span class="screen-reader-text">Close media panel</span></span></button>
			<div class="media-modal-content"></div>
		</div>
		<div class="media-modal-backdrop"></div>
	</script>

	<script type="text/html" id="tmpl-uploader-window">
		<div class="uploader-window-content">
			<h1>Drop files to upload</h1>
		</div>
	</script>

	<script type="text/html" id="tmpl-uploader-editor">
		<div class="uploader-editor-content">
			<div class="uploader-editor-title">Drop files to upload</div>
		</div>
	</script>

	<script type="text/html" id="tmpl-uploader-inline">
		<# var messageClass = data.message ? 'has-upload-message' : 'no-upload-message'; #>
		<# if ( data.canClose ) { #>
		<button class="close dashicons dashicons-no"><span class="screen-reader-text">Close uploader</span></button>
		<# } #>
		<div class="uploader-inline-content {{ messageClass }}">
		<# if ( data.message ) { #>
			<h2 class="upload-message">{{ data.message }}</h2>
		<# } #>
					<div class="upload-ui">
				<h2 class="upload-instructions drop-instructions">Drop files anywhere to upload</h2>
				<p class="upload-instructions drop-instructions">or</p>
				<button type="button" class="browser button button-hero">Select Files</button>
			</div>

			<div class="upload-inline-status"></div>

			<div class="post-upload-ui">
				
				<p class="max-upload-size">Maximum upload file size: 80 MB.</p>

				<# if ( data.suggestedWidth && data.suggestedHeight ) { #>
					<p class="suggested-dimensions">
						Suggested image dimensions: {{data.suggestedWidth}} by {{data.suggestedHeight}} pixels.					</p>
				<# } #>

							</div>
				</div>
	</script>

	<script type="text/html" id="tmpl-media-library-view-switcher">
		<a href="/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html?mode=list" class="view-list">
			<span class="screen-reader-text">List View</span>
		</a>
		<a href="/tournament/free-fire-max-tournament-fun-series-10-mar-2023-prize-200-coins.html?mode=grid" class="view-grid current">
			<span class="screen-reader-text">Grid View</span>
		</a>
	</script>

	<script type="text/html" id="tmpl-uploader-status">
		<h2>Uploading</h2>
		<button type="button" class="button-link upload-dismiss-errors"><span class="screen-reader-text">Dismiss Errors</span></button>

		<div class="media-progress-bar"><div></div></div>
		<div class="upload-details">
			<span class="upload-count">
				<span class="upload-index"></span> / <span class="upload-total"></span>
			</span>
			<span class="upload-detail-separator">&ndash;</span>
			<span class="upload-filename"></span>
		</div>
		<div class="upload-errors"></div>
	</script>

	<script type="text/html" id="tmpl-uploader-status-error">
		<span class="upload-error-filename">{{{ data.filename }}}</span>
		<span class="upload-error-message">{{ data.message }}</span>
	</script>

	<script type="text/html" id="tmpl-edit-attachment-frame">
		<div class="edit-media-header">
			<button class="left dashicons <# if ( ! data.hasPrevious ) { #> disabled <# } #>"><span class="screen-reader-text">Edit previous media item</span></button>
			<button class="right dashicons <# if ( ! data.hasNext ) { #> disabled <# } #>"><span class="screen-reader-text">Edit next media item</span></button>
		</div>
		<div class="media-frame-title"></div>
		<div class="media-frame-content"></div>
	</script>

	<script type="text/html" id="tmpl-attachment-details-two-column">
		<div class="attachment-media-view {{ data.orientation }}">
			<div class="thumbnail thumbnail-{{ data.type }}">
				<# if ( data.uploading ) { #>
					<div class="media-progress-bar"><div></div></div>
				<# } else if ( data.sizes && data.sizes.large ) { #>
					<img class="details-image" src="{{ data.sizes.large.url }}" draggable="false" alt="" />
				<# } else if ( data.sizes && data.sizes.full ) { #>
					<img class="details-image" src="{{ data.sizes.full.url }}" draggable="false" alt="" />
				<# } else if ( -1 === jQuery.inArray( data.type, [ 'audio', 'video' ] ) ) { #>
					<img class="details-image icon" src="{{ data.icon }}" draggable="false" alt="" />
				<# } #>

				<# if ( 'audio' === data.type ) { #>
				<div class="wp-media-wrapper">
					<audio style="visibility: hidden" controls class="wp-audio-shortcode" width="100%" preload="none">
						<source type="{{ data.mime }}" src="{{ data.url }}"/>
					</audio>
				</div>
				<# } else if ( 'video' === data.type ) {
					var w_rule = '';
					if ( data.width ) {
						w_rule = 'width: ' + data.width + 'px;';
					} else if ( wp.media.view.settings.contentWidth ) {
						w_rule = 'width: ' + wp.media.view.settings.contentWidth + 'px;';
					}
				#>
				<div style="{{ w_rule }}" class="wp-media-wrapper wp-video">
					<video controls="controls" class="wp-video-shortcode" preload="metadata"
						<# if ( data.width ) { #>width="{{ data.width }}"<# } #>
						<# if ( data.height ) { #>height="{{ data.height }}"<# } #>
						<# if ( data.image && data.image.src !== data.icon ) { #>poster="{{ data.image.src }}"<# } #>>
						<source type="{{ data.mime }}" src="{{ data.url }}"/>
					</video>
				</div>
				<# } #>

				<div class="attachment-actions">
					<# if ( 'image' === data.type && ! data.uploading && data.sizes && data.can.save ) { #>
					<button type="button" class="button edit-attachment">Edit Image</button>
					<# } else if ( 'pdf' === data.subtype && data.sizes ) { #>
					Document Preview					<# } #>
				</div>
			</div>
		</div>
		<div class="attachment-info">
			<span class="settings-save-status">
				<span class="spinner"></span>
				<span class="saved">Saved.</span>
			</span>
			<div class="details">
				<div class="filename"><strong>File name:</strong> {{ data.filename }}</div>
				<div class="filename"><strong>File type:</strong> {{ data.mime }}</div>
				<div class="uploaded"><strong>Uploaded on:</strong> {{ data.dateFormatted }}</div>

				<div class="file-size"><strong>File size:</strong> {{ data.filesizeHumanReadable }}</div>
				<# if ( 'image' === data.type && ! data.uploading ) { #>
					<# if ( data.width && data.height ) { #>
						<div class="dimensions"><strong>Dimensions:</strong> {{ data.width }} &times; {{ data.height }}</div>
					<# } #>
				<# } #>

				<# if ( data.fileLength ) { #>
					<div class="file-length"><strong>Length:</strong> {{ data.fileLength }}</div>
				<# } #>

				<# if ( 'audio' === data.type && data.meta.bitrate ) { #>
					<div class="bitrate">
						<strong>Bitrate:</strong> {{ Math.round( data.meta.bitrate / 1000 ) }}kb/s
						<# if ( data.meta.bitrate_mode ) { #>
						{{ ' ' + data.meta.bitrate_mode.toUpperCase() }}
						<# } #>
					</div>
				<# } #>

				<div class="compat-meta">
					<# if ( data.compat && data.compat.meta ) { #>
						{{{ data.compat.meta }}}
					<# } #>
				</div>
			</div>

			<div class="settings">
				<label class="setting" data-setting="url">
					<span class="name">URL</span>
					<input type="text" value="{{ data.url }}" readonly />
				</label>
				<# var maybeReadOnly = data.can.save || data.allowLocalEdits ? '' : 'readonly'; #>
								<label class="setting" data-setting="title">
					<span class="name">Title</span>
					<input type="text" value="{{ data.title }}" {{ maybeReadOnly }} />
				</label>
								<# if ( 'audio' === data.type ) { #>
								<label class="setting" data-setting="artist">
					<span class="name">Artist</span>
					<input type="text" value="{{ data.artist || data.meta.artist || '' }}" />
				</label>
								<label class="setting" data-setting="album">
					<span class="name">Album</span>
					<input type="text" value="{{ data.album || data.meta.album || '' }}" />
				</label>
								<# } #>
				<label class="setting" data-setting="caption">
					<span class="name">Caption</span>
					<textarea {{ maybeReadOnly }}>{{ data.caption }}</textarea>
				</label>
				<# if ( 'image' === data.type ) { #>
					<label class="setting" data-setting="alt">
						<span class="name">Alt Text</span>
						<input type="text" value="{{ data.alt }}" {{ maybeReadOnly }} />
					</label>
				<# } #>
				<label class="setting" data-setting="description">
					<span class="name">Description</span>
					<textarea {{ maybeReadOnly }}>{{ data.description }}</textarea>
				</label>
				<label class="setting">
					<span class="name">Uploaded By</span>
					<span class="value">{{ data.authorName }}</span>
				</label>
				<# if ( data.uploadedToTitle ) { #>
					<label class="setting">
						<span class="name">Uploaded To</span>
						<# if ( data.uploadedToLink ) { #>
							<span class="value"><a href="{{ data.uploadedToLink }}">{{ data.uploadedToTitle }}</a></span>
						<# } else { #>
							<span class="value">{{ data.uploadedToTitle }}</span>
						<# } #>
					</label>
				<# } #>
				<div class="attachment-compat"></div>
			</div>

			<div class="actions">
				<a class="view-attachment" href="{{ data.link }}">View attachment page</a>
				<# if ( data.can.save ) { #> |
					<a href="post.php?post={{ data.id }}&action=edit">Edit more details</a>
				<# } #>
				<# if ( ! data.uploading && data.can.remove ) { #> |
											<button type="button" class="button-link delete-attachment">Delete Permanently</button>
									<# } #>
			</div>

		</div>
	</script>

	<script type="text/html" id="tmpl-attachment">
		<div class="attachment-preview js--select-attachment type-{{ data.type }} subtype-{{ data.subtype }} {{ data.orientation }}">
			<div class="thumbnail">
				<# if ( data.uploading ) { #>
					<div class="media-progress-bar"><div style="width: {{ data.percent }}%"></div></div>
				<# } else if ( 'image' === data.type && data.sizes ) { #>
					<div class="centered">
						<img src="{{ data.size.url }}" draggable="false" alt="" />
					</div>
				<# } else { #>
					<div class="centered">
						<# if ( data.image && data.image.src && data.image.src !== data.icon ) { #>
							<img src="{{ data.image.src }}" class="thumbnail" draggable="false" alt="" />
						<# } else if ( data.sizes && data.sizes.medium ) { #>
							<img src="{{ data.sizes.medium.url }}" class="thumbnail" draggable="false" alt="" />
						<# } else { #>
							<img src="{{ data.icon }}" class="icon" draggable="false" alt="" />
						<# } #>
					</div>
					<div class="filename">
						<div>{{ data.filename }}</div>
					</div>
				<# } #>
			</div>
			<# if ( data.buttons.close ) { #>
				<button type="button" class="button-link attachment-close media-modal-icon"><span class="screen-reader-text">Remove</span></button>
			<# } #>
		</div>
		<# if ( data.buttons.check ) { #>
			<button type="button" class="check" tabindex="-1"><span class="media-modal-icon"></span><span class="screen-reader-text">Deselect</span></button>
		<# } #>
		<#
		var maybeReadOnly = data.can.save || data.allowLocalEdits ? '' : 'readonly';
		if ( data.describe ) {
			if ( 'image' === data.type ) { #>
				<input type="text" value="{{ data.caption }}" class="describe" data-setting="caption"
					placeholder="Caption this image&hellip;" {{ maybeReadOnly }} />
			<# } else { #>
				<input type="text" value="{{ data.title }}" class="describe" data-setting="title"
					<# if ( 'video' === data.type ) { #>
						placeholder="Describe this video&hellip;"
					<# } else if ( 'audio' === data.type ) { #>
						placeholder="Describe this audio file&hellip;"
					<# } else { #>
						placeholder="Describe this media file&hellip;"
					<# } #> {{ maybeReadOnly }} />
			<# }
		} #>
	</script>

	<script type="text/html" id="tmpl-attachment-details">
		<h2>
			Attachment Details			<span class="settings-save-status">
				<span class="spinner"></span>
				<span class="saved">Saved.</span>
			</span>
		</h2>
		<div class="attachment-info">
			<div class="thumbnail thumbnail-{{ data.type }}">
				<# if ( data.uploading ) { #>
					<div class="media-progress-bar"><div></div></div>
				<# } else if ( 'image' === data.type && data.sizes ) { #>
					<img src="{{ data.size.url }}" draggable="false" alt="" />
				<# } else { #>
					<img src="{{ data.icon }}" class="icon" draggable="false" alt="" />
				<# } #>
			</div>
			<div class="details">
				<div class="filename">{{ data.filename }}</div>
				<div class="uploaded">{{ data.dateFormatted }}</div>

				<div class="file-size">{{ data.filesizeHumanReadable }}</div>
				<# if ( 'image' === data.type && ! data.uploading ) { #>
					<# if ( data.width && data.height ) { #>
						<div class="dimensions">{{ data.width }} &times; {{ data.height }}</div>
					<# } #>

					<# if ( data.can.save && data.sizes ) { #>
						<a class="edit-attachment" href="{{ data.editLink }}&amp;image-editor" target="_blank">Edit Image</a>
					<# } #>
				<# } #>

				<# if ( data.fileLength ) { #>
					<div class="file-length">Length: {{ data.fileLength }}</div>
				<# } #>

				<# if ( ! data.uploading && data.can.remove ) { #>
											<button type="button" class="button-link delete-attachment">Delete Permanently</button>
									<# } #>

				<div class="compat-meta">
					<# if ( data.compat && data.compat.meta ) { #>
						{{{ data.compat.meta }}}
					<# } #>
				</div>
			</div>
		</div>

		<label class="setting" data-setting="url">
			<span class="name">URL</span>
			<input type="text" value="{{ data.url }}" readonly />
		</label>
		<# var maybeReadOnly = data.can.save || data.allowLocalEdits ? '' : 'readonly'; #>
				<label class="setting" data-setting="title">
			<span class="name">Title</span>
			<input type="text" value="{{ data.title }}" {{ maybeReadOnly }} />
		</label>
				<# if ( 'audio' === data.type ) { #>
				<label class="setting" data-setting="artist">
			<span class="name">Artist</span>
			<input type="text" value="{{ data.artist || data.meta.artist || '' }}" />
		</label>
				<label class="setting" data-setting="album">
			<span class="name">Album</span>
			<input type="text" value="{{ data.album || data.meta.album || '' }}" />
		</label>
				<# } #>
		<label class="setting" data-setting="caption">
			<span class="name">Caption</span>
			<textarea {{ maybeReadOnly }}>{{ data.caption }}</textarea>
		</label>
		<# if ( 'image' === data.type ) { #>
			<label class="setting" data-setting="alt">
				<span class="name">Alt Text</span>
				<input type="text" value="{{ data.alt }}" {{ maybeReadOnly }} />
			</label>
		<# } #>
		<label class="setting" data-setting="description">
			<span class="name">Description</span>
			<textarea {{ maybeReadOnly }}>{{ data.description }}</textarea>
		</label>
	</script>

	<script type="text/html" id="tmpl-media-selection">
		<div class="selection-info">
			<span class="count"></span>
			<# if ( data.editable ) { #>
				<button type="button" class="button-link edit-selection">Edit Selection</button>
			<# } #>
			<# if ( data.clearable ) { #>
				<button type="button" class="button-link clear-selection">Clear</button>
			<# } #>
		</div>
		<div class="selection-view"></div>
	</script>

	<script type="text/html" id="tmpl-attachment-display-settings">
		<h2>Attachment Display Settings</h2>

		<# if ( 'image' === data.type ) { #>
			<label class="setting align">
				<span>Alignment</span>
				<select class="alignment"
					data-setting="align"
					<# if ( data.userSettings ) { #>
						data-user-setting="align"
					<# } #>>

					<option value="left">
						Left					</option>
					<option value="center">
						Center					</option>
					<option value="right">
						Right					</option>
					<option value="none" selected>
						None					</option>
				</select>
			</label>
		<# } #>

		<div class="setting">
			<label>
				<# if ( data.model.canEmbed ) { #>
					<span>Embed or Link</span>
				<# } else { #>
					<span>Link To</span>
				<# } #>

				<select class="link-to"
					data-setting="link"
					<# if ( data.userSettings && ! data.model.canEmbed ) { #>
						data-user-setting="urlbutton"
					<# } #>>

				<# if ( data.model.canEmbed ) { #>
					<option value="embed" selected>
						Embed Media Player					</option>
					<option value="file">
				<# } else { #>
					<option value="none" selected>
						None					</option>
					<option value="file">
				<# } #>
					<# if ( data.model.canEmbed ) { #>
						Link to Media File					<# } else { #>
						Media File					<# } #>
					</option>
					<option value="post">
					<# if ( data.model.canEmbed ) { #>
						Link to Attachment Page					<# } else { #>
						Attachment Page					<# } #>
					</option>
				<# if ( 'image' === data.type ) { #>
					<option value="custom">
						Custom URL					</option>
				<# } #>
				</select>
			</label>
			<input type="text" class="link-to-custom" data-setting="linkUrl" />
		</div>

		<# if ( 'undefined' !== typeof data.sizes ) { #>
			<label class="setting">
				<span>Size</span>
				<select class="size" name="size"
					data-setting="size"
					<# if ( data.userSettings ) { #>
						data-user-setting="imgsize"
					<# } #>>
											<#
						var size = data.sizes['thumbnail'];
						if ( size ) { #>
							<option value="thumbnail" >
								Thumbnail &ndash; {{ size.width }} &times; {{ size.height }}
							</option>
						<# } #>
											<#
						var size = data.sizes['medium'];
						if ( size ) { #>
							<option value="medium" >
								Medium &ndash; {{ size.width }} &times; {{ size.height }}
							</option>
						<# } #>
											<#
						var size = data.sizes['large'];
						if ( size ) { #>
							<option value="large" >
								Large &ndash; {{ size.width }} &times; {{ size.height }}
							</option>
						<# } #>
											<#
						var size = data.sizes['full'];
						if ( size ) { #>
							<option value="full"  selected='selected'>
								Full Size &ndash; {{ size.width }} &times; {{ size.height }}
							</option>
						<# } #>
									</select>
			</label>
		<# } #>
	</script>

	<script type="text/html" id="tmpl-gallery-settings">
		<h2>Gallery Settings</h2>

		<label class="setting">
			<span>Link To</span>
			<select class="link-to"
				data-setting="link"
				<# if ( data.userSettings ) { #>
					data-user-setting="urlbutton"
				<# } #>>

				<option value="post" <# if ( ! wp.media.galleryDefaults.link || 'post' == wp.media.galleryDefaults.link ) {
					#>selected="selected"<# }
				#>>
					Attachment Page				</option>
				<option value="file" <# if ( 'file' == wp.media.galleryDefaults.link ) { #>selected="selected"<# } #>>
					Media File				</option>
				<option value="none" <# if ( 'none' == wp.media.galleryDefaults.link ) { #>selected="selected"<# } #>>
					None				</option>
			</select>
		</label>

		<label class="setting">
			<span>Columns</span>
			<select class="columns" name="columns"
				data-setting="columns">
									<option value="1" <#
						if ( 1 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						1					</option>
									<option value="2" <#
						if ( 2 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						2					</option>
									<option value="3" <#
						if ( 3 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						3					</option>
									<option value="4" <#
						if ( 4 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						4					</option>
									<option value="5" <#
						if ( 5 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						5					</option>
									<option value="6" <#
						if ( 6 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						6					</option>
									<option value="7" <#
						if ( 7 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						7					</option>
									<option value="8" <#
						if ( 8 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						8					</option>
									<option value="9" <#
						if ( 9 == wp.media.galleryDefaults.columns ) { #>selected="selected"<# }
					#>>
						9					</option>
							</select>
		</label>

		<label class="setting">
			<span>Random Order</span>
			<input type="checkbox" data-setting="_orderbyRandom" />
		</label>

		<label class="setting size">
			<span>Size</span>
			<select class="size" name="size"
				data-setting="size"
				<# if ( data.userSettings ) { #>
					data-user-setting="imgsize"
				<# } #>
				>
									<option value="thumbnail">
						Thumbnail					</option>
									<option value="medium">
						Medium					</option>
									<option value="large">
						Large					</option>
									<option value="full">
						Full Size					</option>
							</select>
		</label>
	</script>

	<script type="text/html" id="tmpl-playlist-settings">
		<h2>Playlist Settings</h2>

		<# var emptyModel = _.isEmpty( data.model ),
			isVideo = 'video' === data.controller.get('library').props.get('type'); #>

		<label class="setting">
			<input type="checkbox" data-setting="tracklist" <# if ( emptyModel ) { #>
				checked="checked"
			<# } #> />
			<# if ( isVideo ) { #>
			<span>Show Video List</span>
			<# } else { #>
			<span>Show Tracklist</span>
			<# } #>
		</label>

		<# if ( ! isVideo ) { #>
		<label class="setting">
			<input type="checkbox" data-setting="artists" <# if ( emptyModel ) { #>
				checked="checked"
			<# } #> />
			<span>Show Artist Name in Tracklist</span>
		</label>
		<# } #>

		<label class="setting">
			<input type="checkbox" data-setting="images" <# if ( emptyModel ) { #>
				checked="checked"
			<# } #> />
			<span>Show Images</span>
		</label>
	</script>

	<script type="text/html" id="tmpl-embed-link-settings">
		<label class="setting link-text">
			<span>Link Text</span>
			<input type="text" class="alignment" data-setting="linkText" />
		</label>
		<div class="embed-container" style="display: none;">
			<div class="embed-preview"></div>
		</div>
	</script>

	<script type="text/html" id="tmpl-embed-image-settings">
		<div class="thumbnail">
			<img src="{{ data.model.url }}" draggable="false" alt="" />
		</div>

					<label class="setting caption">
				<span>Caption</span>
				<textarea data-setting="caption" />
			</label>
		
		<label class="setting alt-text">
			<span>Alt Text</span>
			<input type="text" data-setting="alt" />
		</label>

		<div class="setting align">
			<span>Align</span>
			<div class="button-group button-large" data-setting="align">
				<button class="button" value="left">
					Left				</button>
				<button class="button" value="center">
					Center				</button>
				<button class="button" value="right">
					Right				</button>
				<button class="button active" value="none">
					None				</button>
			</div>
		</div>

		<div class="setting link-to">
			<span>Link To</span>
			<div class="button-group button-large" data-setting="link">
				<button class="button" value="file">
					Image URL				</button>
				<button class="button" value="custom">
					Custom URL				</button>
				<button class="button active" value="none">
					None				</button>
			</div>
			<input type="text" class="link-to-custom" data-setting="linkUrl" />
		</div>
	</script>

	<script type="text/html" id="tmpl-image-details">
		<div class="media-embed">
			<div class="embed-media-settings">
				<div class="column-image">
					<div class="image">
						<img src="{{ data.model.url }}" draggable="false" alt="" />

						<# if ( data.attachment && window.imageEdit ) { #>
							<div class="actions">
								<input type="button" class="edit-attachment button" value="Edit Original" />
								<input type="button" class="replace-attachment button" value="Replace" />
							</div>
						<# } #>
					</div>
				</div>
				<div class="column-settings">
											<label class="setting caption">
							<span>Caption</span>
							<textarea data-setting="caption">{{ data.model.caption }}</textarea>
						</label>
					
					<label class="setting alt-text">
						<span>Alternative Text</span>
						<input type="text" data-setting="alt" value="{{ data.model.alt }}" />
					</label>

					<h2>Display Settings</h2>
					<div class="setting align">
						<span>Align</span>
						<div class="button-group button-large" data-setting="align">
							<button class="button" value="left">
								Left							</button>
							<button class="button" value="center">
								Center							</button>
							<button class="button" value="right">
								Right							</button>
							<button class="button active" value="none">
								None							</button>
						</div>
					</div>

					<# if ( data.attachment ) { #>
						<# if ( 'undefined' !== typeof data.attachment.sizes ) { #>
							<label class="setting size">
								<span>Size</span>
								<select class="size" name="size"
									data-setting="size"
									<# if ( data.userSettings ) { #>
										data-user-setting="imgsize"
									<# } #>>
																			<#
										var size = data.sizes['thumbnail'];
										if ( size ) { #>
											<option value="thumbnail">
												Thumbnail &ndash; {{ size.width }} &times; {{ size.height }}
											</option>
										<# } #>
																			<#
										var size = data.sizes['medium'];
										if ( size ) { #>
											<option value="medium">
												Medium &ndash; {{ size.width }} &times; {{ size.height }}
											</option>
										<# } #>
																			<#
										var size = data.sizes['large'];
										if ( size ) { #>
											<option value="large">
												Large &ndash; {{ size.width }} &times; {{ size.height }}
											</option>
										<# } #>
																			<#
										var size = data.sizes['full'];
										if ( size ) { #>
											<option value="full">
												Full Size &ndash; {{ size.width }} &times; {{ size.height }}
											</option>
										<# } #>
																		<option value="custom">
										Custom Size									</option>
								</select>
							</label>
						<# } #>
							<div class="custom-size<# if ( data.model.size !== 'custom' ) { #> hidden<# } #>">
								<label><span>Width <small>(px)</small></span> <input data-setting="customWidth" type="number" step="1" value="{{ data.model.customWidth }}" /></label><span class="sep">&times;</span><label><span>Height <small>(px)</small></span><input data-setting="customHeight" type="number" step="1" value="{{ data.model.customHeight }}" /></label>
							</div>
					<# } #>

					<div class="setting link-to">
						<span>Link To</span>
						<select data-setting="link">
						<# if ( data.attachment ) { #>
							<option value="file">
								Media File							</option>
							<option value="post">
								Attachment Page							</option>
						<# } else { #>
							<option value="file">
								Image URL							</option>
						<# } #>
							<option value="custom">
								Custom URL							</option>
							<option value="none">
								None							</option>
						</select>
						<input type="text" class="link-to-custom" data-setting="linkUrl" />
					</div>
					<div class="advanced-section">
						<h2><button type="button" class="button-link advanced-toggle">Advanced Options</button></h2>
						<div class="advanced-settings hidden">
							<div class="advanced-image">
								<label class="setting title-text">
									<span>Image Title Attribute</span>
									<input type="text" data-setting="title" value="{{ data.model.title }}" />
								</label>
								<label class="setting extra-classes">
									<span>Image CSS Class</span>
									<input type="text" data-setting="extraClasses" value="{{ data.model.extraClasses }}" />
								</label>
							</div>
							<div class="advanced-link">
								<div class="setting link-target">
									<label><input type="checkbox" data-setting="linkTargetBlank" value="_blank" <# if ( data.model.linkTargetBlank ) { #>checked="checked"<# } #>>Open link in a new tab</label>
								</div>
								<label class="setting link-rel">
									<span>Link Rel</span>
									<input type="text" data-setting="linkRel" value="{{ data.model.linkClassName }}" />
								</label>
								<label class="setting link-class-name">
									<span>Link CSS Class</span>
									<input type="text" data-setting="linkClassName" value="{{ data.model.linkClassName }}" />
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</script>

	<script type="text/html" id="tmpl-image-editor">
		<div id="media-head-{{ data.id }}"></div>
		<div id="image-editor-{{ data.id }}"></div>
	</script>

	<script type="text/html" id="tmpl-audio-details">
		<# var ext, html5types = {
			mp3: wp.media.view.settings.embedMimes.mp3,
			ogg: wp.media.view.settings.embedMimes.ogg
		}; #>

				<div class="media-embed media-embed-details">
			<div class="embed-media-settings embed-audio-settings">
				<audio style="visibility: hidden"
	controls
	class="wp-audio-shortcode"
	width="{{ _.isUndefined( data.model.width ) ? 400 : data.model.width }}"
	preload="{{ _.isUndefined( data.model.preload ) ? 'none' : data.model.preload }}"
	<#
	if ( ! _.isUndefined( data.model.autoplay ) && data.model.autoplay ) {
		#> autoplay<#
	}
	if ( ! _.isUndefined( data.model.loop ) && data.model.loop ) {
		#> loop<#
	}
	#>
>
	<# if ( ! _.isEmpty( data.model.src ) ) { #>
	<source src="{{ data.model.src }}" type="{{ wp.media.view.settings.embedMimes[ data.model.src.split('.').pop() ] }}" />
	<# } #>

	<# if ( ! _.isEmpty( data.model.mp3 ) ) { #>
	<source src="{{ data.model.mp3 }}" type="{{ wp.media.view.settings.embedMimes[ 'mp3' ] }}" />
	<# } #>
	<# if ( ! _.isEmpty( data.model.ogg ) ) { #>
	<source src="{{ data.model.ogg }}" type="{{ wp.media.view.settings.embedMimes[ 'ogg' ] }}" />
	<# } #>
	<# if ( ! _.isEmpty( data.model.m4a ) ) { #>
	<source src="{{ data.model.m4a }}" type="{{ wp.media.view.settings.embedMimes[ 'm4a' ] }}" />
	<# } #>
	<# if ( ! _.isEmpty( data.model.wav ) ) { #>
	<source src="{{ data.model.wav }}" type="{{ wp.media.view.settings.embedMimes[ 'wav' ] }}" />
	<# } #>
	</audio>

				<# if ( ! _.isEmpty( data.model.src ) ) {
					ext = data.model.src.split('.').pop();
					if ( html5types[ ext ] ) {
						delete html5types[ ext ];
					}
				#>
				<label class="setting">
					<span>SRC</span>
					<input type="text" disabled="disabled" data-setting="src" value="{{ data.model.src }}" />
					<button type="button" class="button-link remove-setting">Remove audio source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.mp3 ) ) {
					if ( ! _.isUndefined( html5types.mp3 ) ) {
						delete html5types.mp3;
					}
				#>
				<label class="setting">
					<span>MP3</span>
					<input type="text" disabled="disabled" data-setting="mp3" value="{{ data.model.mp3 }}" />
					<button type="button" class="button-link remove-setting">Remove audio source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.ogg ) ) {
					if ( ! _.isUndefined( html5types.ogg ) ) {
						delete html5types.ogg;
					}
				#>
				<label class="setting">
					<span>OGG</span>
					<input type="text" disabled="disabled" data-setting="ogg" value="{{ data.model.ogg }}" />
					<button type="button" class="button-link remove-setting">Remove audio source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.m4a ) ) {
					if ( ! _.isUndefined( html5types.m4a ) ) {
						delete html5types.m4a;
					}
				#>
				<label class="setting">
					<span>M4A</span>
					<input type="text" disabled="disabled" data-setting="m4a" value="{{ data.model.m4a }}" />
					<button type="button" class="button-link remove-setting">Remove audio source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.wav ) ) {
					if ( ! _.isUndefined( html5types.wav ) ) {
						delete html5types.wav;
					}
				#>
				<label class="setting">
					<span>WAV</span>
					<input type="text" disabled="disabled" data-setting="wav" value="{{ data.model.wav }}" />
					<button type="button" class="button-link remove-setting">Remove audio source</button>
				</label>
				<# } #>
				
				<# if ( ! _.isEmpty( html5types ) ) { #>
				<div class="setting">
					<span>Add alternate sources for maximum HTML5 playback:</span>
					<div class="button-large">
					<# _.each( html5types, function (mime, type) { #>
					<button class="button add-media-source" data-mime="{{ mime }}">{{ type }}</button>
					<# } ) #>
					</div>
				</div>
				<# } #>

				<div class="setting preload">
					<span>Preload</span>
					<div class="button-group button-large" data-setting="preload">
						<button class="button" value="auto">Auto</button>
						<button class="button" value="metadata">Metadata</button>
						<button class="button active" value="none">None</button>
					</div>
				</div>

				<label class="setting checkbox-setting autoplay">
					<input type="checkbox" data-setting="autoplay" />
					<span>Autoplay</span>
				</label>

				<label class="setting checkbox-setting">
					<input type="checkbox" data-setting="loop" />
					<span>Loop</span>
				</label>
			</div>
		</div>
	</script>

	<script type="text/html" id="tmpl-video-details">
		<# var ext, html5types = {
			mp4: wp.media.view.settings.embedMimes.mp4,
			ogv: wp.media.view.settings.embedMimes.ogv,
			webm: wp.media.view.settings.embedMimes.webm
		}; #>

				<div class="media-embed media-embed-details">
			<div class="embed-media-settings embed-video-settings">
				<div class="wp-video-holder">
				<#
				var w = ! data.model.width || data.model.width > 640 ? 640 : data.model.width,
					h = ! data.model.height ? 360 : data.model.height;

				if ( data.model.width && w !== data.model.width ) {
					h = Math.ceil( ( h * w ) / data.model.width );
				}
				#>

				<#  var w_rule = '', classes = [],
		w, h, settings = wp.media.view.settings,
		isYouTube = isVimeo = false;

	if ( ! _.isEmpty( data.model.src ) ) {
		isYouTube = data.model.src.match(/youtube|youtu\.be/);
		isVimeo = -1 !== data.model.src.indexOf('vimeo');
	}

	if ( settings.contentWidth && data.model.width >= settings.contentWidth ) {
		w = settings.contentWidth;
	} else {
		w = data.model.width;
	}

	if ( w !== data.model.width ) {
		h = Math.ceil( ( data.model.height * w ) / data.model.width );
	} else {
		h = data.model.height;
 	}

	if ( w ) {
		w_rule = 'width: ' + w + 'px; ';
	}

	if ( isYouTube ) {
		classes.push( 'youtube-video' );
	}

	if ( isVimeo ) {
		classes.push( 'vimeo-video' );
	}

#>
<div style="{{ w_rule }}" class="wp-video">
<video controls
	class="wp-video-shortcode {{ classes.join( ' ' ) }}"
	<# if ( w ) { #>width="{{ w }}"<# } #>
	<# if ( h ) { #>height="{{ h }}"<# } #>
	<#
		if ( ! _.isUndefined( data.model.poster ) && data.model.poster ) {
			#> poster="{{ data.model.poster }}"<#
		} #>
		preload="{{ _.isUndefined( data.model.preload ) ? 'metadata' : data.model.preload }}"<#
	 if ( ! _.isUndefined( data.model.autoplay ) && data.model.autoplay ) {
		#> autoplay<#
	}
	 if ( ! _.isUndefined( data.model.loop ) && data.model.loop ) {
		#> loop<#
	}
	#>
>
	<# if ( ! _.isEmpty( data.model.src ) ) {
		if ( isYouTube ) { #>
		<source src="{{ data.model.src }}" type="video/youtube" />
		<# } else if ( isVimeo ) { #>
		<source src="{{ data.model.src }}" type="video/vimeo" />
		<# } else { #>
		<source src="{{ data.model.src }}" type="{{ settings.embedMimes[ data.model.src.split('.').pop() ] }}" />
		<# }
	} #>

	<# if ( data.model.mp4 ) { #>
	<source src="{{ data.model.mp4 }}" type="{{ settings.embedMimes[ 'mp4' ] }}" />
	<# } #>
	<# if ( data.model.m4v ) { #>
	<source src="{{ data.model.m4v }}" type="{{ settings.embedMimes[ 'm4v' ] }}" />
	<# } #>
	<# if ( data.model.webm ) { #>
	<source src="{{ data.model.webm }}" type="{{ settings.embedMimes[ 'webm' ] }}" />
	<# } #>
	<# if ( data.model.ogv ) { #>
	<source src="{{ data.model.ogv }}" type="{{ settings.embedMimes[ 'ogv' ] }}" />
	<# } #>
	<# if ( data.model.flv ) { #>
	<source src="{{ data.model.flv }}" type="{{ settings.embedMimes[ 'flv' ] }}" />
	<# } #>
		{{{ data.model.content }}}
</video>
</div>

				<# if ( ! _.isEmpty( data.model.src ) ) {
					ext = data.model.src.split('.').pop();
					if ( html5types[ ext ] ) {
						delete html5types[ ext ];
					}
				#>
				<label class="setting">
					<span>SRC</span>
					<input type="text" disabled="disabled" data-setting="src" value="{{ data.model.src }}" />
					<button type="button" class="button-link remove-setting">Remove video source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.mp4 ) ) {
					if ( ! _.isUndefined( html5types.mp4 ) ) {
						delete html5types.mp4;
					}
				#>
				<label class="setting">
					<span>MP4</span>
					<input type="text" disabled="disabled" data-setting="mp4" value="{{ data.model.mp4 }}" />
					<button type="button" class="button-link remove-setting">Remove video source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.m4v ) ) {
					if ( ! _.isUndefined( html5types.m4v ) ) {
						delete html5types.m4v;
					}
				#>
				<label class="setting">
					<span>M4V</span>
					<input type="text" disabled="disabled" data-setting="m4v" value="{{ data.model.m4v }}" />
					<button type="button" class="button-link remove-setting">Remove video source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.webm ) ) {
					if ( ! _.isUndefined( html5types.webm ) ) {
						delete html5types.webm;
					}
				#>
				<label class="setting">
					<span>WEBM</span>
					<input type="text" disabled="disabled" data-setting="webm" value="{{ data.model.webm }}" />
					<button type="button" class="button-link remove-setting">Remove video source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.ogv ) ) {
					if ( ! _.isUndefined( html5types.ogv ) ) {
						delete html5types.ogv;
					}
				#>
				<label class="setting">
					<span>OGV</span>
					<input type="text" disabled="disabled" data-setting="ogv" value="{{ data.model.ogv }}" />
					<button type="button" class="button-link remove-setting">Remove video source</button>
				</label>
				<# } #>
				<# if ( ! _.isEmpty( data.model.flv ) ) {
					if ( ! _.isUndefined( html5types.flv ) ) {
						delete html5types.flv;
					}
				#>
				<label class="setting">
					<span>FLV</span>
					<input type="text" disabled="disabled" data-setting="flv" value="{{ data.model.flv }}" />
					<button type="button" class="button-link remove-setting">Remove video source</button>
				</label>
				<# } #>
								</div>

				<# if ( ! _.isEmpty( html5types ) ) { #>
				<div class="setting">
					<span>Add alternate sources for maximum HTML5 playback:</span>
					<div class="button-large">
					<# _.each( html5types, function (mime, type) { #>
					<button class="button add-media-source" data-mime="{{ mime }}">{{ type }}</button>
					<# } ) #>
					</div>
				</div>
				<# } #>

				<# if ( ! _.isEmpty( data.model.poster ) ) { #>
				<label class="setting">
					<span>Poster Image</span>
					<input type="text" disabled="disabled" data-setting="poster" value="{{ data.model.poster }}" />
					<button type="button" class="button-link remove-setting">Remove poster image</button>
				</label>
				<# } #>
				<div class="setting preload">
					<span>Preload</span>
					<div class="button-group button-large" data-setting="preload">
						<button class="button" value="auto">Auto</button>
						<button class="button" value="metadata">Metadata</button>
						<button class="button active" value="none">None</button>
					</div>
				</div>

				<label class="setting checkbox-setting autoplay">
					<input type="checkbox" data-setting="autoplay" />
					<span>Autoplay</span>
				</label>

				<label class="setting checkbox-setting">
					<input type="checkbox" data-setting="loop" />
					<span>Loop</span>
				</label>

				<label class="setting" data-setting="content">
					<span>Tracks (subtitles, captions, descriptions, chapters, or metadata)</span>
					<#
					var content = '';
					if ( ! _.isEmpty( data.model.content ) ) {
						var tracks = jQuery( data.model.content ).filter( 'track' );
						_.each( tracks.toArray(), function (track) {
							content += track.outerHTML; #>
						<p>
							<input class="content-track" type="text" value="{{ track.outerHTML }}" />
							<button type="button" class="button-link remove-setting remove-track">Remove video track</button>
						</p>
						<# } ); #>
					<# } else { #>
					<em>There are no associated subtitles.</em>
					<# } #>
					<textarea class="hidden content-setting">{{ content }}</textarea>
				</label>
			</div>
		</div>
	</script>

	<script type="text/html" id="tmpl-editor-gallery">
		<# if ( data.attachments.length ) { #>
			<div class="gallery gallery-columns-{{ data.columns }}">
				<# _.each( data.attachments, function( attachment, index ) { #>
					<dl class="gallery-item">
						<dt class="gallery-icon">
							<# if ( attachment.thumbnail ) { #>
								<img src="{{ attachment.thumbnail.url }}" width="{{ attachment.thumbnail.width }}" height="{{ attachment.thumbnail.height }}" alt="" />
							<# } else { #>
								<img src="{{ attachment.url }}" alt="" />
							<# } #>
						</dt>
						<# if ( attachment.caption ) { #>
							<dd class="wp-caption-text gallery-caption">
								{{{ data.verifyHTML( attachment.caption ) }}}
							</dd>
						<# } #>
					</dl>
					<# if ( index % data.columns === data.columns - 1 ) { #>
						<br style="clear: both;">
					<# } #>
				<# } ); #>
			</div>
		<# } else { #>
			<div class="wpview-error">
				<div class="dashicons dashicons-format-gallery"></div><p>No items found.</p>
			</div>
		<# } #>
	</script>

	<script type="text/html" id="tmpl-crop-content">
		<img class="crop-image" src="{{ data.url }}" alt="Image crop area preview. Requires mouse interaction.">
		<div class="upload-errors"></div>
	</script>

	<script type="text/html" id="tmpl-site-icon-preview">
		<h2>Preview</h2>
		<strong aria-hidden="true">As a browser icon</strong>
		<div class="favicon-preview">
			<img src="https://www.ultimatebattle.in/wp-admin/images/browser.png" class="browser-preview" width="182" height="" alt="" />

			<div class="favicon">
				<img id="preview-favicon" src="{{ data.url }}" alt="Preview as a browser icon"/>
			</div>
			<span class="browser-title" aria-hidden="true"></span>
		</div>

		<strong aria-hidden="true">As an app icon</strong>
		<div class="app-icon-preview">
			<img id="preview-app-icon" src="{{ data.url }}" alt="Preview as an app icon"/>
		</div>
	</script>

		<script type="text/javascript">
		var c = document.body.className;
		c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
		document.body.className = c;
	</script>
	<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/ub-stats/includes/js/ubs_scripts.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/comment-reply.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"ultimatebattle"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/disqus-comment-system/public/js/comment_count.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/js/jquery-blockui/jquery.blockUI.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/js/js-cookie/js.cookie.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var woocommerce_params = {"ajax_url":"\/wp-admin\/admin-ajax.php","wc_ajax_url":"\/?wc-ajax=%%endpoint%%"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/js/frontend/woocommerce.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wc_cart_fragments_params = {"ajax_url":"\/wp-admin\/admin-ajax.php","wc_ajax_url":"\/?wc-ajax=%%endpoint%%","cart_hash_key":"wc_cart_hash_8914f6a1577bd3cef6b23ca238d52adc","fragment_name":"wc_fragments_8914f6a1577bd3cef6b23ca238d52adc","request_timeout":"5000"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/woocommerce/assets/js/frontend/cart-fragments.min.js'></script>
<script type='text/javascript' src='https://cdn.onesignal.com/sdks/OneSignalSDK.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/easy-responsive-tabs.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.basictable.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.nivo.slider.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/owl.carousel.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var settingsNoty = {"challenge_accepted":"Challenge accepted!","challenge_rejected":"Challenge rejected!","match_deleted":"Match deleted!","score_accepted":"Score accepted!","score_rejected":"Score rejected!","challenge_request_sent":"Challenge request sent!","submitted":"Score has been submitted!","already_submitted":"Score has already been submitted by other team!","join_clan":"Your request to join clan has been sent!","let_this_member_join":"User joined your clan!","remove_friend":"Removed from clan!","cancel_request":"Request canceled!","make_administrator":"Added as administrator!","downgrade_to_user":"Admin downgraded!","reported":"Match has been reported!","clan_deleted":"Clan has been deleted!","delete_page_background":"Clan page background deleted successfully!"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/noty/packaged/jquery.noty.packaged.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/remove-vc-elements.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.webticker.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.bxslider.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/imagesloaded.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/jquery.validate.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/global.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/imagescale.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/js/transit.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/underscore.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/shortcode.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/backbone.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpUtilSettings = {"ajax":{"url":"\/wp-admin\/admin-ajax.php"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/wp-util.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/wp-backbone.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpMediaModelsL10n = {"settings":{"ajaxurl":"\/wp-admin\/admin-ajax.php","post":{"id":0}}};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/media-models.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pluploadL10n = {"queue_limit_exceeded":"You have attempted to queue too many files.","file_exceeds_size_limit":"%s exceeds the maximum upload size for this site.","zero_byte_file":"This file is empty. Please try another.","invalid_filetype":"Sorry, this file type is not permitted for security reasons.","not_an_image":"This file is not an image. Please try another.","image_memory_exceeded":"Memory exceeded. Please try another smaller file.","image_dimensions_exceeded":"This is larger than the maximum size. Please try another.","default_error":"An error occurred in the upload. Please try again later.","missing_upload_url":"There was a configuration error. Please contact the server administrator.","upload_limit_exceeded":"You may only upload 1 file.","http_error":"HTTP error.","upload_failed":"Upload failed.","big_upload_failed":"Please try uploading this file with the %1$sbrowser uploader%2$s.","big_upload_queued":"%s exceeds the maximum upload size for the multi-file uploader when used in your browser.","io_error":"IO error.","security_error":"Security error.","file_cancelled":"File canceled.","upload_stopped":"Upload stopped.","dismiss":"Dismiss","crunching":"Crunching\u2026","deleted":"moved to the trash.","error_uploading":"\u201c%s\u201d has failed to upload."};
var _wpPluploadSettings = {"defaults":{"runtimes":"html5,flash,silverlight,html4","file_data_name":"async-upload","url":"\/wp-admin\/async-upload.php","flash_swf_url":"https:\/\/www.ultimatebattle.in\/wp-includes\/js\/plupload\/plupload.flash.swf","silverlight_xap_url":"https:\/\/www.ultimatebattle.in\/wp-includes\/js\/plupload\/plupload.silverlight.xap","filters":{"max_file_size":"83886080b","mime_types":[{"extensions":"jpg,jpeg,jpe,gif,png,bmp,tiff,tif,ico,asf,asx,wmv,wmx,wm,avi,divx,flv,mov,qt,mpeg,mpg,mpe,mp4,m4v,ogv,webm,mkv,3gp,3gpp,3g2,3gp2,txt,asc,c,cc,h,srt,csv,tsv,ics,rtx,css,vtt,dfxp,mp3,m4a,m4b,ra,ram,wav,ogg,oga,mid,midi,wma,wax,mka,rtf,js,pdf,class,tar,zip,gz,gzip,rar,7z,psd,xcf,doc,pot,pps,ppt,wri,xla,xls,xlt,xlw,mdb,mpp,docx,docm,dotx,dotm,xlsx,xlsm,xlsb,xltx,xltm,xlam,pptx,pptm,ppsx,ppsm,potx,potm,ppam,sldx,sldm,onetoc,onetoc2,onetmp,onepkg,oxps,xps,odt,odp,ods,odg,odc,odb,odf,wp,wpd,key,numbers,pages"}]},"multipart_params":{"action":"upload-attachment","_wpnonce":"8df392b8f6"}},"browser":{"mobile":true,"supported":true},"limitExceeded":false};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/plupload/wp-plupload.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/jquery/ui/core.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/jquery/ui/widget.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/jquery/ui/mouse.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/jquery/ui/sortable.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var mejsL10n = {"language":"en-US","strings":{"Close":"Close","Fullscreen":"Fullscreen","Turn off Fullscreen":"Turn off Fullscreen","Go Fullscreen":"Go Fullscreen","Download File":"Download File","Download Video":"Download Video","Play":"Play","Pause":"Pause","Captions\/Subtitles":"Captions\/Subtitles","None":"None","Time Slider":"Time Slider","Skip back %1 seconds":"Skip back %1 seconds","Video Player":"Video Player","Audio Player":"Audio Player","Volume Slider":"Volume Slider","Mute Toggle":"Mute Toggle","Unmute":"Unmute","Mute":"Mute","Use Up\/Down Arrow keys to increase or decrease volume.":"Use Up\/Down Arrow keys to increase or decrease volume.","Use Left\/Right Arrow keys to advance one second, Up\/Down arrows to advance ten seconds.":"Use Left\/Right Arrow keys to advance one second, Up\/Down arrows to advance ten seconds."}};
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/mediaelement/mediaelement-and-player.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/mediaelement/wp-mediaelement.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpMediaViewsL10n = {"url":"URL","addMedia":"Add Media","search":"Search","select":"Select","cancel":"Cancel","update":"Update","replace":"Replace","remove":"Remove","back":"Back","selected":"%d selected","dragInfo":"Drag and drop to reorder media files.","uploadFilesTitle":"Upload Files","uploadImagesTitle":"Upload Images","mediaLibraryTitle":"Media Library","insertMediaTitle":"Insert Media","createNewGallery":"Create a new gallery","createNewPlaylist":"Create a new playlist","createNewVideoPlaylist":"Create a new video playlist","returnToLibrary":"\u2190 Return to library","allMediaItems":"All media items","allDates":"All dates","noItemsFound":"No items found.","insertIntoPost":"Use this image","unattached":"Unattached","trash":"Trash","uploadedToThisPost":"Uploaded to this post","warnDelete":"You are about to permanently delete this item from your site.\nThis action cannot be undone.\n 'Cancel' to stop, 'OK' to delete.","warnBulkDelete":"You are about to permanently delete these items from your site.\nThis action cannot be undone.\n 'Cancel' to stop, 'OK' to delete.","warnBulkTrash":"You are about to trash these items.\n  'Cancel' to stop, 'OK' to delete.","bulkSelect":"Bulk Select","cancelSelection":"Cancel Selection","trashSelected":"Trash Selected","untrashSelected":"Untrash Selected","deleteSelected":"Delete Selected","deletePermanently":"Delete Permanently","apply":"Apply","filterByDate":"Filter by date","filterByType":"Filter by type","searchMediaLabel":"Search Media","searchMediaPlaceholder":"Search media items...","noMedia":"No media files found.","attachmentDetails":"Attachment Details","insertFromUrlTitle":"Insert from URL","setFeaturedImageTitle":"Featured Image","setFeaturedImage":"Set featured image","createGalleryTitle":"Create Gallery","editGalleryTitle":"Edit Gallery","cancelGalleryTitle":"\u2190 Cancel Gallery","insertGallery":"Insert gallery","updateGallery":"Update gallery","addToGallery":"Add to gallery","addToGalleryTitle":"Add to Gallery","reverseOrder":"Reverse order","imageDetailsTitle":"Image Details","imageReplaceTitle":"Replace Image","imageDetailsCancel":"Cancel Edit","editImage":"Edit Image","chooseImage":"Choose Image","selectAndCrop":"Select and Crop","skipCropping":"Skip Cropping","cropImage":"Crop Image","cropYourImage":"Crop your image","cropping":"Cropping\u2026","suggestedDimensions":"Suggested image dimensions: %1$s by %2$s pixels.","cropError":"There has been an error cropping your image.","audioDetailsTitle":"Audio Details","audioReplaceTitle":"Replace Audio","audioAddSourceTitle":"Add Audio Source","audioDetailsCancel":"Cancel Edit","videoDetailsTitle":"Video Details","videoReplaceTitle":"Replace Video","videoAddSourceTitle":"Add Video Source","videoDetailsCancel":"Cancel Edit","videoSelectPosterImageTitle":"Select Poster Image","videoAddTrackTitle":"Add Subtitles","playlistDragInfo":"Drag and drop to reorder tracks.","createPlaylistTitle":"Create Audio Playlist","editPlaylistTitle":"Edit Audio Playlist","cancelPlaylistTitle":"\u2190 Cancel Audio Playlist","insertPlaylist":"Insert audio playlist","updatePlaylist":"Update audio playlist","addToPlaylist":"Add to audio playlist","addToPlaylistTitle":"Add to Audio Playlist","videoPlaylistDragInfo":"Drag and drop to reorder videos.","createVideoPlaylistTitle":"Create Video Playlist","editVideoPlaylistTitle":"Edit Video Playlist","cancelVideoPlaylistTitle":"\u2190 Cancel Video Playlist","insertVideoPlaylist":"Insert video playlist","updateVideoPlaylist":"Update video playlist","addToVideoPlaylist":"Add to video playlist","addToVideoPlaylistTitle":"Add to Video Playlist","settings":{"tabs":[],"tabUrl":"https:\/\/www.ultimatebattle.in\/wp-admin\/media-upload.php?chromeless=1","mimeTypes":{"image":"Images","audio":"Audio","video":"Video"},"captions":true,"nonce":{"sendToEditor":"255598dd4d","wpRestApi":"10b2931dbd"},"post":{"id":0},"defaultProps":{"link":"file","align":"","size":""},"attachmentCounts":{"audio":1,"video":1},"oEmbedProxyUrl":"https:\/\/www.ultimatebattle.in\/wp-json\/oembed\/1.0\/proxy","embedExts":["mp3","ogg","m4a","wav","mp4","m4v","webm","ogv","flv"],"embedMimes":{"mp3":"audio\/mpeg","ogg":"audio\/ogg","m4a":"audio\/mpeg","wav":"audio\/wav","mp4":"video\/mp4","m4v":"video\/mp4","webm":"video\/webm","ogv":"video\/ogg","flv":"video\/x-flv"},"contentWidth":null,"months":[{"year":"2023","month":"3","text":"March 2023"},{"year":"2023","month":"2","text":"February 2023"},{"year":"2023","month":"1","text":"January 2023"},{"year":"2022","month":"12","text":"December 2022"},{"year":"2022","month":"11","text":"November 2022"},{"year":"2022","month":"10","text":"October 2022"},{"year":"2022","month":"9","text":"September 2022"},{"year":"2022","month":"8","text":"August 2022"},{"year":"2022","month":"7","text":"July 2022"},{"year":"2022","month":"6","text":"June 2022"},{"year":"2022","month":"5","text":"May 2022"},{"year":"2022","month":"4","text":"April 2022"},{"year":"2022","month":"3","text":"March 2022"},{"year":"2022","month":"2","text":"February 2022"},{"year":"2022","month":"1","text":"January 2022"},{"year":"2021","month":"12","text":"December 2021"},{"year":"2021","month":"11","text":"November 2021"},{"year":"2021","month":"10","text":"October 2021"},{"year":"2021","month":"9","text":"September 2021"},{"year":"2021","month":"8","text":"August 2021"},{"year":"2021","month":"7","text":"July 2021"},{"year":"2021","month":"6","text":"June 2021"},{"year":"2021","month":"5","text":"May 2021"},{"year":"2021","month":"4","text":"April 2021"},{"year":"2021","month":"3","text":"March 2021"},{"year":"2021","month":"2","text":"February 2021"},{"year":"2021","month":"1","text":"January 2021"},{"year":"2020","month":"12","text":"December 2020"},{"year":"2020","month":"11","text":"November 2020"},{"year":"2020","month":"10","text":"October 2020"},{"year":"2020","month":"9","text":"September 2020"},{"year":"2020","month":"8","text":"August 2020"},{"year":"2020","month":"7","text":"July 2020"},{"year":"2020","month":"6","text":"June 2020"},{"year":"2020","month":"5","text":"May 2020"},{"year":"2020","month":"4","text":"April 2020"},{"year":"2020","month":"3","text":"March 2020"},{"year":"2020","month":"2","text":"February 2020"},{"year":"2020","month":"1","text":"January 2020"},{"year":"2019","month":"12","text":"December 2019"},{"year":"2019","month":"11","text":"November 2019"},{"year":"2019","month":"10","text":"October 2019"},{"year":"2019","month":"9","text":"September 2019"},{"year":"2019","month":"7","text":"July 2019"},{"year":"2019","month":"6","text":"June 2019"},{"year":"2019","month":"5","text":"May 2019"},{"year":"2019","month":"4","text":"April 2019"},{"year":"2019","month":"3","text":"March 2019"},{"year":"2019","month":"2","text":"February 2019"},{"year":"2019","month":"1","text":"January 2019"},{"year":"2018","month":"12","text":"December 2018"},{"year":"2018","month":"11","text":"November 2018"},{"year":"2018","month":"10","text":"October 2018"},{"year":"2018","month":"9","text":"September 2018"},{"year":"2018","month":"8","text":"August 2018"},{"year":"2018","month":"7","text":"July 2018"},{"year":"2018","month":"6","text":"June 2018"},{"year":"2018","month":"5","text":"May 2018"},{"year":"2018","month":"4","text":"April 2018"},{"year":"2018","month":"3","text":"March 2018"},{"year":"2018","month":"2","text":"February 2018"},{"year":"2018","month":"1","text":"January 2018"},{"year":"2017","month":"12","text":"December 2017"},{"year":"2017","month":"11","text":"November 2017"},{"year":"2017","month":"10","text":"October 2017"},{"year":"2017","month":"9","text":"September 2017"},{"year":"2017","month":"8","text":"August 2017"},{"year":"2017","month":"7","text":"July 2017"},{"year":"2017","month":"6","text":"June 2017"},{"year":"2017","month":"5","text":"May 2017"},{"year":"2017","month":"4","text":"April 2017"},{"year":"2017","month":"3","text":"March 2017"},{"year":"2017","month":"2","text":"February 2017"},{"year":"2017","month":"1","text":"January 2017"},{"year":"2016","month":"12","text":"December 2016"},{"year":"2016","month":"11","text":"November 2016"},{"year":"2016","month":"10","text":"October 2016"},{"year":"2016","month":"9","text":"September 2016"},{"year":"2016","month":"8","text":"August 2016"},{"year":"2016","month":"7","text":"July 2016"},{"year":"2016","month":"6","text":"June 2016"},{"year":"2016","month":"5","text":"May 2016"},{"year":"2016","month":"4","text":"April 2016"},{"year":"2016","month":"3","text":"March 2016"},{"year":"2016","month":"2","text":"February 2016"},{"year":"2016","month":"1","text":"January 2016"},{"year":"2015","month":"12","text":"December 2015"},{"year":"2015","month":"11","text":"November 2015"},{"year":"2015","month":"10","text":"October 2015"},{"year":"2015","month":"9","text":"September 2015"},{"year":"2015","month":"8","text":"August 2015"},{"year":"2015","month":"3","text":"March 2015"},{"year":"2015","month":"2","text":"February 2015"}],"mediaTrash":0}};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/media-views.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/media-editor.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/media-audiovideo.min.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-content/plugins/wp-social-sharing/static/socialshare.js'></script>
<script type='text/javascript' src='https://www.ultimatebattle.in/wp-includes/js/wp-embed.min.js'></script>
<div id="sitewide-notice" class="admin-bar-off"></div>
	<div class="support-wrap">
		<div class="ubsupport" style="cursor: pointer" id="ultimatebat" onclick="chat(108, 'OCKET_ADMIN_USERNAME', 'UB Support')">Report issue</div>
		<div class="ub-help" data-toggle="modal" data-target="#how_to_play_modal" style="cursor: pointer;">How to play?</div>
	</div>

	<div class="sticky_support">
		<div class="app-stk repoart_issue" id="ultimatebat" onclick="chat(108, 'ultimatebat', 'UB Support')">Report issue</div>
		<div class="app-stk mb_dashboard">Dashboard</div>
		<!--<div class="app-stk hplay"><a href="https://www.ultimatebattle.in/how-it-works.html">How to play</a></div>-->
		<div class="app-stk hplay" data-toggle="modal" data-target="#how_to_play_modal">How to play</div>
	</div>


<!-- Login failed message -->

<!-- modal - how to play -->
<div id="how_to_play_modal" class="modal fade" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h2>How to play <span>Free Fire Max</span></h2>
			</div>
			<div class="modal-body">
				<div>
					<ul class="tabs tabcontent">
						<li><a href="#gamePlay">Tournament</a></li>
						<li><a href="#challengePlay">Challenges</a></li>
											</ul>

					<div id="gamePlay" class="tab-display">
						<p><img class="alignnone size-full wp-image-22211" src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/free-fire-HOW-TO-PLAY-TOURNAMENT-1.jpg" /><img class="alignnone size-full wp-image-22212" src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/free-fire-HOW-TO-PLAY-TOURNAMENT-2.jpg" /><img class="alignnone size-full wp-image-22213" src="https://www.ultimatebattle.in/wp-content/uploads/2019/09/free-fire-HOW-TO-PLAY-TOURNAMENT-3.jpg" /></p>
					</div>

					<div id="challengePlay" class="tab-display">
											</div>

									</div>
			</div>
		</div>
	</div>
</div>

<!-- modal - challenge pop -->
<div class="modal fade" id="challengePop" tabindex="-1" role="dialog" aria-labelledby="challengePopTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div id="challengePopFormWrap" class="modal-content"></div>
	</div>
</div>

<!-- modal - Challenge result -->
<div id="challengeResultModal" class="modal fade _winnermodel" role="dialog" area-hidden="true" data-backdrop="static">
	<div class="modal-dialog modal-dialog-centered">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-body">
				<h3></h3>
				<figure>
					<img src="" alt="" class="crm-game-banner" /> <span class="_gmlogo"> <img src="" alt="Warriors" class="crm-game-logo" /></span>
				</figure>
				<div class="winner-users">
					<ul>
						<li class="player1-data">
							<figure>
								<img src="" alt="" class="" onerror="this.src='https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/defaults/default-profile.jpg'">
							</figure>
							<h4></h4>
							<div class="_winpoints"></div>
						</li>
						<li class="mid">Scores <span></span></li>
						<li class="player2-data">
							<figure><img src="" alt="" class=""></figure>
							<h4></h4>
							<div class="_winpoints"></div>
						</li>
					</ul>
				</div>
				<div class="_ubshares">
					<!-- <a href="#" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
					<a href="#" target="_blank"><i class="fa fa-instagram" aria-hidden="true"></i></a>
					<a href="#" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a> -->
					<span class="_cbtn">
						<button type="button" class="close" data-dismiss="modal">Close</button>
					</span>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
	jQuery(function(){
		let issueReported = ""
		if (issueReported) {
			jQuery("#alertModal .alert-modal-content").html('<p class="alert success" style="margin-bottom: 0"><i class="fa fa-check-circle"></i> '+issueReported+'</p>')
			jQuery("#alertModal").modal('show')
		}

		jQuery(window).scroll(function() {
			var scroll = jQuery(window).scrollTop()
			if (scroll >= 160) {
				jQuery(".headersection").addClass("darkHeader")
			} else {
				jQuery(".headersection").removeClass("darkHeader")
			}
		})

		jQuery(window).scroll(function() {
			var scroll = jQuery(window).scrollTop()
			if (scroll >= 650) {
				jQuery("#game_page_tournaments").addClass("sticky_header")
			} else {
				jQuery("#game_page_tournaments").removeClass("sticky_header")
			}
		})

		jQuery('.g-changer').click(function(){
			jQuery('.game-select').toggle()
		})

		jQuery('html').click(function(event) {
			if (0 === jQuery(event.target).closest('.gm-link-wp').length) {
				jQuery('.game-select').hide()
			}
		})

		jQuery('._mbNav').click(function(){
			jQuery('.rt-nav ul').toggleClass('m4')
		})

		jQuery('html').click(function(event) {
			if (0 === jQuery(event.target).closest('.container').length) {
				jQuery('.rt-nav ul').removeClass('m4')
			}
		})

		jQuery("#header-game-switch").on('change', function(){
			window.location.href = jQuery(this).val()
		})

		jQuery('ul.lobbytabs li').click(function(){
			var tab_id = jQuery(this).attr('data-tab')
			jQuery('ul.lobbytabs li').removeClass('current')
			jQuery('.tab-content').removeClass('current')
			jQuery(this).addClass('current')
			jQuery("#"+tab_id).addClass('current')
		})

		// tab
		jQuery('#horizontalTab').easyResponsiveTabs({
			type: 'default', //Types: default, vertical, accordion           
			width: 'auto', //auto or any width like 600px
			fit: true,   // 100% fit in a container
			closed: 'accordion', // Start closed if in accordion view
			activate: function(event) { // Callback function if tab is switched
				var $tab = jQuery(this)
				var $info = jQuery('#tabInfo')
				var $name = jQuery('span', $info)
				$name.text($tab.text())
				$info.show()
			}
		})
	
		jQuery('#table').basictable()
		jQuery('#table-completed-tournaments').basictable()
		jQuery('#table-related-tournaments').basictable()
		// /tab

		jQuery('#slider').nivoSlider()

		jQuery("#chosegame").owlCarousel({
			items :4,
			lazyLoad : true,
			autoPlay : true,
			navigation : true
		})

		jQuery("#leaderboard").owlCarousel({
			items :2,
			lazyLoad : true,
			autoPlay : false,
			navigation : true
		})

		jQuery("#recent-blog").owlCarousel({
			items :3,
			lazyLoad : true,
			autoPlay : true,
			navigation : false
		})

		jQuery("input[name='mobile_number']").keypress(function(e){
			var key = e.which;
			if (key == 13) {
				getAppLink()
			}
		})

		jQuery('#cssmenu').meanmenu()

		jQuery('.gameNavigation').click(function(){
			jQuery('.games-navigation').toggleClass('game-nav-active')
		})

		// ul tabs
		jQuery('ul.tabs').each(function(){
			// For each set of tabs, we want to keep track of
			// which tab is active and its associated content
			var $active, $content, $links = jQuery(this).find('a')

			// If the location.hash matches one of the links, use that as the active tab.
			// If no match is found, use the first link as the initial active tab.
			$active = jQuery($links.filter('[href="'+location.hash+'"]')[0] || $links[0])
			$active.addClass('active')
			$content = jQuery($active[0].hash)

			// Hide the remaining content
			$links.not($active).each(function () {
				jQuery(this.hash).hide()
			})

			// Bind the click event handler
			jQuery(this).on('click', 'a', function(e){
				// Make the old tab inactive.
				$active.removeClass('active')
				$content.hide()

				// Update the variables with the new link and content
				$active = jQuery(this)
				$content = jQuery(this.hash)

				// Make the tab active.
				$active.addClass('active')
				$content.show()

				// Prevent the anchor's default click action
				e.preventDefault()
			})
		})

		jQuery("._ubnc").on('click', function(){
			if (jQuery("._bell-notif-box").is(":hidden")) {
				jQuery("._bell-notif-box").slideDown(function(){
					jQuery("._ubnc").addClass('active')
				})		
			}
		})

		jQuery(document).mouseup(function(e){
			let container = jQuery("._bell-notif-box");
			// if the target of the click isn't the container nor a descendant of the container
			if (!container.is(e.target) && container.has(e.target).length === 0) {
				container.slideUp(function(){
					jQuery("._ubnc").removeClass('active')
				})
			}
		})

		/*jQuery("._bell-notif-box ul li ._mar").toggle(
			function(){
				jQuery(this).removeClass('unread')
				jQuery(this).attr('title', 'Mark as unread')
				jQuery(this).parents('li').removeClass('unread')
			},
			function(){
				jQuery(this).addClass('unread')
				jQuery(this).attr('title', 'Mark as read')
				jQuery(this).parents('li').addClass('unread')
			}
		);*/

		jQuery(document).on("click", "._bell-notif-box ul li ._mar.unread", function(){
			$this = jQuery(this)
			markRead($this)
			jQuery.get(
				`${themeDir}ajax.php`,
				{
					action: 'mark_as_read',
					notification: $this.parents('li').data('notification'),
					media: $this.parents('li').data('media')
				},
				function(response) {
					if (response != 'success') {
						markUnread($this)
					}
				}
			)
		})

		jQuery("._bell-notif-box ul li a").on('click', function(){
			$this = jQuery(this)
			$this.find('._mar').removeClass('unread')
			$this.find('._mar').addClass('read')
			$this.find('._mar').attr('title', 'Mark as unread')
			$this.parents('li').removeClass('unread')
			$this.parents('li').addClass('read')

			if (jQuery("._ubnc i").find("._hnc16").length > 0) {
				var num = Number(jQuery("._ubnc i ._hnc16").text())
				var newNum = num - 1
				newNum = (newNum < 1) ? 0 : newNum
				if (0 == newNum)
					jQuery("._ubnc i ._hnc16").remove()
				else
					jQuery("._ubnc i ._hnc16").text(num - 1)
			} else {
				jQuery("._ubnc i").append('<span class="_hnc16">1</span>')
			}

			jQuery.get(
				`${themeDir}ajax.php`,
				{
					action: 'mark_as_read',
					notification: $this.parents('li').data('notification'),
					media: $this.parents('li').data('media')
				},
				function(response) {
					if ('success' != response) {
						markUnread($this)
					}
				}
			)
		})

		jQuery(document).on("click", "._bell-notif-box ul li ._mar.read", function(){
			$this = jQuery(this);
			markUnread($this);
			jQuery.get(
				themeDir+'ajax.php',
				{action: 'mark_as_unread', notification: $this.parents('li').data('notification'), media: $this.parents('li').data('media')},
				function(response) {
					if (response != 'success') {
						markRead($this);
					}
				}
				);
		})

		jQuery(".game-menu-trigger").toggle(
			function(){
				jQuery(".games-navigation").slideDown();
			},
			function(){
				jQuery(".games-navigation").slideUp();
			}
		)

		/*jQuery("._gpsn-challenge-lobby.has-children").toggle(
			function(){
				jQuery("._gpsn-challenge-lobby.has-children .sub-sub-menu").slideDown();
			},
			function(){
				jQuery("._gpsn-challenge-lobby.has-children .sub-sub-menu").slideUp();
			}
		);*/

		jQuery(document).on('click', '._sif', function(e){
			// jQuery("._sif").on('click', function(e){
			e.preventDefault();

            let regFlow = 'new'
			
            if ('new' == regFlow) {
                displayUserRegistrationModal()
                return
            }

            jQuery('html, body').animate({ scrollTop: 0 }, 'slow', function () {
                jQuery(".ub-login-drop").show();
            });
		})

		jQuery('.ub_signup > button._hlrt').click(function(){
			jQuery('.ub-login-drop').toggle();
		});
		jQuery('html').click(function(event) {
			if (jQuery(event.target).closest('.ub_signup').length === 0) {
				jQuery('.ub-login-drop').hide();
			}
		})

		// redeem coins
		const redeemCoins = $button => {
			let inGameId
			if (0 == jQuery('#ingameid').length) {
				inGameId = 'na'
			} else {
				$inGameIdField = jQuery('#ingameid')
				inGameId = $inGameIdField.val().trim()
			}

			if (!inGameId) {
				if ($inGameIdField.closest('div').find('.redeem-error').length > 0) {
					$inGameIdField.closest('div').find('.redeem-error').html(`<i class="fa fa-warning"></i> Please enter In-Game ID`)
					return false
				}

				$inGameIdField.closest('div').append(`<p class="redeem-error error"><i class="fa fa-warning"></i> Please enter In-Game ID</p>`)
				return false
			}

			$button.html(loadingSpinner(15))

			let product = $button.val()
			let quantity = +$button.parent().find("input[name='quantity']").val()

            const data = {
                action: 'redeem_product',
                user: currentUserId,
                product,
                quantity,
                ingameid: inGameId
            };

			jQuery.post(
				`${themeDir}ajax.php`,
				data,
				function(response) {
                    // {"result":true,"error":"","order_id":34427,"message":"Redeemed successfully."}
                    console.log(response)
					response = JSON.parse(response)
                    console.log(response)
					$button.text('Redeem')

					if ('not_an_active_subscriber' == response.error) {
						jQuery('#buySubscriptionModal').modal('show')
						if (response.message) {
							const $wrap = jQuery('#buySubscriptionModal .play-subs-info')
							if ($wrap.find('._sem').length == 0)
								$wrap.prepend(`<p class="_sem alert alert-danger"><i class="fa fa-warning"></i> ${response.message}</p>`)
							else
								$wrap.find('._sem').html(`<i class="fa fa-warning"></i> ${response.message}`)
						}
						return
					}

					let modalText = `<h5 class="${response.result ? 'success' : 'error'} text-center"><i class="fa fa-${response.result ? 'check' : 'warning'}"></i> ${response.message}</h5>`
					if (response.result) modalText += `<p class="text-center" style="color: #555">Check delivery status in My Orders</p>`
					jQuery("#alertModal .modal-body-ub").html(modalText)
					jQuery("#alertModal").modal('show')
				}

			)
		}

		jQuery(".single-redeem-button").on('click', function(){
			redeemCoins(jQuery(this))
		})
	});

	(function($) {
		jQuery(document).ready(function() {
			jQuery('.mobileMenu').click(function(){
				jQuery('.gm_navs').slideToggle();
			});
			
			jQuery('.nvbar__').click(function(){
				jQuery('.menu-ues-main-menu-container').toggleClass('OP');
			});
			
			/*jQuery('#cssmenu').prepend('<div id="menu-button">Menu</div>');
			jQuery('#cssmenu #menu-button').on('click', function(){
				var menu = jQuery(this).next('ul');
				if (menu.hasClass('open')) {
					menu.removeClass('open');
				} else {
					menu.addClass('open');
				}
			});*/
			jQuery('.user-dashboard-profile-inforamation').hover(
				function () {
					jQuery('.dashboard-game-pre').stop().slideDown(200);
				},
				function () {
					jQuery('.dashboard-game-pre').stop().slideUp(200);
				}
			);
			jQuery('.user-login-profile').hover(
				function () {
					jQuery('.usr-dash-sblist').stop().slideDown(200);
				},
				function () {
					jQuery('.usr-dash-sblist').stop().slideUp(200);
				}
			);
		});
	})(jQuery);
	
	function participateLedaderBoard(game_id,leaderboardid,user_id) {
		// alert(themeDir);
		// themeDir+'ajax.php',
		jQuery.ajax({
			type: "GET",
			url: `${themeDir}ajax.php?action=joinclicktoenterledaderboard&game_id=${game_id}&leaderboardid=${leaderboardid}&user_id=${user_id}`,
			success: function(response) {
				if (response) { location.reload(); }
			}
		});
	}

	function markRead(target) {
		target.removeClass('unread');
		target.addClass('read');
		target.attr('title', 'Mark as unread');
		target.parents('li').removeClass('unread');
		target.parents('li').addClass('read');
		if (jQuery("._ubnc i").find("._hnc16").length > 0) {
			var num = Number(jQuery("._ubnc i ._hnc16").text());
			var newNum = num - 1;
			newNum = (newNum < 1) ? 0 : newNum;
			if (newNum == 0) {
				jQuery("._ubnc i ._hnc16").remove();
			} else {
				jQuery("._ubnc i ._hnc16").text(num - 1);
			}
		} else {
			jQuery("._ubnc i").append('<span class="_hnc16">1</span>');
		}
	}

	function markUnread(target) {
		target.removeClass('read');
		target.addClass('unread');
		target.attr('title', 'Mark as read');
		target.parents('li').removeClass('read');
		target.parents('li').addClass('unread');
		if (jQuery("._ubnc i").find("._hnc16").length > 0) {
			var num = Number(jQuery("._ubnc i ._hnc16").text());
			jQuery("._ubnc i ._hnc16").text(num + 1);
		} else {
			jQuery("._ubnc i").append('<span class="_hnc16">1</span>');
		}
	}

	function getAppLink() {
		let $mobile = jQuery("input[name='mobile_number']")
		const mobileNumber = $mobile.val().trim()

		if (0 == mobileNumber.length) {
			jQuery(".mobile-number-error").css('color', 'red')
			jQuery(".mobile-number-error").html(`<i class='fa fa-warning'></i> Please input mobile number`)
			jQuery(".mobile-number-error").fadeIn()
			return
		}

		if (!mobileNumber.match(/^[0-9]{10}$/)) {
			jQuery(".mobile-number-error").css('color', 'red')
			jQuery(".mobile-number-error").html(`<i class='fa fa-warning'></i> Invalid mobile number`)
			jQuery(".mobile-number-error").fadeIn()
			return
		}

		jQuery(".mobile-number-error").css('color', '#777')
		jQuery(".mobile-number-error").html(`${loadingSpinner(15)} Sending app link...`)
		jQuery(".mobile-number-error").fadeIn()

		jQuery.post(
			`${themeDir}ajax.php`,
			{action: 'send_app_link', mobile: mobileNumber},
			function(response) {
				if ('success' != response) {
					jQuery(".mobile-number-error").css('color', 'red')
					jQuery(".mobile-number-error").html(`<i class='fa fa-times'></i> Sending app link failed, please try again.`)
					jQuery(".mobile-number-error").fadeIn()
					return
				}

				jQuery(".mobile-number-error").css('color', 'green')
				jQuery(".mobile-number-error").html(`<i class='fa fa-check'></i> App link sent successfully.`);
				jQuery(".mobile-number-error").fadeIn()
				jQuery("input[name='mobile_number']").val("")
				jQuery(".mobile-number-error").delay(6000).fadeOut(3000)
			}
		);
	}

	function playBeep() {
		const sound = new window.Audio(notificationSound);
		sound.play();
	}

	function validateReportIssueFooterForm() {
		$issueType = jQuery("#riFormFooter select[name='issue_type']");
		if (!$issueType.val()) {
			if ($issueType.parent().find(".error").length == 0) {
				$issueType.parent().append('<p class="error"><small><i class="fa fa-warning"></i> Please select issue type</small></p>');                
			} else {
				$issueType.parent().find(".error").html('<small><i class="fa fa-warning"></i> Please select issue type</small>');
			}
			return false;
		} else {
			$issueType.parent().find(".error").remove();
			return true;
		}
	}
</script>

		<script>
			// start: add/remove OneSignal subscribers
			var OneSignal = window.OneSignal || [];
			OneSignal.push(function() {
				OneSignal.init({
					appId: "0f5a65cc-45c8-4838-87f8-f032ea778bf3",
					autoRegister: true,
					notifyButton: {
						enable: false,
					},
				});
			});

			OneSignal.push(function() {
				OneSignal.on('subscriptionChange', function(isSubscribed) {
					if (isSubscribed) {
						OneSignal.getUserId( function(userId) {
							jQuery.post(
								themeDir+'ajax.php',
								{action: 'add_onesignal_subscriber', device_id: userId},
								function(response) {}
							);
						});
					} else {
						OneSignal.getUserId(function(userId){
							jQuery.post(
								themeDir+'ajax.php',
								{action: 'remove_onesignal_subscriber', device_id: userId},
								function(response) {}
							);
						});
					}
				});
			});
			// end: add/remove OneSignal subscribers
		</script>
	
	<script>
		// manage user activity (online/away/offline)
		let idleTime = 0;
		let inactive = false;
		let offline = false;
		let makeOnline = true;
		updateUserStatus();
		function updateUserStatus() {
			if (offline) {
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'update_user_status', status: 'offline', user_id: currentUserId},
					function(response) {}
					);
				return;
			}
			if (inactive) {
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'update_user_status', status: 'away', user_id: currentUserId},
					function(response) {}
					);
				return;
			}
			if (makeOnline) {
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'update_user_status', status: 'online', user_id: currentUserId},
					function(response) {}
					);
				makeOnline = false;
			}
		}

		function timerIncrement() {
			idleTime++;
			if (idleTime > 5 && !inactive) { // 5 minutes
				inactive = true;
				updateUserStatus();
			}
			if (idleTime > 10 && !offline) {
				offline = true;
				updateUserStatus();
			}
		}

		jQuery(document).ready(function() {
			//Increment the idle time counter every minute.
			var idleInterval = setInterval(timerIncrement, 60000); // 1 minute
			//Zero the idle timer on mouse movement.
			jQuery(this).on('mousemove click keypress mousewheel tap swipe swipeleft swiperight', function (event) {
				idleTime = 0;
				if (inactive || offline) {
					makeOnline = true;
				} else {
					makeOnline = false;
				}
				inactive = false;
				offline = false;
				updateUserStatus();
			});
		});

		const acceptChallengeRequest = params => {
			let {challenge_id, game_id, game_slug, network_name, sender_name, match_price = 0} = params
			if (!(challenge_id && game_id)) return
			const confirmNote = `Are you sure to accept the challenge?\nYou are accepting challenge request from ${sender_name}.${match_price ? `\nINR ${match_price} will be deducted from your wallet.` : ``}`
			if (!confirm(confirmNote)) return
			jQuery(`.ch-${challenge_id} .lb-inr-section`).append(`<p class="_accepting-challenge" style="float: left;"><small class="success">Accepting request...</small></p>`)
			jQuery("._crsac").html(loadingSpinner(15))
			jQuery.post(
				`${themeDir}ajax.php`,
				{
					action: `accept_challenge_request`,
					challenge_id: challenge_id,
					user_id: currentUserId,
					game_id: game_id
				},
				response => {
					response = jQuery.parseJSON(response);
					let message = `<div style="padding: 14px 0"><h2 class="text-center"><i class="fa fa-${response.result ? `check-circle` : `exclamation-triangle`}" style="color: ${response.result ? `green` : `red`}"></i></h2>`
					jQuery.each(response.message, (index, msg) => {
						message += `<p class="text-center">${msg}</p>`
					})
					if (response.result) {
						jQuery(`.ch-${challenge_id}`).remove()
						jQuery(`._crs._${challenge_id}`).remove()
						// if (12217 == response.game_id) {
							/*message += `<form action="https://chess.ultimatebattle.in/play-chess.html" method="post" target="_blank">
							    <input type="hidden" name="userid" value="${response.player2}">
							    <input type="hidden" name="match" value="${response.challenge_id}">
							    <input type="hidden" name="matchtype" value="challenge">
							    <input type="hidden" name="waittime" value="180">
							    <p class="text-center"><span class="play-chess-match btn btn-success btn-sm"><i class="fa fa-play"></i> Play Match</span></p>
							</form>`*/
						// } else {
							if (response.target) {
								// window.location.href = `${siteUrl}${game_slug}.html`
								message += `<input type="hidden" name="target_link" value="${response.target}" />`;
							}
						// }
					} else {
						jQuery(`.ch-${challenge_id} .lb-inr-section ._accepting-challenge`).remove()
						jQuery(`._crsac`).html('Accept')
					}
					message += `</div>`
					jQuery(`#alertModal .alert-modal-content`).html(message)
					jQuery(`#alertModal`).modal('show')
				}
			)
		}

		jQuery(document).ready(function(){
			const ss = !!+'0';
			if (ss) {
				jQuery('#buySubscriptionModal').modal('show');
			}

			jQuery(document).on('click', '.play-chess-match', function(){
			    jQuery('#alertModal').modal('hide')
			    jQuery(this).closest('form').submit()
			})

			jQuery(document).on("click", ".acc-ch-req", function(e){
				e.preventDefault()
				const args = jQuery(this).data()
				acceptChallengeRequest(args)
			})

			jQuery('#alertModal').on('hidden.bs.modal', function () {
				let targetLink = jQuery("#alertModal input[name='target_link']").val()
				if (targetLink) {
					window.location.href = targetLink
				}
			});

			jQuery('#tournamentJoinModal').on('hidden.bs.modal', function () {
				let targetLink = jQuery("#tournamentJoinModal #tournament_link").val()
				if (targetLink) {
					window.location.href = targetLink
				}
			});
		})

		/*jQuery(window).blur(function(e) {
			inactive = true;
			updateUserStatus();
		});*/

		jQuery(window).focus(function(e) {
			idleTime = 0;
			inactive = false;
			offline = false;
			makeOnline = true;
			updateUserStatus();
		});

		// edu modal
		jQuery(window).on('load',function(){
			jQuery('#bonusCashEduModal').modal('show');
		});

		jQuery(function(){
			jQuery('#next0').click(function(){
				jQuery('#m0').css({'left':'400px'});
				jQuery('#m1').css({'left':'0px'});
			});
			jQuery('#prev1').click(function(){
				jQuery('#m0').css({'left':'0px'});
				jQuery('#m1').css({'left':'500px'});
			});
			jQuery('#next1').click(function(){
				jQuery('#m1').css({'left':'400px'});
				jQuery('#m2').css({'left':'0px'});
			});
			jQuery('#prev2').click(function(){
				jQuery('#m1').css({'left':'0px'});
				jQuery('#m2').css({'left':'500px'});
			});	
			jQuery('#next2').click(function(){
				jQuery('#m3').css({'left':'0px'});
				jQuery('#m2').css({'left':'500px'});
			});	
			jQuery('#prev3').click(function(){
				jQuery('#m2').css({'left':'0px'});
				jQuery('#m3').css({'left':'500px'});
			});
			jQuery("#finishEduModal").on('click', function(){
				jQuery('#bonusCashEduModal').modal('hide');
				if (jQuery("input[name='stop_bcem']").is(':checked')) {
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'stop_bcem', user_id: currentUserId},
					);
				}
			});
			jQuery(document).on("mouseenter", "._smp-wrap", function(e){
				$this = jQuery(this);
				if ($this.find(".mini-profile-wrap").length == 0) {
					$this.prepend(`<div class="mini-profile-wrap"><div class="text-center _imp">${loadingSpinner(20)}</div></div>`);
					let playerID = $this.data('player');
					let gameID = $this.data('game');
					let networkName = $this.data('network');
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'mini_profile_data', player_id: playerID, game_id: gameID, network_name: networkName},
						function(response) {
							$this.parent().find(".mini-profile-wrap").html(response);
						}
					);
				}
			});
			jQuery(document).on("mouseleave", "._smp-wrap", function(e){
				$this = jQuery(this);
				$this.find('.mini-profile-wrap').remove();
			});
			jQuery(".change-mobile").on('click', function(e){
				e.preventDefault();
				$this = jQuery(this);
				jQuery("table.table-mv tr th").text("Please enter your new mobile number");
				$mobile = $this.parent().parent().parent().find("input[name='verify_mobile']");
				$mobile.val('');
				$mobile.removeAttr('disabled', 'disabled');
				$mobile.attr('name', 'add_mobile');
				$mobile.parent().removeClass('text-right');
				jQuery("input[name='mvotp']").parent().remove();
				$this.parent().parent().parent().parent().parent().find("input[name='mvsave']").attr('onclick', 'validateMobile()');
				jQuery(".otp-info-row").remove();
				$this.parent().parent().remove();
				jQuery("input[name='add_mobile']").focus();
			});
			jQuery(document).on("keypress", "input[name='add_mobile']", function(e){
				var key = e.which;
				if (key == 13) {
					validateMobile();
				}
			});
			jQuery("input[name='mvotp']").keypress(function (e) {
				var key = e.which;
				if (key == 13) {
					validateMobileVerify();
				}
			});
			jQuery(document).on("click", "._smp", function(e){
				e.preventDefault();
			});
			jQuery(document).on('click', '._occ-wrapper .close', function(){
				$target = jQuery(this).parent();
				$target.animate({opacity: '0'}, 500, function(){
					$target.remove();     
				});
			});
			jQuery(document).on('click', '._occ', function(){
				$target = jQuery(this);
				$target.animate({opacity: '0'}, 500, function(){
					$target.remove();     
				});
			});

			// Remove notification toast
			jQuery(document).on('click', '._occ .close', function(){ jQuery(this).closest('._occ').remove() })

			jQuery(document).on('click', '.click-to-call', function(){
				$this = jQuery(this);
				$this.parents('li').find('.error').remove();
				$this.attr('disabled', 'disabled');
				$this.html('<i class="fa fa-phone"></i> Connecting...');
				jQuery.post(
					themeDir+'ajax.php',
					{action: 'make_phone_call', from: $this.data('callfrom'), to: $this.data('callto')},
					function(response) {
						if (response == 'success') {
							$this.html('<i class="fa fa-phone"></i> Connected');
						} else {
							if ($this.parents('li').find('.error').length > 0) {
								$this.parents('li').find('.error').text('Failed, try again!');
							} else {
								$this.parents('table').after('<p class="error text-center">Failed, try again!</p>')
							}
							$this.removeAttr('disabled');
							$this.html('<i class="fa fa-phone"></i> Call');
						}
					}
				);
				/*let res = ubCall($this.data('callfrom'), $this.data('callto'));
				if (res) {
					$this.removeClass('ub-btn-dark-red');
					$this.addClass('ub-btn-dark-green');
					$this.html('<i class="fa fa-phone"></i> Connected');
				} else {
					if ($this.parents('li').find('.error').length > 0) {
						$this.parents('li').find('.error').text('Failed, try again!');
					} else {
						$this.parents('table').after('<p class="error text-center">Failed, try again!</p>')
					}
					$this.removeAttr('disabled');
					$this.html('<i class="fa fa-phone"></i> Call');
				}*/
			});
			jQuery(document).on("change", "#chMatchPrice", function(){
				$this = jQuery(this);
				if (($this.val() != 'sel') && ($this.val() != 'free') && ($this.val() != 'custom')) {
					let pf_per = +"10";			
					let amount = +$this.val();
					let platformFee = amount * (pf_per / 100);
					let total = amount + platformFee;
					if (amount) {
						if (jQuery("#chMatchPrice").parents("._challenge-amount").find("._ab-info").length == 0) {
							jQuery("#chMatchPrice").parents("._challenge-amount").append('<div class="col-lg-12"><p class="_ab-info"><em>Inclusive of platform fee.</em></p></div>');
						} else {
							jQuery("#chMatchPrice").parents("._challenge-amount").find("._ab-info").html('<em>inclusive of platform fee.</em>');
						}
					}
				} else {
					jQuery("#chMatchPrice").parents("._challenge-amount").find("._ab-info").remove();
				}
			});
			jQuery(document).on("change", "input[name='custom_amount']", function(){
				$this = jQuery(this);
				let pf_per = +"10";			
				let amount = +$this.val();
				let platformFee = amount * (pf_per / 100);
				let total = amount + platformFee;
				if (amount) {
					if ($this.parents("._challenge-amount").find("._ab-info").length == 0) {
						$this.parents("._challenge-amount").append('<div class="col-lg-12"><p class="_ab-info"><em>Inclusive of platform fee.</em></p></div>');
					} else {
						$this.parents("._challenge-amount").find("._ab-info").html('<em>Inclusive of platform fee.</em>');
					}
				} else if (amount == 'free') {
					$this.parents("._challenge-amount").find("._ab-info").remove();
				} else if (amount == 'custom') {
					$this.parents("._challenge-amount").find("._ab-info").remove();
				} else {
					$this.parents("._challenge-amount").find("._ab-info").remove();
				}
			});
			jQuery(document).on("change", "select[name='match_price']", function(){
				if (jQuery(this).val() == 'custom') {
					jQuery(this).parents("._amt-wrap").after('<div class="col-lg-6 _custom-amt-wrap"><h2>&nbsp;</h2><div class="challenge-plan-select custom_input_fields"><input type="number" name="custom_amount" min="0" max="2000" class="form-control input_field" placeholder="Enter custom match price" /></div></div>');
				} else {
					jQuery("._custom-amt-wrap").remove();
				}
				jQuery("select[name='match_price']").parents(".row").find('.error').remove();
			});
			jQuery(document).on("change", "#cpfGame", function(){
				$this = jQuery(this);
				let user_id = jQuery("input[name='user_id']").val();
				if (!$this.val()) {
					jQuery(".cfp-network-wrap").html('');
					jQuery(".cfp-settings-wrap").html('');
				} else {
					jQuery(".cfp-network-wrap").html(`<p class="_loading text-center">${loadingSpinner(20)} Loading game networks...</p>`);
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'cpf_networks', game_id: $this.val(), user_id: user_id},
						function(response) {
							jQuery(".cfp-network-wrap").html(response);
						}
					);
				}
			});
			jQuery(document).on("change", "#cpfNetwork", function(){
				$this = jQuery(this);
				let userId = jQuery("input[name='ch_to']").val();
				let gameId = jQuery("#cpfGame").val();
				let networkName = $this.val();
				if (!networkName) {
					jQuery(".cfp-settings-wrap").html('');
				} else {
					jQuery(".cfp-settings-wrap").html(`<p class="text-center">${loadingSpinner(20)} Loading game settings...</p>`);
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'cpf_settings', user_id: userId, game_id: gameId, network_name: networkName},
						function(response) {
							jQuery(".cfp-settings-wrap").html(response);
						}
					);
				}
			});
			// Add as friend
			jQuery(document).on("click", "._aaf", function(e){
				e.preventDefault();
				$this = jQuery(this);
				$this.find('span').html('<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" style="width: 12px" />');
				let friend = $this.data('user');
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'add_as_friend', initiator: currentUserId, friend: friend},
					function(response) {
						switch(response) {
							case 'sent':
							case 'already_sent':
								// alert('Friend request sent.');
								afterFriendRequestSent(friend);
								break;
							case 'sending_failed':
								alert('Friend request sending failed.');
								$this.find('span').text('Add friend');
								break;
							case 'already_friends':
								alert('You are already friends.');
								$this.parent().append('<em class="friends">friends</em>');
								$this.remove();
								break;
						}
					}
				);
			});
			jQuery(document).on("click", "._aaf2", function(e){
				e.preventDefault();
				$this = jQuery(this);
				$this.addClass("_cb-sfr");
				$this.removeClass("_addfriends _aaf2");
				let friend = $this.data('user');
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'add_as_friend', initiator: currentUserId, friend: friend},
					function(response) {
						switch(response) {
							case 'sent':
							case 'already_sent':
								$this.remove();
								afterFriendRequestSent(friend);
								break;
							case 'sending_failed':
								alert('Friend request sending failed.');
								$this.addClass("_addfriend _aaf");
								$this.removeClass("_cb-sfr");
								break;
							case 'already_friends':
								alert('You are already friends.');
								$this.remove();
								break;
						}
					}
				);
			});
			// Cancel friend request
			jQuery(document).on("click", "._cfr", function(e){
				e.preventDefault();
				$this = jQuery(this);
				$this.find('span').html('<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" style="width: 12px" />');
				let friend = $this.data('user');
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'cancel_friend_request', friend1: currentUserId, friend2: friend},
					function(response) {
						if (response == 'success') {
							afterFriendRequestCanceled(friend);
						} else {
							alert('Something went wrong, please try again.');
						}
					}
				);				
			});
			// Decline friend request
			jQuery(document).on("click", '._dfr', function(e){
				e.preventDefault();
				if (confirm('Are you sure?')) {
					$this = jQuery(this);
					$this.find('span').html('<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" style="width: 12px" />');
					let friend = $this.data('user');
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'decline_friend_request', friend1: currentUserId, friend2: friend},
						function(response) {
							if (response == 'success') {
								afterFriendRequestDeclined(friend);
							} else {
								alert('Something went wrong, please try again.');
							}
						}
					);
				}
			});
			// Accept friend request
			jQuery(document).on("click", '._afr', function(e){
				// accept friend request
				$this = jQuery(this);
				$this.find('span').html('<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" style="width: 12px" />');
				let friend = $this.data('user');
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'accept_friend_request', friend1: currentUserId, friend2: friend},
					function(response) {
						if ((response == 'accepted') || (response == 'already_friends')) {
							afterFriendRequestAccepted(friend);
						}
					}
				);
			});
			jQuery("._mark-all-read").on('click', function(e){
				e.preventDefault();
				jQuery("._bell-notif-box ._mar").removeClass('unread');
				jQuery("._bell-notif-box ._mar").addClass('read');
				jQuery("._bell-notif-box ._mar").parents('li').removeClass('unread');
				jQuery("._bell-notif-box ._mar").parents('li').addClass('read');
				jQuery("._hnc16").remove();
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'mark_all_read'},
					function(response) {}
				);
			});
			jQuery("#user_state").on("change", function(){
				let state = jQuery(this).val();
				if (state) {
					jQuery("._lm-city-wrap").html(`<p class="text-center">${loadingSpinner(15)}</p>`);
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'get_state_cities', state: state},
						function(response) {
							if (response != 'not_found') {
								jQuery("._lm-city-wrap").html(response);
								jQuery("._lm-city-wrap").show();
							} else {
								jQuery("._lm-city-wrap").hide();
							}
						}
					);
				}
			});
			jQuery(document).on("change", "._u-loc", function(){
				validateUserLocation();
			});
		});

		function validateUserLocation() {
			let state = jQuery("#user_state").val();
			let city = jQuery("#user_city").val();
			if (state && city) {
				jQuery("input[name='add_user_location']").removeAttr('disabled');
				jQuery("input[name='add_user_location']").removeClass('disabled');
				return true;
			} else {
				if (!state)
					jQuery("._lm-city-wrap").hide();
				else
					jQuery("._lm-city-wrap").show();
				jQuery("input[name='add_user_location']").attr('disabled', 'disabled');
				jQuery("input[name='add_user_location']").addClass('disabled');
				return false;
			}
		}

		function validateAddGamePrefsForm() {
			var games = jQuery("input[name='games[]']:checked").val();
			if (games == undefined) {
				if (jQuery("input[name='add_game_prefs']").parent().find('.error').length == 0) {
					jQuery("input[name='add_game_prefs']").parent().prepend('<p class="error text-center"><i class="fa fa-warning"></i> Please select game(s).</p>');
				}
				return false;
			} else {
				jQuery("input[name='add_game_prefs']").parent().find('.error').remove();
				jQuery("input[name='add_game_prefs']").parent().prepend(`<p class="adding-clan-games text-center">${loadingSpinner(15)} Adding game(s)...</p>`);
				jQuery("input[name='add_game_prefs']").hide();
				return true;
			}
		}

		function bindClanGame(){
			let clanId = jQuery("input[name='clan_id']").val();
			let gameId = jQuery("select[name='clan_game']").val();
			if (gameId.length == 0) {
				jQuery("select[name='clan_game']").parent().append('<p class="error"><i class="fa fa-warning"></i> Please select game!</p>');
			} else {
				jQuery("select[name='clan_game']").parent().find('.error').remove();
				jQuery("select[name='clan_game']").parent().append(`<p class="info">${loadingSpinner(15)} Saving...</p>`);
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'bindClanGame', clanId, gameId},
					function(response) {
						if (response == 'error') {
							jQuery("select[name='clan_game']").parent().append('<p class="error"><i class="fa fa-warning"></i> Something went wrong. Please try again!</p>');
						}
						if (response == 'success') {
							jQuery("select[name='clan_game']").parent().find('.error').remove();
							jQuery("select[name='clan_game']").parent().append('<p class="info"><i class="fa fa-check"></i> Saved successfully!</p>');
							location.reload(true);
						}
					}
					);
			}
		}

		function insertNetworkId(){
			let network_id = jQuery("input[name='network_id']").val();
			let network = jQuery("select[name='network']").val();
			if (network_id.length == 0) {
				jQuery("input[name='network_id']").parent().append('<p class="error"><i class="fa fa-warning"></i> Please Enter Network Id!</p>');
			} else {
				jQuery("input[name='network_id']").parent().find('.error').remove();
				jQuery("input[name='network_id']").parent().append(`<p class="info">${loadingSpinner(15)} Saving...</p>`);
				jQuery.get(
					themeDir+'ajax.php',
					{action: 'insertNetworkId', network_id, network},
					function(response) {
						if (response == 'error') {
							jQuery("input[name='network_id']").parent().append('<p class="error"><i class="fa fa-warning"></i> Something went wrong. Please try again!</p>');
						}
						if (response == 'success') {
							jQuery("input[name='network_id']").parent().find('.error').remove();
							jQuery("input[name='network_id']").parent().append('<p class="info"><i class="fa fa-check"></i> Saved successfully!</p>');
							location.reload(true);
						}
					}
				);
			}
		}

		/* start : complete signup */
		function validateMobile() {
			let $mobile = jQuery("input[name='add_mobile']");
			let mobileNumber = $mobile.val();
			if (mobileNumber.length == 0) {
				if ($mobile.parent().find('.error').length == 0) {
					$mobile.parent().append('<p class="error"><i class="fa fa-warning"></i> Please enter mobile number!</p>');
				} else {
					$mobile.parent().find('.error').html('<i class="fa fa-warning"></i> Please enter mobile number!');
				}
			} else {
				if (!mobileNumber.match(/^[^01234]\d{9}$/)) {
					if ($mobile.parent().find('.error').length == 0) {
						$mobile.parent().append('<p class="error"><i class="fa fa-warning"></i> Invalid mobile number!</p>');
					} else {
						$mobile.parent().find('.error').html('<i class="fa fa-warning"></i> Invalid mobile number!');
					}
				} else {
					$mobile.parent().find('.error').remove();
					$mobile.parent().append(`<p class="info">${loadingSpinner(15)} Saving...</p>`);
					jQuery.get(
						themeDir+'ajax.php',
						{action: 'add_mobile_number', mobile_number: mobileNumber},
						function(response) {
							if (response == 'already_exists') {
								$mobile.parent().find('.info').remove();
								if ($mobile.parent().find('.error').length == 0) {
									$mobile.parent().append('<p class="error"><i class="fa fa-warning"></i> Mobile number already exists.</p>');
								} else {
									$mobile.parent().find('.error').html('<i class="fa fa-warning"></i> Mobile number already exists.');
								}
							}
							if (response == 'success') {
								$mobile.parent().find('.error').remove();
								if ($mobile.parent().find('.info').length == 0) {
									$mobile.parent().append('<p class="info"><i class="fa fa-check"></i> Saved successfully!</p>');
								} else {
									$mobile.parent().find('.info').html('<i class="fa fa-check"></i> Saved successfully!');
								}
								location.reload(true);
							}
						}
					);
				}
			}
		}

		function validateMobileVerify() {
			let userID = "362242";
			$otpField = jQuery("input[name='mvotp']");
			let otp = $otpField.val();
			if (otp.length == 0) {
				jQuery(".otp-error .otp-error-text").html('<span class="error"><i class="fa fa-warning"></i> Please enter OTP!</span>');
			} else {
				if (!otp.match(/^\d{6}$/)) {
					jQuery(".otp-error .otp-error-text").html('<span class="error"><i class="fa fa-warning"></i> Invalid OTP!</span>');
				} else {
					jQuery(".otp-error .otp-error-text").html(`${loadingSpinner(15)} Verifying mobile number...`);
					jQuery.post(
						themeDir+'ajax.php',
						{action: 'verify_mobile', user_id: userID, otp: otp},
						function(response) {
							if (response == 'valid') {
								jQuery(".otp-error .otp-error-text").html('<i class="fa fa-check"></i> Mobile number verified successfully!</span>');
								location.reload(true);
							} else {
								jQuery(".otp-error .otp-error-text").html('<span class="error"><i class="fa fa-warning"></i> '+response+'</span>');
							}
						}
					);
				}
			}
		}

		function resendMobileVerificationOTP() {
			jQuery(".otp-info").html(`${loadingSpinner(15)} Sending OTP...`);
			jQuery.post(
				themeDir+'ajax.php',
				{action: 'resend_mv_otp', user_id: "362242", mobile: jQuery("input[name='verify_mobile']").val()},
				function(response) {
					if (response == 'sent') {
						jQuery(".otp-info").text("OTP resent");
					} else {
						jQuery(".otp-info").html('<span class="error">Error in sending OTP.</span>');
					}
				}
			);
		}

		/* end : complete signup */
		function genUniqueNumber() {
			const now = new Date()
			let year = now.getFullYear()
			let month = now.getMonth()
			month = month + 1
			if (month < 10) month = `0${month}`
				let date = now.getDate()
			if (date < 10) date = `0${date}`
				let hours = now.getHours()
			if (hours < 10) hours = `0${hours}`
				let minutes = now.getMinutes()
			if (minutes < 10) minutes = `0${minutes}`
				let seconds = now.getSeconds()
			if (seconds < 10) seconds = `0${seconds}`
				let milliseconds = now.getMilliseconds()
			if (milliseconds < 10) milliseconds = `0${milliseconds}`
				return `${year}${month}${date}${hours}${minutes}${seconds}${milliseconds}`
		}

		const prepareWebNotification = data => {
			let showTime = ('time' in data) ? data.time : true
			let timeStr
			if (showTime) {
				const now = new Date()
				let hours = now.getHours()
				let meridian = hours < 12 ? 'am' : 'pm'
				hours = (hours + 11) % 12 + 1
				if (hours < 10) hours = `0${hours}`
				let minutes = now.getMinutes()
				if (minutes < 10) minutes = `0${minutes}`
				timeStr = `<span class="_wn-time">${hours}:${minutes} ${meridian}</span>`
			}

			let notification = `<div id="N${data.notif_id}" class="_occ ${data.class ? data.class : ``}" style="${data.theme ? `border-left: 4px solid ${data.theme}` : ``}">
				<span class="close">x</span>
				${data.target ? `<a href="${data.target}">` : ``}
					<div class="_occ-inner">
						<p class="${data.theme}">${data.title || ``}</p>
						<p style="color: #DDD"><small>${data.content}</small></p>
						${showTime ? timeStr : ``}
					</div>
				${data.target ? `</a>` : ``}
			</div>`
			return notification;
		}

		const renderWebNotification = (data) => {
			let recipients = data.recipient.map(Number)
			if (data.recipient.indexOf(currentUserId) != -1) {
				data.notif_id = genUniqueNumber()
				let notification = prepareWebNotification(data)
				jQuery('._occ-wrapper').prepend(notification).animate({scrollTop: 0}, 'normal')
				playBeep()
				jQuery(`#N${data.notif_id}`).delay(30000).fadeOut(600, _ => jQuery(`#N${data.notif_id}`).remove())
			}
		}

		function displayChallengeRequestSticker(data) {
			if (data.recipient.includes(currentUserId)) {
				let d = new Date();
				let hours = d.getHours();
				let meridian = hours < 12 ? 'am' : 'pm';
				hours = (hours + 11) % 12 + 1;
				let target = `${siteUrl}${data.game_slug}.html`;
				let uniqueId = genUniqueNumber();
				let ocAlert = `<div id="N${uniqueId}" class="_crs _${data.id}">
					<span class="close">x</span>
					<div class="_crs-img">
						<img src="${data.avatar}" />
					</div>
					<div class="_crs-content">
						<p class="${data.theme}">Challenge Request</p>
						<p style="margin-bottom: 0"><small><strong>${data.sender_display_name}</strong> sent you a challenge request for ${data.game_title} on ${data.network_name.replace('_', ' ').toUpperCase()}</small></p>
						<p class="_crs-price"><small>Challenge amount: <strong><i class="fa fa-inr"></i>${data.match_price}</strong></small></p>
						<p style="margin-bottom: 0">
							<button class="_crsac acc-ch-req" data-challenge_id="${data.id}" data-game_id="${data.game_id}" data-game_slug="${data.game_slug}" data-network_name="${data.network_name}" data-sender_name="${data.sender_display_name}" data-match_price="${data.match_price}">Accept</button>
							<button class="_crscc" onclick="declineChallengeRequest(${data.id})">Cancel</button>
							<small><a href="${target}" class="_cs-tray-submit">Go to Lobby</a></small>
						</p>
						<span class="_wn-time">${d.getDate()} ${months[d.getMonth()]}, ${hours}:${d.getMinutes()} ${meridian}</span>
						<div class="clear"></div>
					</div>
					<div class="clear"></div>
				</div>`;
				jQuery('._occ-wrapper').prepend(ocAlert);
				jQuery('._occ-wrapper').animate({scrollTop: 0}, 'normal');
				playBeep();
				jQuery(`#N${uniqueId}`).delay(30000).fadeOut(600, _ => jQuery(`#N${uniqueId}`).remove())
			}
		}

		function renderFriendRequestSticker(data) {
			let sticker = `<div class="_fr-sticker _frs${data.initiator}">
				<span class="close">x</span>
				<div class="_fr-avatar">
					<img src="${data.avatar}" />
				</div>
				<div class="_fr-name">
					<p class="lightgreen"><strong>Friend request</strong></p>
					<p class="_fr-dn">${data.initiator_name}</p>
					<p class="_fr-un"><em>@${data.initiator_username}</em></p>
				</div>
				<div class="_fr-actions ub_online-btns">
					<a class="_afr challenge_btn12" data-user="${data.initiator}" href="#" title="Accept friend request"><span>Accept</span></a>
					<a class="_dfr challenge_btn12" data-user="${data.initiator}" href="#" title="Cancel friend request"><span>Decline</span></a>
				</div>
				<div class="clear"></div>
			</div>`;
			jQuery('._occ-wrapper').prepend(sticker);
			jQuery('._occ-wrapper').animate({scrollTop: 0}, 'normal');
		};

		function cancelChallengeRequest(challengeID) {
			if (confirm('Are you sure to cancel the challenge?')) {
				jQuery(`.ch-${challengeID} .lb-inr-section`).append(`<p style="float: left;"><small class="error">Canceling request...</small></p>`);
				jQuery.get(
					`${themeDir}ajax.php`,
					{action: 'cancel_challenge_request', challenge_id: challengeID},
					function(response) {
						if (response == 'success') {
							jQuery(`.ch-${challengeID}`).remove();
						}
					}
				);
			}
		};

		function declineChallengeRequest(challengeID) {
			if (!confirm('Are you sure to decline the challenge?')) return

			if (jQuery(`.ch-${challengeID} .lb-inr-section`).find('.error').length > 0) {
				jQuery(`.ch-${challengeID} .lb-inr-section`).find('.error').html('<small>Processing...</small>')
			} else {
				jQuery(`.ch-${challengeID} .lb-inr-section`).append('<p class="error" style="float: left;"><small>Processing...</small></p>')
			}

			jQuery("._crscc").html(loadingSpinner(12));

			jQuery.get(
				`${themeDir}ajax.php`,
				{action: 'decline_challenge_request', challenge_id: challengeID},
				function(response) {
					if ('success' != response) {
						jQuery("._crscc").html('Decline');
						return
					}
					jQuery(`.ch-${challengeID}`).remove();
					jQuery(`._crs._${challengeID}`).remove();
				}
			);
		};

		function ubCall(callFrom, callTo) {
			jQuery.post(
				themeDir+'ajax.php',
				{action: 'make_phone_call', from: callFrom, to: callTo},
				function(response) {
					return response == 'success' ? true : false;
				}
			);
		}

		function makeCall(callFrom, callTo) {
			let res = ubCall(callFrom, callTo);
		}

		function validateChallenge() {
			let flag = true;
			let $network = jQuery("#challengeForm input[name='ingameid']")
			let $matchPrice = jQuery("#chMatchPrice")
			// let $tnc = jQuery("input[name='ch_tnc']")
			let amount

			if ($network.is(':visible')) {
				if (!$network.val().trim()) {
					flag = false;
					if (0 == $network.parent().find('.error').length)
						$network.parent().append('<p class="error"><small>Please enter Network ID.</small></p>')
					else
						$network.parent().find('.error').html('<small>Please enter Network ID.</small>')
				} else {
					$network.parent().find('.error').remove()
				}
			}

			switch($matchPrice.val()) {
				case 'free':
					amount = 0;
					break;
				case 'custom':
					amount = jQuery("input[name='custom_amount']").val();
					if (!amount) {
						amount = 'custom';
						flag = false;
					}
					break;
				default:
					amount = $matchPrice.val();
					break;
			}

			if (isNaN(amount)) {
				flag = false
				if (0 == $matchPrice.parent().find('.error').length)
					$matchPrice.parent().append('<p class="error"><small>Please input match price.</small></p>')
				else
					$matchPrice.parent().find('.error').html('<small>Please input match price.</small>')
			} else {
				$matchPrice.parent().find('.error').remove()
			}

			/*if (!$tnc.is(":checked")) {
				flag = false
				if (0 == $tnc.parent().find('.error').length)
					$tnc.parent().append('<p class="error"><small>You must be agree for platform fee to send a challenge request.</small></p>')
				else
					$tnc.parent().find('.error').html('<small>You must be agree for platform fee to send a challenge request.</small>')
			} else {
				$tnc.parent().find('.error').remove()
			}*/

			if (!flag) return

			if ('free' == $matchPrice.val()) {
				// send challenge request
				jQuery("#challengeForm ._chr-send").attr('disabled', 'disabled')
				if (0 == jQuery("#challengeForm").find('._ch-info').length)
					jQuery("#challengeForm .model_button").prepend(`<p class="_ch-info text-center"><span>${loadingSpinner(20)} Sending challenge request...</span></p>`)
				else
					jQuery("#challengeForm ._ch-info").html(`<span>${loadingSpinner(20)} Sending challenge request....</span>`)

				// send challenge request
				jQuery.ajax({
					type: "post",
					url: `${themeDir}challenge-send-request.php`,
					data: jQuery("#challengeForm").serialize(),
					success: function(response) {
						if ('success' != response) {
							jQuery("#challengeForm ._chr-send").removeAttr('disabled')
							jQuery("#challengeForm ._chr-send").removeClass('disabled')

							if (jQuery("#challengeForm").find('._ch-info').length > 0) {
								jQuery("#challengeForm").find('._ch-info').html(`<span class="error"><i class="fa fa-times"></i> ${response}</span>`)
								return
							}

							jQuery("#challengeForm .model_button").prepend(`<p class="text-center _ch-info"><span class="error"><i class="fa fa-times"></i> ${response}</span></p>`)
							return
						}

						jQuery("#challengeForm ._chr-send").remove()
						jQuery("#challengeForm ._chr-cancel").text('Close')
						jQuery("#challengeForm ._chr-cancel").removeClass('model-app-btn-1')
						jQuery("#challengeForm ._chr-cancel").addClass('model-app-btn-2')

						if (jQuery("#challengeForm").find('._ch-info').length > 0) {
							jQuery("#challengeForm").find("._ch-info").html('<span class="success"><i class="fa fa-check"></i> Challenge request sent successfully.</span>')
							return
						}

						jQuery("#challengeForm .model_button").prepend('<p class="text-center _ch-info"><span class="success"><i class="fa fa-check"></i> Challenge request sent successfully.</span></p>');
					}
				});
			} else {
				jQuery("#challengeForm ._chr-send").attr('disabled', 'disabled')
				if (0 == jQuery("#challengeForm").find('._ch-info').length)
					jQuery("#challengeForm .model_button").prepend(`<p class="_ch-info text-center"><span>${loadingSpinner(20)} Sending challenge request...</span></p>`)
				else
					jQuery("#challengeForm ._ch-info").html(`<span>${loadingSpinner(20)} Sending challenge request....</span>`)

				jQuery.post(
					`${themeDir}ajax.php`,
					{
						action: 'get_remaining_amount_to_challenge',
						user_id: currentUserId,
						amount: amount
					},
					function(response) {
						if ('success' != response) {
							if (0 == jQuery("#challengeForm").find('._ch-info').length) {
								// jQuery("#challengeForm .model_button").prepend('<p class="text-center _ch-info"><span class="error"><i class="fa fa-warning"></i> Insufficient wallet balance, <a href="#" class="_rwc">recharge wallet</a>.</span></p>');
								jQuery("#challengeForm .model_button").prepend('<p class="text-center _ch-info">'+response+'</p>')
							} else {
								// jQuery("#challengeForm").find('._ch-info').html('<span class="error"><i class="fa fa-warning"></i> Insufficient wallet balance, <a href="#" class="_rwc">recharge wallet</a>.</span>');
								jQuery("#challengeForm").find('._ch-info').html(response)
							}

							jQuery("#challengeForm ._chr-send").removeAttr('disabled')
							jQuery("#challengeForm ._chr-send").removeClass('disabled')
							return
						}

						jQuery("#challengeForm ._chr-send").attr('disabled', 'disabled')
						jQuery("#challengeForm ._chr-send").addClass('disabled')

						if (0 == jQuery("#challengeForm").find('._ch-info').length)
							jQuery("#challengeForm .model_button").prepend(`<p class="text-center _ch-info"><span>${loadingSpinner(20)} Sending challenge  request.</span></p>`);
						else
							jQuery("#challengeForm").find('._ch-info').html(`<span>${loadingSpinner(20)} Sending challenge request.</span>`);

						// send challenge request
						jQuery("._chr-send").attr('disabled', 'disabled')
						jQuery.ajax({
							type: "post",
							url: `${themeDir}challenge-send-request.php`,
							data: jQuery("#challengeForm").serialize(),
							success: function(response) {
								if ('success' != response) {
									if (0 == jQuery("#challengeForm").find('._ch-info').length)
										jQuery("#challengeForm .model_button").prepend(`<p class="text-center _ch-info"><span class="error"><i class="fa fa-times"></i> ${response}</span></p>`)
									else
										jQuery("#challengeForm").find('._ch-info').html(`<span class="error"><i class="fa fa-times"></i> ${response}</span>`)

									jQuery("#challengeForm ._chr-send").removeAttr('disabled')
									jQuery("#challengeForm ._chr-send").removeClass('disabled')
									return
								}

								if (0 == jQuery("#challengeForm").find('._ch-info').length)
									jQuery("#challengeForm .model_button").prepend('<p class="text-center _ch-info"><span class="success"><i class="fa fa-check"></i> Challenge request sent successfully..</span></p>')
								else
									jQuery("#challengeForm").find("._ch-info").html('<span class="success"><i class="fa fa-check"></i> Challenge request sent successfully.</span>')

								jQuery("#challengeForm ._chr-send").remove()
								jQuery("#challengeForm ._chr-cancel").text('Close')
								jQuery("#challengeForm ._chr-cancel").removeClass('model-app-btn-1')
								jQuery("#challengeForm ._chr-cancel").addClass('model-app-btn-2')
							}
						})
					}
				)
			}
		}
		
		function challengePop(userId, gameId = null) {
			jQuery("#challengePopFormWrap").html(`<p class="text-center">${loadingSpinner(50)}<br />Loading...</p>`)
			jQuery("#challengePop").modal('show')
			jQuery.get(
				`${themeDir}ajax.php`,
				{action: 'challenge_pop_form', user_id: userId, game_id: gameId},
				function(response) {
					jQuery("#challengePopFormWrap").html(response);
				}
			)
		}

		function pendingFriendRequestNumPlus() {
			if (jQuery("#ud_friends .ub_abl_users").find(".pending-friend-requests").length == 0) {


				jQuery("#ud_friends .ub_abl_users").prepend(`<p class="text-right">
						<button class="pending-friend-requests"><strong>1</strong> Pending Requests</button>
					</p>
					<div class="pending-friend-requests-wrap">
						<p>&nbsp;</p>
						<p class="text-center">${loadingSpinner(50)}</p>
					</div>`);
			} else {
				let pr_num = +jQuery("#ud_friends .pending-friend-requests strong").text();
				pr_num = pr_num + 1;
				jQuery("#ud_friends .pending-friend-requests strong").text(pr_num);		
			}
		}

		function pendingFriendRequestNumMinus(userId) {
			let pr_num = +jQuery(".pending-friend-requests strong").text();
			pr_num = pr_num - 1;
			if (pr_num > 0) {
				jQuery(".pending-friend-requests strong").text(pr_num);
				jQuery(".pending-friend-requests-wrap .prfid"+userId).remove();
			} else {
				jQuery(".pending-friend-requests").remove();
				jQuery(".pending-friend-requests-wrap").remove();
			}
		}

		function afterFriendRequestSent(userId) {
			jQuery(`.sufid${userId} ._aaf span`).text('Cancel');
			jQuery(`.sufid${userId} ._aaf`).attr('title', 'Cancel friend request');
			jQuery(`.sufid${userId} ._aaf`).addClass("_cfr");
			jQuery(`.sufid${userId} ._aaf`).removeClass("_aaf");
			jQuery(`.rcfid${userId} ._aaf span`).text('Cancel');
			jQuery(`.rcfid${userId} ._aaf`).attr('title', 'Cancel friend request');
			jQuery(`.rcfid${userId} ._aaf`).addClass("_cfr");
			jQuery(`.rcfid${userId} ._aaf`).removeClass("_aaf");
			jQuery(`.friendaction${userId}`).html(`<span><i class="fa fa-times" aria-hidden="true"></i></span>Cancel`);
			jQuery(`.friendaction${userId}`).attr('title', 'Cancel friend request');
			jQuery(`.friendaction${userId}`).addClass("_cfr");
			jQuery(`.friendaction${userId}`).removeClass("_aaf");
			pendingFriendRequestNumPlus();
			if (jQuery(".pending-friend-requests-wrap").is(":visible")) {
				jQuery.get(
					`${themeDir}ajax.php`,
					{action: 'get_pending_requests'},
					function(response) {
						jQuery(".pending-friend-requests-wrap").html(response);
					}
				);
			}
		}

		function afterFriendRequestCanceled(userId) {
			jQuery(".sufid"+userId+" ._cfr span").text('Add friend');
			jQuery(".sufid"+userId+" ._cfr").attr('title', 'Send friend request');
			jQuery(".sufid"+userId+" ._cfr").addClass("_aaf");
			jQuery(".sufid"+userId+" ._cfr").removeClass("_cfr");
			jQuery(".rcfid"+userId+" ._cfr span").text('Add friend');
			jQuery(".rcfid"+userId+" ._cfr").attr('title', 'Send friend request');
			jQuery(".rcfid"+userId+" ._cfr").addClass("_aaf");
			jQuery(".rcfid"+userId+" ._cfr").removeClass("_cfr");
			jQuery(".friendaction"+userId).html('<span><i class="fa fa-plus" aria-hidden="true"></i></span>Add friend');
			jQuery(".friendaction"+userId).attr('title', 'Send friend request');
			jQuery(".friendaction"+userId).addClass("_aaf");
			jQuery(".friendaction"+userId).removeClass("_cfr");
			jQuery(".prfid"+userId).remove();
			pendingFriendRequestNumMinus();
		}

		function afterFriendRequestDeclined(userId) {
			jQuery(".sufid"+userId+" ._afr").addClass('_aaf');
			jQuery(".sufid"+userId+" ._afr span").text('Add friend');
			jQuery(".sufid"+userId+" ._afr").removeClass('_afr');
			jQuery(".sufid"+userId+" ._dfr").remove();
			pendingFriendRequestNumMinus();
			jQuery(".prfid"+userId).remove();
			jQuery("._frs"+userId).remove();
		}

		function afterFriendRequestAccepted(userId) {
			jQuery("._frs"+userId).remove();
			jQuery(".prfid"+userId).remove();
			pendingFriendRequestNumMinus();
			jQuery(".sufid"+userId+" ._afr").remove();
			jQuery(".sufid"+userId+" ._aaf").remove();
			jQuery(".sufid"+userId+" ._dfr").remove();
			jQuery(".sufid"+userId+" .ub_online-btns").append('<em class="friends">friends</em>');
		}

		challengeChannel = pusher.subscribe('challenge');
		matchChannel = pusher.subscribe('match');
		friendChannel = pusher.subscribe('friend');
		ubPlayer = pusher.subscribe('ub_player');
		faceOff = pusher.subscribe('faceoff');
		userDashboardURL = "https://www.ultimatebattle.in/dashboard/user-dashboard.html?section=challenge_requests";

		// ub player
		/*ubPlayer.bind('offline', function(data){
			# code...
		});
		ubPlayer.bind('online', function(data){
			# code...
		});*/

		// challenge notification
		challengeChannel.bind('request', function(data){
			displayChallengeRequestSticker(data);
			playBeep();
		});

		challengeChannel.bind('accept', function(data){
			console.log(data)

		    // renderWebNotification(data)

		    jQuery(`._crs._${data.id}`).remove()

		    // user dashboard
		    if (!(data.player1 && data.player2 && (currentUserId == data.player1 || currentUserId == data.player2)))
		    	return

		    playBeep()

		    if (currentUserId == data.player1) {
		    	let modalContent = `<div class="vip_subscription-popup challenge-accept-modal" style="padding-top: 35px">
			        <p style="color: #DDD; margin-bottom: 20px">${data.content}</p>
			        <div class="_v-btn-close">`
			        	// if (12217 == data.game_id) {
				        	/*modalContent += `<form action="https://chess.ultimatebattle.in/play-chess.html" method="post" target="_blank">
							    <input type="hidden" name="userid" value="${data.player1}">
							    <input type="hidden" name="match" value="${data.id}">
							    <input type="hidden" name="matchtype" value="challenge">
							    <input type="hidden" name="waittime" value="180">
					        	<span class="btn btn-default" data-dismiss="modal">Close</span> 
							    <span class="play-chess-match btn btn-default">Play Match</span>
							</form>`*/
			        	// } else {
			        		if (data.target) {
				        		modalContent += `<input type="hidden" name="target_link" value="${data.target}" />`;
			        		}
			        	// }
			        modalContent += `</div>
				</div>`
				alertModal(modalContent)
		    }

		    
		    let opponentName = data.player1 == currentUserId ? data.player2_name : data.player1_name

		    let matchRow = `<figure><img src="${data.game_logo}" alt=""></figure>
		    <div class="mymatchcontent">
		        <h3>You vs. ${opponentName}</h3>
		        <p><span>Ends</span> at ${data.ends_at}</p>
		        <div class="m_live">Ongoing<small style="float: right"><a href="${data.target}">Submit Score <i class="fa fa-long-arrow-right"></i></a></small>
		        </div>
		    </div>
		    <div class="clear"></div>`

		    if (jQuery(`._ud-my-matches ul`).find(`._ud-cid${data.id}`).length > 0) {
		        jQuery(`._ud-my-matches ul ._ud-cid${data.id}`).html(matchRow)
		    } else {
		        jQuery(`._ud-my-matches ul`).prepend(`<li class="_ud-cid${data.id}">${matchRow}</li>`)
		    }
		    let umNum = +jQuery("._um-num blink").text()
		    umNum = umNum + 1
		    jQuery("._um-num").html(`<blink>${umNum}</blink>`)
		})

		challengeChannel.bind('reject', function(data){
			renderWebNotification(data);
			jQuery("._crs._"+data.id).remove();
		});

		challengeChannel.bind('cancel', function(data){
			renderWebNotification(data);
			jQuery(`._crs._${data.id}`).remove();
		});

		challengeChannel.bind('expired', function(data){
			jQuery("._crs._"+data.id).remove();
		});

		challengeChannel.bind('completed', function(data){
			jQuery("#ACW #AC"+data.id).remove();
			// Display challenge result modal
			if (currentUserId == data.challenge_from || currentUserId == data.challenge_to) {
				// logo, banner, title
				let h3Text = currentUserId == data.winner_id ? `<i class="fa fa-trophy"></i> You Won` : `<i class="fa fa-frown-o"></i> You Lose`;
				jQuery(`#challengeResultModal .crm-game-banner`).attr('src', data.game_banner);
				jQuery(`#challengeResultModal .crm-game-logo`).attr('src', data.game_logo);
				jQuery(`#challengeResultModal .modal-body h3`).html(h3Text);
				// collect data
				let player1Avatar, player2Avatar, player1Name, player2Name, player1Point, player2Point, player1PointDiff, player2PointDiff, scores, player1Wins, player2Wins;
				if (currentUserId == data.challenge_from) {
					player1Avatar = data.avatar1;
					player2Avatar = data.avatar2;
					player1Name = `${data.player1name}<span>@${data.player1username}</span>`;
					player2Name = `${data.player2name}<span>@${data.player2username}</span>`;
					if (data.point1) {
						player1Point = Math.round(data.point1);
						if (data.diff1) {
							player1Point += '('+Math.round(data.diff1)+')';
						}
					}
					if (data.point2) {
						player2Point = Math.round(data.point2);
						if (data.diff2) {
							player2Point += '('+Math.round(data.diff2)+')';
						}
					}
					scores = data.score1+' - '+data.score2;
					player1Wins = data.winner_id == data.challenge_from ? true : false;
					player2Wins = data.winner_id == data.challenge_to ? true : false;
				} else {
					player1Avatar = data.avatar2;
					player2Avatar = data.avatar1
					player1Name = `${data.player2name}<span>@${data.player2username}</span>`;
					player2Name = `${data.player1name}<span>@${data.player1username}</span>`;
					if (data.point2) {
						player1Point = Math.round(data.point2);
						if (data.diff2) {
							player1Point += '('+Math.round(data.diff2)+')';
						}
					}
					if (data.point1) {
						player2Point = Math.round(data.point1);
						if (data.diff1) {
							player2Point += '('+Math.round(data.diff1)+')';
						}
					}
					scores = data.score2+' - '+data.score1;
					player1Wins = data.winner_id == data.challenge_to ? true : false;
					player2Wins = data.winner_id == data.challenge_from ? true : false;
				}
				// player1
				jQuery("#challengeResultModal li.player1-data figure img").attr('src', player1Avatar);
				jQuery("#challengeResultModal li.player1-data h4").html(player1Name);
				if (player1Wins) {
					jQuery("#challengeResultModal li.player1-data ._winpoints").removeClass('l');
					jQuery("#challengeResultModal li.player1-data ._winpoints").addClass('w');
				} else {
					jQuery("#challengeResultModal li.player1-data ._winpoints").removeClass('w');
					jQuery("#challengeResultModal li.player1-data ._winpoints").addClass('l');
				}
				if (player1Point) {
					jQuery("#challengeResultModal li.player1-data ._winpoints").html('Points <span>'+player1Point+'</span>');
				}
				// scores
				jQuery("#challengeResultModal li.mid span").text(scores);
				// player2
				jQuery("#challengeResultModal li.player2-data figure img").attr('src', player2Avatar);
				jQuery("#challengeResultModal li.player2-data h4").html(player2Name);
				if (player2Wins) {
					jQuery("#challengeResultModal li.player2-data ._winpoints").removeClass('l');
					jQuery("#challengeResultModal li.player2-data ._winpoints").addClass('w');
				} else {
					jQuery("#challengeResultModal li.player2-data ._winpoints").removeClass('w');
					jQuery("#challengeResultModal li.player2-data ._winpoints").addClass('l');
				}
				if (player2Point) {
					jQuery("#challengeResultModal li.player2-data ._winpoints").html('Points <span>'+player2Point+'</span>');
				}
				// Display modal
				if (jQuery("#challengeResultModal").is(":hidden")) {
					jQuery("#challengeResultModal").modal('show');
				}
			}
		});

		faceOff.bind('request', function(data){
			renderWebNotification(data);
			if (data.player1 == currentUserId) {
				let matchRow = `<figure><img src="${data.game_logo}" alt="" /></figure>
				<div class="mymatchcontent">
					<h3>${data.game_name} Challenger Tournament</h3>
					<p><span>Prize</span> <i class="fa fa-inr"></i>${data.prize}</p>
					<div class="m_live"><a href="${data.target}">Awaiting Opponent...</a></div>
				</div>
				<div class="clear"></div>`;
				if (jQuery(`._ud-my-matches ul`).find(`._ud-foid${data.ID}`).length > 0) {
					jQuery(`._ud-my-matches ul li._ud-foid${data.ID}`).html(matchRow);
				} else {
					jQuery(`._ud-my-matches ul`).prepend(`<li class="_ud-foid${data.ID}">${matchRow}</li>`);				
				}
				let umNum = +jQuery("._um-num blink").text();
				umNum = umNum + 1;
				jQuery("._um-num").html(`<blink>${umNum}</blink>`);
			}
		});

		/*
		// Render play match
		faceOff.bind('accept', function(data){
			if (data.player1 == currentUserId) {
				let modalContent = `<div class="vip_subscription-popup challenge-accept-modal" style="padding-top: 35px">
			        <p style="color: #DDD; margin-bottom: 20px">${data.gamename} - Challenger tournament accepted by ${data.player2name}</p>
			        <div class="_v-btn-close">
			        	<form action="https://chess.ultimatebattle.in/play-chess.html" method="post" target="_blank">
						    <input type="hidden" name="userid" value="${data.player1}">
						    <input type="hidden" name="match" value="${data.challenge_id}">
						    <input type="hidden" name="matchtype" value="challenge">
						    <input type="hidden" name="waittime" value="180">
				        	<span class="btn btn-default" data-dismiss="modal">Close</span> 
						    <span class="play-chess-match btn btn-default">Play Match</span>
						</form>
			        </div>
				</div>`
			}
			if (data.player2 == currentUserId) {
				let modalContent = `<div class="vip_subscription-popup challenge-accept-modal" style="padding-top: 35px">
			        <p style="color: #DDD; margin-bottom: 20px">${data.gamename} - Challenger Tournament accepted successfully.</p>
			        <div class="_v-btn-close">
			        	<form action="https://chess.ultimatebattle.in/play-chess.html" method="post" target="_blank">
						    <input type="hidden" name="userid" value="${data.player2}">
						    <input type="hidden" name="match" value="${data.challenge_id}">
						    <input type="hidden" name="matchtype" value="challenge">
						    <input type="hidden" name="waittime" value="180">
				        	<span class="btn btn-default" data-dismiss="modal">Close</span> 
						    <span class="play-chess-match btn btn-default">Play Match</span>
						</form>
			        </div>
				</div>`
			}
			alertModal(modalContent)

			// renderWebNotification(data);
		});*/

		challengeChannel.bind('score_report', function(data){renderWebNotification(data);});
		friendChannel.bind('request', function(data){
			if (data.friend == currentUserId) {
				let prStr = `<li class="prfid${data.initiator}">
					<figure><img src="${data.avatar}" /></figure>
					<div class="sp">${data.initiator_name}<br><small>@${data.initiator_username}</small></div>
					<div class="ub_online-btns">
						<a class="_aaf challenge_btn12" data-user="${data.initiator}" href="#">
							<span>Accept</span>
						</a> 
						<a class="_dfr challenge_btn12" data-user="${data.initiator}" href="#">
							<span>Decline</span>
						</a>
					</div>
				</li>`;
				jQuery(`.pending-friend-requests-wrap ul`).append(prStr);
				pendingFriendRequestNumPlus();
			}
			if (data.friend == currentUserId) {
				renderFriendRequestSticker(data);
			}
		});

		challengeChannel.bind('ad', function(data){
			renderWebNotification(data);
		});

		friendChannel.bind('request_canceled', function(data){
			if (currentUserId == data.friend2) {
				jQuery(".prfid"+data.friend1).remove();
				pendingFriendRequestNumMinus();
			}
		});

		friendChannel.bind('request_declined', function(data){
			if (currentUserId == data.friend2) {
				jQuery(`.sufid${data.friend1} ._afr`).addClass('_aaf');
				jQuery(`.sufid${data.friend1} ._afr span`).text('Add friend');
				jQuery(`.sufid${data.friend1} ._afr`).removeClass('_afr');
				jQuery(`.sufid${data.friend1} ._cfr`).addClass('_aaf');
				jQuery(`.sufid${data.friend1} ._cfr span`).text('Add friend');
				jQuery(`.sufid${data.friend1} ._cfr`).removeClass('_cfr');
				jQuery(`.sufid${data.friend1} ._dfr`).remove();
				jQuery(`.prfid${data.friend1}`).remove();
				pendingFriendRequestNumMinus();
				let afStr = `<a class="_aaf challenge_btn12" data-user="${data.friend1}" href="#" title="Send friend request"><span>Add friend</span></a>`;
				jQuery(`.rcfid${data.friend1} .ub_online-btns`).prepend(afStr);
			}
		});

		friendChannel.bind('request_accepted', function(data){
			if (currentUserId == data.friend2) {
				jQuery(`.prfid${data.friend1}`).remove();
				pendingFriendRequestNumMinus();
				let fStr = `<li>
					<figure><img src="${data.f1avatar}" alt="" class=""></figure>
					<div class="sp">${data.f1name}<br><small>@${data.f1username}</small></div>
					<div class="ub_online-btns">
						<a class="challenge_btn12 ch" href="javascript:chat(${data.friend1}, \'${data.f1username}\', \'${data.f1name}\')"><span>Chat</span></a>
						<a class="challenge_btn12" href="javascript:challengePop(${data.friend1})"><span>Challenge <i class="fa fa-long-arrow-right" aria-hidden="true"></i></span></a>
					</div>
				</li>`;
				jQuery("#ud_friends ._ouf").prepend(fStr);
			}
		});

		matchChannel.bind('checkin_start', function(data){
			renderWebNotification(data);
		});
	</script>

<link rel="stylesheet" href="https://www.ultimatebattle.in/ubchat/chat-style.css" defer />
<div id="chatbox_container" style="width: 100%"></div>

<script>
let expireIn = new Date();
expireIn.setDate(expireIn.getDate() + 1);
if (typeof(currentUserId) == 'undefined') {
	let currentUserId = +"362242";
}
if (typeof(currentUsername) == 'undefined') {
	let currentUsername = 'Playunite';
}
let cuDisplayName = 'Playunite Krypton';
let cuMobile = '7510814791';
let cuEmail = '';
let raUserName = "ultimatebat";
let raUserId = "YcQsuvHWfgsQH3PJn";
let raAuthToken = "bnRbiXX7pW21YRVYJHZapAInG-yBFALIP3WdNveXsjR";
function minimizeChatBox(chatBoxId) {
	jQuery(`#${chatBoxId} ._ubs_chat`).slideUp();
	jQuery(`#${chatBoxId} .chat-actions`).slideUp();
	jQuery(`#${chatBoxId} .chat-body`).slideUp();
	jQuery(`#${chatBoxId} footer`).slideUp();
	jQuery(`#${chatBoxId} header .chat-box-min-max`).removeClass('fa-minus');
	jQuery(`#${chatBoxId} header .chat-box-min-max`).addClass('fa-square-o');
	jQuery(`#${chatBoxId} header .chat-box-min-max`).attr('title', 'Maximize');
	jQuery(`#${chatBoxId}`).removeClass('open');
	jQuery(`#${chatBoxId}`).addClass('minimized');
};
function maximizeChatBox(chatBoxId) {
	jQuery('#'+chatBoxId+' ._ubs_chat').slideDown();
	jQuery('#'+chatBoxId+' .chat-actions').slideDown();
	jQuery('#'+chatBoxId+' .chat-body').slideDown();
	jQuery('#'+chatBoxId+' footer').slideDown();
	jQuery('#'+chatBoxId+' header .chat-box-min-max').removeClass('fa-square-o');
	jQuery('#'+chatBoxId+' header .chat-box-min-max').addClass('fa-minus');
	jQuery('#'+chatBoxId+' header .chat-box-min-max').attr('title', 'Minimize');
	jQuery('#'+chatBoxId).removeClass('open');
	jQuery('#'+chatBoxId).addClass('minimized');
	jQuery('#'+chatBoxId).css({top: '50px'});
	jQuery('#'+chatBoxId).removeClass('minimized');
	jQuery('#'+chatBoxId).addClass('open');
	jQuery('#'+chatBoxId+' header .blink').remove();
	jQuery('#'+chatBoxId+' .chat-body').animate({scrollTop: 100000}, 'normal');
};
function bringToTop(chatBoxId) {
    jQuery('.ub-chatbox').css('z-index', '100');
    jQuery('#'+chatBoxId).css('z-index', '101');
};
function createLink(text) {
	var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
	var text1 = text.replace(exp, "<a href='$1' target='_blank'>$1</a>");
	var exp2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
	return text1.replace(exp2, '$1<a target="_blank" href="http://$2">$2</a>');
};
function createUBChatBox(userId, recipientUsername, displayName = null, loadChatHistory = false, minimize = false, updateActivechats = false, count = 10, msg = '') {
	if (currentUsername == recipientUsername) return

	// reduce num
	if (jQuery("._ud-my-chats").find(".rcfid"+userId).length > 0) {
		let num;
		if (jQuery(`._ud-my-chats .rcfid${userId}`).find("._rc-num").length > 0) {
			num = +jQuery(`._ud-my-chats .rcfid${userId} ._rc-num`).text();
			jQuery(`._ud-my-chats .rcfid${userId} ._rc-num`).remove();
		}
		let ucNum = +jQuery("._uc-num blink").text();
		ucNum = ucNum - num;
		if (ucNum > 0) {
			jQuery("._uc-num blink").text(ucNum);
		} else {
			jQuery("._uc-num").text('');
		}
	}

	let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+recipientUsername.replace('.', '');
	// check if box open
	if (jQuery("#chatbox_container").find(".ub-chatbox").length > 0) {
		jQuery(".ub-chatbox header .ucb-avatar ._ucbai").html('');
		jQuery(".ub-chatbox").attr('id', chatBoxId);
		if (displayName) {
			jQuery("._cb-displayname").text(displayName);
			jQuery("._cb-username").text('@'+recipientUsername);				
		} else {
			jQuery(".recipient-name").text('@'+recipientUsername);
		}
		jQuery(".rkt_chat").attr('onclick', 'challengePop('+userId+')');
		jQuery("._f-st").attr('data-user', userId);
		jQuery("input[name='ub_chat_message']").attr('data-sendto', recipientUsername);
		jQuery(".chat-history").html('');
		jQuery(".current-chats").html('');
	} else {
		let leftPos = 50;
		let topPos = 50;
		let zIndex = 100;
		let chatBox = '<div id="'+chatBoxId+'" class="ub-chatbox open" style="position: fixed; left: '+leftPos+'px; top: '+topPos+'px; z-index: '+zIndex+'">'
			+'<header>'
				+'<figure class="ucb-avatar">'
					+'<div class="_ucbai"></div>'
					+'<span class="offline-online-icon offline"></span>'
				+'</figure>'
				+'<span class="recipient-name">';
		if (displayName) {
			chatBox += '<span class="_cb-displayname">'+displayName+'</span><span class="_cb-username">@'+recipientUsername+'</span>';
		} else {
			chatBox += '@'+recipientUsername;
		}
		chatBox += '</span><span class="ub-chat-actions"><i class="fa fa-times ub-chat-header-option close-chat-box" title="Close"></i><i class="fa fa-minus ub-chat-header-option minimize-chat-box chat-box-min-max" title="Minimize"></i></span><div class="new-chat"></div></header><div class="_ubs_chat"><span class="rkt_chat" onclick="challengePop('+userId+')">challenge</span><span class="rkd_chat _f-st _addfriends _rc-aaf" data-user="'+userId+'">Add Friends</span></div><div class="chat-actions"><span><a href="#" class="load-history-btn"><i class="fa fa-history"></i> Load History</a></span><span class="_cb-add-friend"></span><span class="_cb-challenge"></span></div><div class="chat-body"><div class="chat-history"></div><div class="current-chats"></div><div class="preview" style="display:none;"><h3>Preview<button class="close_preview">X</button></h3><img id="pre_img" src="#"/></div></div><footer><input type="text" name="ub_chat_message" data-sendto="'+recipientUsername+'" value="'+msg+'" placeholder="Message" autocomplete="off" /><div class="fileUpload file_icon"><span class="image-icon">Image</span><input type="file" name="image" id="file" class="upload"></div><button name="send_message" title="Send"><i class="fa fa-paper-plane"></i></button></footer><div class="ubcb-footer"></div></div>';
		jQuery("#chatbox_container").append(chatBox);
		jQuery("#"+chatBoxId+" footer input[name='ub_chat_message']").focus();
		jQuery('#'+chatBoxId).draggable({handle: 'header, .ubcb-footer'});
		if (minimize) {
			minimizeChatBox(chatBoxId);
		}
	}

	// get online status
	jQuery.get(
		`${siteUrl}/ubchat/ajax.php`,
		{action: 'get_recipient_status', recipient: recipientUsername},
		function(response) {
			jQuery(`#${chatBoxId} header .offline-online-icon`).removeClass('offline online away')
			jQuery(`#${chatBoxId} header .offline-online-icon`).addClass(response)
		}
	)

	// update add friend button
	jQuery.get(
		"https://www.ultimatebattle.in/ubchat/ajax.php",
		{action: 'get_friendship_status', friend_id: userId},
		function(response) {
			switch(response) {
				case '1':
					// request received
					jQuery("#"+chatBoxId+" .rkd_chat").removeClass('_rc-aaf');
					jQuery("#"+chatBoxId+" .rkd_chat").addClass('_rc-afr');
					jQuery("#"+chatBoxId+" .rkd_chat").text('Accept friend');
					break;

				case '2':
					// request sent
					jQuery("#"+chatBoxId+" .rkd_chat").removeClass('_rc-aaf');
					jQuery("#"+chatBoxId+" .rkd_chat").text('Friend request sent');
					break;

				case '3':
					// friends
					jQuery("#"+chatBoxId+" .rkd_chat").removeClass('_rc-aaf');
					jQuery("#"+chatBoxId+" .rkd_chat").text('Friends');
					break;

				default:
					// code...
					break;
			}
		}
	);

	// get avatar
	jQuery.get(
		"https://www.ultimatebattle.in/ubchat/ajax.php",
		{action: 'get_user_chat_pic', recipient: recipientUsername},
		function(response) {
			// jQuery('#'+chatBoxId+' header img.ubchat-user-img').remove();
			jQuery('#'+chatBoxId+' header .ucb-avatar ._ucbai').html(response);
		}
	);

	if (!loadChatHistory) return

	jQuery.get(
		"https://www.ultimatebattle.in/ubchat/ajax.php",
		{action: 'get_room_id', user1: currentUsername, user2: recipientUsername},
		function(roomId) {
			if (!roomId) return
			jQuery.post(
				"https://www.ultimatebattle.in/ubchat/index.php",
				{action: 'history', me: currentUsername, room_id: roomId, count: count},
				function(response) {
					jQuery(`#${chatBoxId} .chat-body .chat-history`).prepend(response);
					jQuery(`#${chatBoxId} .chat-body .current-chats`).html('');
					jQuery(`#${chatBoxId} .chat-body`).animate({scrollTop: 100000}, 'normal');
				}
			)
		}
	);
}; // end of createUBChatBox

function sendChatMessage(recipientUsername, chatMessage, file=null) {
	let d = new Date();
    let hr = d.getHours();
    let min = d.getMinutes();
    let meridian = (hr < 12) ? 'am' : 'pm';
    let hours = (hr > 12) ? hr - 12 : hr;
    let minutes = (min < 10) ? "0"+min : min;
    let current_chat_time = hours+':'+minutes+' '+meridian;
	let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
	let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();

	let chatMessage2 = createLink(chatMessage);
	let messageClass = 'chatline'+Date.now();
	let chat_date_str;

	let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+recipientUsername.replace('.', '');
	if (jQuery('#chatbox_container').find("#"+chatBoxId).length > 0) {
		chat_date_str = '';
		if (jQuery("#"+chatBoxId+" .chat-body").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
			chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
		}
		if(file){
			image = '<a href="' + file +'" target="blank"><img src="'+file+'"></a>';
		}else{
			image = '';
		}
		jQuery("#"+chatBoxId+' .chat-body .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg pending '+messageClass+'">'+image + chatMessage2+'<span class="_dct">'+current_chat_time+'</span><small class="chat-status"><i class="fa fa-spinner fa-pulse"></i></small></div></div>');
		jQuery("#"+chatBoxId+' .chat-body').animate({scrollTop: 100000}, 'normal');
	}

	let headerId = '#h_'+currentUsername.replace('.', '')+'_'+recipientUsername.replace('.', '');
	if (jQuery("#oppchatwrap").find(headerId).length > 0) {
		chat_date_str = '';
		if (jQuery("#oppchatwrap #oppchatbody").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
			chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
		}
		if(file){
			image = '<a href="' + file +'" target="blank"><img src="'+file+'"></a>';
		}else{
			image = '';
		}
		jQuery('#oppchatwrap #oppchatbody .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg pending '+messageClass+'">'+image + chatMessage2+'<span class="_dct">'+current_chat_time+'</span><small class="chat-status"><i class="fa fa-spinner fa-pulse"></i></small></div></div>');
		jQuery('#oppchatwrap #oppchatbody').animate({scrollTop: 100000}, 'normal');		
	}
	jQuery.post(
		`${siteUrl}/ubchat/index.php`,
		{action: 'send', sendTo: recipientUsername, me: currentUsername, message: chatMessage, sender_name: cuDisplayName, sender_mobile: cuMobile, sender_email: cuEmail, ra_username: raUserName, ra_user_id: raUserId, ra_auth_token: raAuthToken, file: file},
		function(response){
			if ('success' != response) {
				jQuery(`.${messageClass} small i.fa-spinner`).addClass('fa-exclamation-circle')
				jQuery(`.${messageClass} small i`).removeClass('fa-spinner fa-pulse')
				jQuery(`.${messageClass} small i.fa-exclamation-circle`).attr('title', 'failed')
				let errorText = `<div class="chat-error-strip"><p><i class="fa fa-warning"></i> ${response}</p></div>`
				// jQuery('#'+chatBoxId+' .chat-body .current-chats').append(errorText)
				jQuery.get(
					`${themeDir}ajax.php`,
					{action: 'create_rocket_token'},
				);
				return
			}

			playBeep()
			jQuery(`.${messageClass} small.chat-status`).remove()
			jQuery(`.${messageClass}`).removeClass('pending')
			jQuery.get(
				`${siteUrl}/ubchat/ajax.php`,
				{
					action: 'update_recent_chats',
					from: currentUsername,
					to: recipientUsername
				}
			)
		}
	);
};

function chat(userId, userName, displayName = null, msg = '') {
	createUBChatBox(userId, userName, displayName, true, false, true, 10, msg)

};

// get sent message
let chatChannelSent = pusher.subscribe('directchatsend');
chatChannelSent.bind(currentUsername, function(data) {
	let d = new Date();
    let hr = d.getHours();
    let min = d.getMinutes();
    let meridian = (hr < 12) ? 'am' : 'pm';
    let hours = (hr > 12) ? hr - 12 : hr;
    let minutes = (min < 10) ? "0"+min : min;
    let current_chat_time = hours+':'+minutes+' '+meridian;
	let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
	let current_chat_date = monthsNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear();
	if (document.hidden) {
    	let chatMessage = createLink(data.message);
    	let chat_date_str;

    	let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+data.receiver.replace('.', '');
    	if (jQuery("#chatbox_container").find("#"+chatBoxId).length > 0) {
    		chat_date_str = '';
			if (jQuery("#"+chatBoxId+" .chat-body").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
				chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
			}
        	jQuery("#"+chatBoxId+' .chat-body .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg">'+chatMessage+'<span class="_dct">'+current_chat_time+'</span></div></div>');
	        jQuery("#"+chatBoxId+' .chat-body').animate({scrollTop: 100000}, 'normal');
    	}

    	let headerId = '#h_'+currentUsername.replace('.', '')+'_'+data.receiver.replace('.', '');
        if (jQuery("#oppchatwrap").find(headerId).length > 0) {
        	chat_date_str = '';
        	if (jQuery("#oppchatwrap #oppchatbody").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
				chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
			}
        	jQuery('#oppchatwrap #oppchatbody .current-chats').append(chat_date_str+'<div class="message-strip sent"><div class="msg">'+chatMessage+'<span class="_dct">'+current_chat_time+'</span></div></div>');
	        jQuery(oppchatwrap+' #oppchatbody').animate({scrollTop: 100000}, 'normal');
        }
	}
});

// receive message
let chatChannelReceived = pusher.subscribe('directchatreceive');
chatChannelReceived.bind(currentUsername, function(data) {
	// update recent chat row and num
    let num = +jQuery(`.rcfid${data.sender_id}`).find("._rc-num").text();
    num = num + 1;

    jQuery(`.rcfid${data.sender_id}`).remove();

	let chatRow = `<li class="rcfid${data.sender_id}">
		<a href="javascript:chat(${data.sender_id}, '${data.sender}', '${data.sender_name}')">
			<figure class="${data.ost}">${data.avatar}</figure>
			<div class="sp">
				<span>${data.sender_name}</span>
				<small>@${data.sender}</small>
			</div>
			<blink class="_rc-num">${num}</blink>
			<div class="ub_online-btns">
				<div class="challenge_btn12 ch">
					<span>Chat</span>
				</div>
            </div>
        </a>
	</li>`

	jQuery("._ud-my-chats ul").prepend(chatRow)

	// notify user
	if ('ultimatebat' != currentUsername) {
		playBeep()

		let isOldTitle = true
		let oldTitle = document.title
		let newTitle = "new message"
		let interval = null

		if (document.hidden) {
			interval = setInterval(function(){
			    document.title = isOldTitle ? oldTitle : newTitle
			    isOldTitle = !isOldTitle
			}, 500)
		}

		jQuery(window).focus(function(){
		    clearInterval(interval)
		    jQuery("title").text(oldTitle)
		})
	}

	// if chatbox open populate chat
    let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+data.sender.replace('.', '');
	if (jQuery('#chatbox_container').find('#'+chatBoxId).length > 0) {
		let d = new Date();
	    let hr = d.getHours();
	    let min = d.getMinutes();
	    let meridian = (hr < 12) ? 'am' : 'pm';
	    let hours = (hr > 12) ? hr - 12 : hr;
	    let minutes = (min < 10) ? "0"+min : min;
	    let current_chat_time = hours+':'+minutes+' '+meridian;
		let monthsNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
		let current_chat_date = `${monthsNames[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`
		let chatMessage = createLink(data.message);
		let image = data.image;
		if(image){
			image = '<a href="' + image +'" target="blank"><img src="'+image+'"></a>';
		}else{
			image = '';
		}

	    let chat_date_str = '';
		if (jQuery("#"+chatBoxId+" .chat-body").find(jQuery("p.direct-chat-date small:contains("+current_chat_date+")")).length == 0) {
			let chat_date_str = '<p class="text-center direct-chat-date" style="clear: both"><small>'+current_chat_date+'</small></p>';
		}
		jQuery('#'+chatBoxId+' .chat-body .current-chats').append(chat_date_str+'<div class="message-strip received"><div class="msg">'+ image + chatMessage+'<span class="_dct">'+current_chat_time+'</span></div></div>');
		if (jQuery('#'+chatBoxId+' .chat-body').is(':hidden')) {
			if (jQuery('#'+chatBoxId+' header').find('.blink').length == 0) {
				jQuery('#'+chatBoxId+' header .new-chat').append('<span class="blink">New message</span>');
			}
		}
		jQuery('#'+chatBoxId+' .chat-body').animate({scrollTop: 100000}, 'normal');
	} else {
		if (0 == jQuery(`._udb-trigger`).find(`.new-chat-icon`).length) {
			jQuery(`._udb-trigger`).append(`<span class="new-chat-icon"><i class="fa fa-comments-o"></i></span>`)
		}
	}

	// store in chat session
	let ubUnreadChatsObj;
	if (document.cookie.includes('ultimatebat')) {
		ubUnreadChatsObj = jQuery.parseJSON(jQuery.cookie('ubunreadchats'));
		if (!(data.sender in ubUnreadChatsObj)) {
			let un = +jQuery("._ud-my-chats .rcfid"+data.sender_id+" ._rc-num").text();
			un = un + 1;
			ubUnreadChatsObj[data.sender] = {num: un, user_id: data.sender_id};
		}
	} else {
		ubUnreadChatsObj = {[data.sender]: {un: 1, user_id: data.sender_id}};
	}
	jQuery.cookie('ubunreadchats', JSON.stringify(ubUnreadChatsObj), {expires: expireIn});
});

jQuery(function(){
	jQuery('.chat-body').animate({scrollTop: 100000}, 'normal');
	// Minimize chat box
	jQuery(document).on('click', '.ub-chatbox header .fa-minus', function(e){
		let recipient = jQuery(this).parents('.ub-chatbox').find("input[name='ub_chat_message']").data('sendto');
		let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+recipient.replace('.', '');
		minimizeChatBox(chatBoxId);
	});
	// Maximize chat box
	jQuery(document).on('click', '.ub-chatbox header .fa-square-o', function(e){
		let recipient = jQuery(this).parents('.ub-chatbox').find("input[name='ub_chat_message']").data('sendto');
		let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+recipient.replace('.', '');
		if (jQuery(this).parents('.ub-chatbox').find('.chat-body').is(":hidden")) {
			maximizeChatBox(chatBoxId);
		}
	});
	// Close chat box
	jQuery(document).on('click', '.close-chat-box', function(e){
		let recipient = jQuery(this).parents('.ub-chatbox').find("input[name='ub_chat_message']").data('sendto');
	    jQuery(this).parents('.ub-chatbox').remove();
	});
	// Chat
	jQuery(document).on('click', '.click-to-chat', function(){
		let userId = jQuery(this).data('userid');
		let recipientUsername = jQuery(this).data('username');
		let displayName = jQuery(this).data('displayname');
		displayName = displayName ? displayName : '';
		chat(userId, recipientUsername, displayName);
	});
	// Bring to top
	jQuery(document).on('click', '.ub-chatbox', function(e){
		let chatBoxId = jQuery(this).attr('id');
		bringToTop(chatBoxId);
	});
	// Send chat
	jQuery(document).on("click", "button[name='send_message']", function(e){
		let chatMessage = jQuery(this).prev().prev("input[name='ub_chat_message']").val().trim();

		var fileName = jQuery("#file").val();
		fileExtension = fileName.replace(/^.*\./, '');
		var validexten = ['png', 'jpeg', 'jpg'];
			
		if (chatMessage.length > 0 || (jQuery('#file')[0].files[0] && validexten.includes(fileExtension))) {
			let recipientUsername = jQuery(this).prev().prev().attr('data-sendto');
			jQuery(this).prev().prev().val('');

			var fileName = jQuery("#file").val();
			fileExtension = fileName.replace(/^.*\./, '');
			var validexten = ['png', 'jpeg', 'jpg'];
			
			if (jQuery('#file')[0].files[0] && validexten.includes(fileExtension)) {
				// alert('valid');
				var formData = new FormData();
				formData.append('file', jQuery("#file")[0].files[0]);

				jQuery.ajax({
					url : 'https://www.ultimatebattle.in/ubchat/upload.php',
					type : 'POST',
					data : formData,
					processData: false,  // tell jQuery not to process the data
					contentType: false,  // tell jQuery not to set contentType
					success : function(data) {
						console.log(data);
						if(data){
							sendChatMessage(recipientUsername, chatMessage, data);
						}
					}
				});

			}else{
				sendChatMessage(recipientUsername, chatMessage);
			}
			jQuery('.preview').hide();
			jQuery("#file").val('');
		}
	});
	// Send chat on enter
	jQuery(document).on("keypress", "input[name='ub_chat_message']", function(e){
	    var key = e.which;
	    if (key == 13) {
	        var chatMessage = jQuery(this).val().trim();

			var fileName = jQuery("#file").val();
			fileExtension = fileName.replace(/^.*\./, '');
			var validexten = ['png', 'jpeg', 'jpg'];

	        if (chatMessage.length > 0 || (jQuery('#file')[0].files[0] && validexten.includes(fileExtension))) {
	            var recipientUsername = jQuery(this).attr('data-sendto');
				jQuery(this).val('');
				
				var fileName = jQuery("#file").val();
				fileExtension = fileName.replace(/^.*\./, '');
				var validexten = ['png', 'jpeg', 'jpg'];
				
				if (jQuery('#file')[0].files[0] && validexten.includes(fileExtension)) {
					// alert('valid');
					var formData = new FormData();
					formData.append('file', jQuery("#file")[0].files[0]);

					jQuery.ajax({
						url : 'https://www.ultimatebattle.in/ubchat/upload.php',
						type : 'POST',
						data : formData,
						processData: false,  // tell jQuery not to process the data
						contentType: false,  // tell jQuery not to set contentType
						success : function(data) {
							console.log(data);
							if(data){
								sendChatMessage(recipientUsername, chatMessage, data);
							}
						}
					});

				}else{
					sendChatMessage(recipientUsername, chatMessage);
				}
	        }
			jQuery('.preview').hide();
			jQuery("#file").val('');
	    }
		
	});

	function createChatBoxId(usernames) {
	    return usernames.map(function(username){
	        return username.replace(/[#.]/g, '')
	    }).join('_')
	}

	function loadHistory({room_id:roomId, current_username:currentUsername, recipient_username:recipientUsername, count}) {
		try {
			if (!(roomId && currentUsername && recipientUsername)) throw new Error('Room ID and usernames are required.')
			if (!count) count = 20
			const chatBoxId = createChatBoxId([currentUsername, recipientUsername])
			const path = "https://www.ultimatebattle.in/ubchat/ajax.php"
			const reqData = {
				action: 'history',
				me: currentUsername,
				room_id: roomId,
				count: count
			}
			jQuery.post(
				path,
				reqData,
				history => {
					jQuery(`#${chatBoxId} .chat-body .chat-history`).html(history);
					jQuery(`#${chatBoxId} .chat-body .current-chats`).html('');
					jQuery(`#${chatBoxId} .chat-body`).animate({scrollTop: 100000}, 'normal');
			    	jQuery(`#${chatBoxId} .load-history-btn i`).removeClass('fa-spinner fa-pulse');
					jQuery(`#${chatBoxId} .load-history-btn i`).addClass('fa-history');
				}
			)
		} catch(e) {
			console.log(e);
		}
	}

	// Load chat history
	jQuery(document).on('click', '.load-history-btn', function(e){
		e.preventDefault();
		let recipientUsername = jQuery(this).parents('.ub-chatbox').find("input[name='ub_chat_message']").data('sendto');
		let chatBoxId = 'chatbox_'+currentUsername.replace('.', '')+'_'+recipientUsername.replace('.', '');
		jQuery('#'+chatBoxId+' .chat-actions .load-history-btn i').removeClass('fa-history');
		jQuery('#'+chatBoxId+' .chat-actions .load-history-btn i').addClass('fa-spinner fa-pulse');
		const reqData = {
			action: 'get_room_id',
			user1: currentUsername,
			user2: recipientUsername
		};
		console.log(`reqData`, reqData);
		jQuery.get(
			"https://www.ultimatebattle.in/ubchat/ajax.php",
			{action: 'get_room_id', user1: currentUsername, user2: recipientUsername},
			function(roomId) {
				if (roomId) {
					// loadHistory({room_id: roomId, current_username: currentUsername, recipient_username: recipientUsername})
					jQuery.post(
						"https://www.ultimatebattle.in/ubchat/index.php",
						{action: 'history', me: currentUsername, room_id: roomId, count: 20},
						function(response) {
							jQuery('#'+chatBoxId+' .chat-body .chat-history').html(response);
							jQuery('#'+chatBoxId+' .chat-body .current-chats').html('');
							jQuery('#'+chatBoxId+' .chat-body').animate({scrollTop: 100000}, 'normal');
					    	jQuery('#'+chatBoxId+' .load-history-btn i').removeClass('fa-spinner fa-pulse');
							jQuery('#'+chatBoxId+' .load-history-btn i').addClass('fa-history');
						}
					);
				} else {
			    	jQuery('#'+chatBoxId+' .load-history-btn i').removeClass('fa-spinner fa-pulse');
					jQuery('#'+chatBoxId+' .load-history-btn i').addClass('fa-history');
				}
			}
		);
	});
	// add as friend
	jQuery(document).on('click', '._rc-aaf', function(){
		$this = jQuery(this);
		$this.html('<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" style="width: 10px" /> Sending request...').css('text-transform', 'none');
		jQuery.get(
			"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
			{action: 'add_as_friend', initiator: currentUserId, friend: $this.data('user')},
			function(response) {
				switch(response) {
					case 'sent':
					case 'already_sent':
						$this.text('Friend request sent').css('text-transform', 'uppercase');;
						break;
					case 'sending_failed':
						alert('Friend request sending failed.');
						$this.text('Add friend').css('text-transform', 'uppercase');;
						break;
					case 'already_friends':
						alert('You are already friends.');
						$this.text('friends').css('text-transform', 'uppercase');;
						break;
				}
			}
		);		
	});
	// accept friend request
	jQuery(document).on('click', '._rc-afr', function(){
		$this = jQuery(this);
		$this.html('<img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" style="width: 10px" /> Accepting request...').css('text-transform', 'none');
		jQuery.get(
			"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
			{action: 'accept_friend_request', friend1: currentUserId, friend2: $this.data('user')},
			function(response) {
				// if ((response == 'accepted') || (response == 'already_friends')) {}
				switch(response) {
					case 'accepted':
					case 'already_friends':
						$this.removeClass('_rc-afr');
						$this.text('Friends').css('text-transform', 'uppercase');;
						break;
					default :
						$this.text('Accept friend').css('text-transform', 'uppercase');;
						break;
				}
			}
		);
	});
});
// open chatbox if cookie found
if (document.cookie.indexOf('ubunreadchats') != -1) {
	let tNum = 0;
	let ubUnreadChatsObj = jQuery.parseJSON(jQuery.cookie('ubunreadchats'));
	jQuery.each(ubUnreadChatsObj, function(userName, userData){
		if (jQuery("._ud-my-chats ul").find(".rcfid"+userData.user_id).length > 0) {
			if (jQuery("._ud-my-chats ul .rcfid"+userData.user_id).find("._rc-num") > 0) {
				jQuery("._ud-my-chats ul .rcfid"+userData.user_id+" ._rc-num").text(userData.num);
			} else {
				jQuery("._ud-my-chats ul .rcfid"+userData.user_id+" .sp").after('<blink class="_rc-num">'+userData.num+'</blink>');
			}
		}
		tNum = tNum + userData.num;
		jQuery("._uc-num blink").text(tNum);
	});
}
jQuery(document).on('change', '#file', function(){
	var fileName = jQuery(this).val();
	fileExtension = fileName.replace(/^.*\./, '');
	var validexten = ['png', 'jpeg', 'jpg'];

	if (this.files && this.files[0] && validexten.includes(fileExtension)) {
		// alert('Valid');

        var reader = new FileReader();

        reader.onload = function (e) {
			jQuery('#pre_img').attr('src', e.target.result);
			jQuery('.preview').show();
        }

        reader.readAsDataURL(this.files[0]);
    }

});
jQuery(document).on('click', '.close_preview', function(){
	jQuery('.preview').hide();
	jQuery("#file").val('');
});
</script><div class="_udb-wrap activeM">
	<div class="udb-inner">
		<div class="_udb-trigger">
			<!--a href="#myChats" class="_ud-trigger"><i class="fa fa-comments"></i><div class="_uc-num"></div></a>
			<a href="#myMatches" class="_ud-trigger"><i class="fa fa-gamepad"></i><div class="_um-num"></div></a-->
			<button class="sidebar_btn">Close</button>
		</div>
		<div class="_udb">
			<div class="ub_abl_users">
			<h4>Dashboard   <button  class="close_app_dashboard">X</button></h4>
				<div class="side_searchInfo">
				<div class="s_seacr-bx">
						<input type="text" name="search_name"  placeholder="Search gamer by name..."> <input type="submit" value="" name="search_user_btn" />
					</div>
					<div class="user-search-results"></div>
				</div>
			</div>
			<ul class="_ud-inner-tabs">
				<li><a href="#myChats" class="active"><i class="fa fa-comments"></i> Chats</a></li>
				<li><a href="#myMatches"><i class="fa fa-gamepad"></i> My Matches</a></li>
				<li><a href="#myFriends"><i class="fa fa-users"></i> Friends</a></li>
			</ul>
			<div class="dashboard_app_data">
			<div id="myChats" class="_ud-my-chats _ud-tab-c" style=" display:block"><ul></ul></div>
			<div id="myMatches" class="_ud-my-matches _ud-tab-c"></div>
			<div id="myFriends" class="_ud-my-friends _ud-tab-c"></div></div>
		</div>		
	</div>
</div><script>
	function updateChats() {
		jQuery.get(
    		"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
    		{action: 'ud_chats'},
    		function(response) {
    			jQuery("._ud-my-chats ul").html(response);
    		}
    	);
	}
	function updateMatches() {
		jQuery.get(
    		"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
    		{action: 'ud_matches'},
    		function(response) {
    			jQuery("._ud-my-matches").html(response);
    		}
    	);
	}
	function updateFriends() {
		jQuery.get(
    		"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
    		{action: 'ud_friends', user_id: currentUserId},
    		function(response) {
    			jQuery("._ud-my-friends").html(response);
    		}
    	);
	}
	function closePFRQ() {
		jQuery(".pending-friend-requests-wrap").slideUp();
	}
	function searchUsers(searchTerm) {
		searchTerm = searchTerm.trim();
		if (searchTerm[0] == '@') {
			searchTerm = searchTerm.slice(1);			
		}
		if (searchTerm) {
			jQuery(".user-search-results").show();
			jQuery(".user-search-results").html('<p><img src="https://www.ultimatebattle.in/wp-content/themes/blackfyre/img/loading.gif" alt="Loading..." style="width: 15px; height: 15px" /> Searching...</p>');
			jQuery.get(
				"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
				{action: 'search_users', search_term: searchTerm},
				function(response) {
					jQuery(".user-search-results").html(response);
				}
			);			
		}
	}

	setInterval(function(){
		jQuery(`.new-chat-icon`).toggle()
	}, 500)

	jQuery(function(){
		/*jQuery("._ud-trigger").on('click', function(e){
			e.preventDefault();
		    $this = jQuery(this);
		    jQuery("._ud-trigger").removeClass('active');
		    let tabC = $this.attr('href');
		    jQuery("._ud-inner-tabs li a").removeClass('active');
			jQuery("._ud-inner-tabs li a[href='"+tabC+"']").addClass('active');
		    if (tabC == '#myChats') {
			    if (jQuery("._ud-my-chats").is(":visible")) {
			    	jQuery("._udb-wrap").css('right', '-268px');
			    	jQuery("._udb").hide();
			    } else {
			    	jQuery("._udb-wrap").css('right', '0');
			    	jQuery("._udb").show();
			    	jQuery("._ud-tab-c").hide();
			    	jQuery(tabC).show();
			    	$this.addClass('active');
			    	updateChats();
			    }
		    }
		    if (tabC == '#myMatches') {
			    if (jQuery("._ud-my-matches").is(":visible")) {
			    	jQuery("._udb-wrap").css('right', '-268px');
			    	jQuery("._udb").hide();
			    } else {
			    	jQuery("._udb-wrap").css('right', '0');
			    	jQuery("._udb").show();
			    	jQuery("._ud-tab-c").hide();
			    	jQuery(tabC).show();
			    	$this.addClass('active');
			    	updateMatches();
			    }
		    }
		});*/
		jQuery("._ud-inner-tabs li a").on('click', function(e){
			e.preventDefault();
			$this = jQuery(this);
			jQuery("._ud-inner-tabs li a").removeClass('active');
			$this.addClass('active');
			jQuery("._ud-trigger").removeClass('active');
			let tabC = $this.attr('href');
			jQuery("._ud-trigger[href='"+tabC+"']").addClass('active');
			jQuery("._ud-tab-c").hide();
			jQuery(tabC).show();
			switch(tabC) {
				case '#myChats':
					updateChats();
					break;
				case '#myMatches':
					updateMatches();
					break;
				case '#myFriends':
					updateFriends();
					break;
			}
		});
		jQuery(document).on('click', '.pending-friend-requests', function(){
			jQuery('.pending-friend-requests-wrap').slideDown();
			jQuery.get(
				"https://www.ultimatebattle.in/wp-content/themes/blackfyre/ajax.php",
				{action: 'get_pending_requests'},
				function(response) {
					jQuery(".pending-friend-requests-wrap").html(response);
				}
			);
		});
		jQuery("._ud-trigger[href='#myMatches'], ._ud-inner-tabs li a[href='#myMatches']").on('click', function(e){
			e.preventDefault();
			jQuery("._um-num blink").remove();			
		});
		
		jQuery(".sidebar_btn").click(function () {
			const $userSidebar = jQuery('._udb-wrap')
			const $wrapper = jQuery('body > .wrapper')
			const isHidden = $userSidebar.hasClass('activeM')
			if (isHidden) {
				window.localStorage.setItem('user_sidebar', 'open')
				$userSidebar.removeClass('activeM')
				$wrapper.addClass('web')
				jQuery(`.new-chat-icon`).remove()
			} else {
				window.localStorage.setItem('user_sidebar', 'close')
				$userSidebar.addClass('activeM')
				$wrapper.removeClass('web')
			}
		});
		jQuery('.mb_dashboard,.close_app_dashboard').click(function(){
			jQuery('._udb-wrap').toggleClass('active');
			jQuery('body').toggleClass('MBD');
			 });
		
		/*jQuery(document).mouseup(function(e){
		    let container = jQuery("._udb-wrap");
			// if the target of the click isn't the container nor a descendant of the container
			if (!container.is(e.target) && container.has(e.target).length === 0) {
				jQuery("._udb-wrap").css('right', '-268px');
				jQuery("._ud-trigger").removeClass('active');
				jQuery("._ud-tab-c").hide();
			}
		});*/
		jQuery(document).on('click', '.close-search-user', function(){
			jQuery(".user-search-results").slideUp();
			jQuery("input[name='search_name']").val('');
		});
		jQuery(document).on("click", "input[name='search_user_btn']", function(){
			jQuery(".user-search-results").show();
			$searchField = jQuery("input[name='search_name']");
			searchUsers($searchField.val());
		});
		jQuery(document).on("keypress", "input[name='search_name']", function (e) {
			$searchField = jQuery(this);
            let key = e.which;
            if (key == 13) {
				jQuery(".user-search-results").show();
                searchUsers($searchField.val());
            }
        });
	});
</script>
<link rel='stylesheet'  href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css' media='all' />

<script>
	jQuery(window).ready(function(){
		if (ues) return
		var userLoggedIn = 1;
		if(userLoggedIn){
			window.localStorage.removeItem('user_sidebar')
		}
		let userSidebarStatus = window.localStorage.getItem('user_sidebar')
		if (isUserLoggedIn && !userSidebarStatus) userSidebarStatus = 'open'
		const $wrapper = jQuery('body > .wrapper')
		const $userSidebar = jQuery('._udb-wrap')
		const subDomain = "main"
		if ('aiel' == subDomain) userSidebarStatus = 'close'
		if (userSidebarStatus == 'open') {
			$wrapper.addClass('web')
			$userSidebar.removeClass('activeM')
		} else {
			$wrapper.removeClass('web')
			$userSidebar.addClass('activeM')
		}
		jQuery('.dwnloand-apk').click(function(){
			jQuery('.ub-apk-app').addClass('open');								   
		});
		jQuery('.ub-apk-app button').click(function(){
			jQuery('.ub-apk-app').removeClass('open');								   
		});
	});
</script>

	<script>
		let tournamentBracketMatch = pusher.subscribe('tournament_bracket_match');

		tournamentBracketMatch.bind('score_reported', function(data){
			/*console.warn('score reported');
			console.log(JSON.stringify(data));
			console.log([+data.player1, +data.player2].includes(currentUserId));*/
			if ([+data.player1, +data.player2].includes(currentUserId)) {
				// prepare result modal
				let h3Text = currentUserId == data.winner ? '<i class="fa fa-trophy"></i> You Won' : '<i class="fa fa-frown-o"></i> You Lose';
				let player1Avatar = currentUserId == data.player1 ? data.player1avatar : data.player2avatar
				let player2Avatar = currentUserId == data.player1 ? data.player2avatar : data.player1avatar
				let player1Name = currentUserId == data.player1 ? `${data.player1name}${data.player1username ? '<span>@'+data.player1username+'</span>' : ''}` : `${data.player2name}${data.player2username ? '<span>@'+data.player2username+'</span>' : ''}`;
				let player2Name = currentUserId == data.player1 ? `${data.player2name}${data.player2username ? '<span>@'+data.player2username+'</span>' : ''}` : `${data.player1name}${data.player1username ? '<span>@'+data.player1username+'</span>' : ''}`;
				let player1Wins = data.winner == data.player1;
				let player2Wins = data.winner == data.player2;
				let scores = data.scores_csv.split('-');
				let scoresStr = currentUserId == data.player1 ? scores[0]+' - '+scores[1] : scores[1]+' - '+scores[0];
				jQuery("#challengeResultModal .crm-game-banner").attr('src', data.game_banner);
				jQuery("#challengeResultModal .crm-game-logo").attr('src', data.game_logo);
				jQuery("#challengeResultModal .modal-body h3").html(h3Text);
				// player1
				jQuery("#challengeResultModal li.player1-data figure img").attr('src', player1Avatar);
				jQuery("#challengeResultModal li.player1-data h4").html(player1Name);
				if (player1Wins) {
					jQuery("#challengeResultModal li.player1-data ._winpoints").removeClass('l');
					jQuery("#challengeResultModal li.player1-data ._winpoints").addClass('w');
				} else {
					jQuery("#challengeResultModal li.player1-data ._winpoints").removeClass('w');
					jQuery("#challengeResultModal li.player1-data ._winpoints").addClass('l');
				}
				// scores
				jQuery("#challengeResultModal li.mid span").text(scoresStr);
				// player2
				jQuery("#challengeResultModal li.player2-data figure img").attr('src', player2Avatar);
				jQuery("#challengeResultModal li.player2-data h4").html(player2Name);
				if (player2Wins) {
					jQuery("#challengeResultModal li.player2-data ._winpoints").removeClass('l');
					jQuery("#challengeResultModal li.player2-data ._winpoints").addClass('w');
				} else {
					jQuery("#challengeResultModal li.player2-data ._winpoints").removeClass('w');
					jQuery("#challengeResultModal li.player2-data ._winpoints").addClass('l');
				}
				// Display modal
				if (jQuery("#challengeResultModal").is(":hidden")) {
					jQuery("#challengeResultModal").modal('show');				
				}
			}
		});

		/*function chat(...arr) {
			const [userId, username, displayName] = arr
			let errMsg = userId == 108 ? `Chat under maintenance. You can WhatsApp us for support at 9324-952-984` : `Chat under maintenance.`
			jQuery("#cum").html(`<p class="alert" style="margin: 0">${errMsg}</p>`)
			jQuery("#chatUnderMaintenance").modal('show')
		}*/
	</script>
	</body>
</html>
